--File: subuniverse.agda
--Author: William DeMeo
--Date: 10 Jan 2020
--Updated: 6 Feb 2020

{-# OPTIONS --without-K --exact-split #-}
{-# OPTIONS --allow-unsolved-metas #-}

open import Level

open import basic
open algebra
open signature

module subuniverse {â„“ : Level} {S : signature} where

open import preliminaries

open import Data.Empty
open import Data.Unit.Base using (âŠ¤)
open import Data.Product
open import Data.Sum using (_âŠ_; [_,_])
open import Function
open import Relation.Unary
import Relation.Binary.PropositionalEquality as Eq
open Eq using (_â‰¡_; refl)
open import Data.Product using (Î£; _,_; âˆƒ; Î£-syntax; âˆƒ-syntax)

OpClosed : (A : algebra S) (B : Pred âŸ¦ A âŸ§áµ¤ â„“) -> Set â„“
OpClosed A B = âˆ€{ğ“¸ : S ğ“•}
               (args : â„• -> âŸ¦ A âŸ§áµ¤) 
  ->           âˆ€(i : â„•) -> (args i) âˆˆ B
              -------------------------------------------
  ->           (A âŸ¦ ğ“¸ âŸ§) args âˆˆ B
open algebraP

IsSubuniverse : (ğ‘¨ : algebra S) -> Pred âŸ¦ ğ‘¨ âŸ§áµ¤ zero -> Set
IsSubuniverse ğ‘¨ B = âˆ€{ğ“¸ : S ğ“•}
                    (args : â„• -> âŸ¦ ğ‘¨ âŸ§áµ¤)
  ->                (âˆ€(i : â„•) -> (args i) âˆˆ B)
                   -------------------------------------------
  ->                ( (ğ‘¨ âŸ¦ ğ“¸ âŸ§) args âˆˆ B)

--Sub ğ‘¨ ğ‘© (asserts that ğ‘¨ is a subalgebra of ğ‘©)
Sub : (ğ‘¨ ğ‘© : algebraP S) -> Prp
Sub ğ‘¨ ğ‘© = âŸ¦ ğ‘¨ âŸ§â‚š âŠ† âŸ¦ ğ‘© âŸ§â‚š Ã— (âˆ€{ğ“¸ : S ğ“•} -> (args : â„• -> (S Î©))
           -> (âˆ€(i : â„•) -> (args i) âˆˆ âŸ¦ ğ‘¨ âŸ§â‚š)
          -------------------------------------------
           -> (ğ‘© âŸ¦ ğ“¸ âŸ§â‚’) args âˆˆ âŸ¦ ğ‘¨ âŸ§â‚š)

-- subuniverse generated by X ---------------------------------
--          â‹‚ : âˆ€ {â„“ i} (I : Set i) â†’ (I â†’ Pred A â„“) â†’ Pred A _
--          â‹‚ I P = Î» x â†’ (i : I) â†’ P i x
Sg : (ğ‘¨ : algebra S)
  ->   (X : Pred âŸ¦ ğ‘¨ âŸ§áµ¤ zero)
      -------------------  
  ->   Pred âŸ¦ ğ‘¨ âŸ§áµ¤ (suc zero)
Sg ğ‘¨ X = â‹‚ (Pred âŸ¦ ğ‘¨ âŸ§áµ¤ zero) (Î» U _ â†’ IsSubuniverse ğ‘¨ U Ã— X âŠ† U) 

-- --subalgebra intersection
-- _âŠ“_ : âˆ€ {ğ‘¨ : algebraP S}
--   ->  (ğ‘© ğ‘ª : algebraP S)
--   ->  Sub ğ‘© ğ‘¨ -> Sub ğ‘ª ğ‘¨
--     -----------------------
--   ->   algebraP S
-- _âŠ“_ {ğ‘¨} ğ‘© ğ‘ª pb pc =
--   record {
--     âŸ¦_âŸ§â‚š = âŸ¦ ğ‘© âŸ§â‚š âˆ© âŸ¦ ğ‘ª âŸ§â‚š ;
--     _âŸ¦_âŸ§â‚’ =  ğ‘© âŸ¦_âŸ§â‚’ ;
--     cl = Î» ğ“¸ args argsâˆˆBâˆ©C -> ((cl ğ‘©) ğ“¸ args Î»{i -> projâ‚ (argsâˆˆBâˆ©C i)}) , {!!}
--     }

--interxection of subalgebras is a subalgebra
-- âŠ“-IsSubuniverse : {ğ‘¨ ğ‘© ğ‘ª : algebraP S} -> Sub ğ‘© ğ‘¨ -> Sub ğ‘ª ğ‘¨ -> Sub (ğ‘© âŠ“ ğ‘ª) ğ‘¨ 
-- ğ‘© âŠ“ ğ‘ª = record { âŸ¦_âŸ§â‚š = {!!} ; _âŸ¦_âŸ§â‚’ = {!!} ; cl = {!!} }


record subuniverse {A : algebra S} : Set (suc â„“) where
  constructor mksub
  field
    sset : Pred âŸ¦ A âŸ§áµ¤ â„“
    closed : OpClosed A sset    

--subalgebra type
record subalgebra (A : algebra S) : Set (suc â„“) where

  field

    subuniv : Pred âŸ¦ A âŸ§áµ¤ â„“
    _âŸ¦_âŸ§ : (ğ“¸ : S ğ“•)
      ->   (args : â„• -> âŸ¦ A âŸ§áµ¤)
      ->   ( âˆ€(i : â„•) -> (args i) âˆˆ subuniv )
         --------------------------------------------------
      ->   Set â„“
      
    closed : OpClosed A subuniv


open subuniverse

SubAlgebra : (A : algebra S)
  ->         (B : subuniverse {A})
           --------------------------
  ->         (subalgebra A)

SubAlgebra A B =
  record
    {
    subuniv = sset B ;
    _âŸ¦_âŸ§ = Î» ğ“¸ args p -> (sset B) ((A âŸ¦ ğ“¸ âŸ§) args) ;
    closed = closed B
    }
