\section{Introduction}
The \agdaalgebras library \cite{ualib_v2.0.1} formalizes the foundations of universal algebra
in intensional Martin-L√∂f type theory (\mltt) using \agda~\cite{Norell:2007,agdaref}.
The library includes a wide collection of definitions and verified theorems that faithfully codify
classical, set-theory-based universal algebra and equational
logic.

The first major milestone of the \agdaalgebras project is a proof of \emph{Birkhoff's
variety theorem} (also known as the \emph{HSP theorem})~\cite{Birkhoff:1935}.
To the best of our knowledge, this constitutes the first ever formal proof of
Birkhoff's in Martin-L√∂f Type Theory, and it is the first such machine-verified proof of Birkhoff's
celebrated 1935 result.  An alternative formalization, based on classical
set-theory, was achieved in~\cite{birkhoff-in-mizar:1999}; see \href{http://www.mizar.org/JFM/Vol9/birkhoff.html\#BIB21}{mizar.org/JFM/Vol9/birkhoff.html}.

Presented here is our second proof of the HSP theorem. The first proof\footnote{See the
 \href{https://github.com/ualib/ualib.github.io/blob/71f173858701398d56224dd79d152c380c0c2b5e/src/lagda/UALib/Birkhoff.lagda}{\textsf{Birkhoff.lagda}} file
 in the \href{https://github.com/ualib/ualib.github.io}{\textsf{ualib/ualib.gitlab.io}}
 repository (\href{https://github.com/ualib/ualib.github.io/commit/71f173858701398d56224dd79d152c380c0c2b5e}{15
 Jan 2021 commit 71f1738})~\cite{ualib_v1.0.0}.}
suffered from flaws that raised two concerns. First, it was not clear whether the
proof was fully constructive (because of its use of function extensionality in \mltt). Second,
it was shown that if one were to take the type
\ab{X}---which we use to represent an arbitrary collection of
variable symbols---to be  the two element type, then one could combine this with our
proof and derive a contradiction. To resolve these issues, we have rewritten parts of the library and
developed a new proof of the HSP theorem. We are confident that the
proof presented here\footnote{based on \agdaalgebras, ver.~2.0.1~\cite{ualib_v2.0.1}, \agda ver.2.6.2 and \agdastdlib ver.1.7.} is constructive and
 correct. %, a conviction we justify in the sequel (\qv).

What follows is a self-contained formal proof of the HSP theorem in \agda.  This is achieved by
extracting a subset of the \agdaalgebras library, including only the
pieces needed for the proof, into a literate \agda document.\footnote{See
\HSPlagda in the \agdaalgebras repository: \agdaalgebrasrepo .}
\ifshort
For spaces reasons, we elide some inessential parts,
but strive to preserve the essential content and character of the development.
More specifically, routine or overly technical components, as well as anything that does not
seem to offer insight into the central ideas of the proof are omitted.\footnote{The full proof
appears in the unabridged version of the present paper~\cite{DeMeo:2021}.}
\else
We include here every line of code of our new proof of Birkhoff's theorem
in a single \agda module, presented as a literate \agda document,\footnote{See
\HSPlagda in the \agdaalgebras repository: \agdaalgebrasrepo .}.  Apart from a few dozen
imports from the \agdastdlib, the module is self-contained.
\fi

We highlight some of the challenging aspects of formalizing universal algebra in type theory.
Nonetheless, we hope to show that the patient mathematician, with enough resolve and the will to learn
dependent type theory, can reap the rewards of the further insights that mechanization provides.

\ifshort\else
We give a sobering glimpse of the technical hurdles that must be overcome
to conduct research in mathematics using dependent type theory in \agda.
The results are rather gratifying and enlightening, and we feel are worth
the investment. Users of Coq and Lean have recently reported similar feelings
from the outcome of their formalization efforts.
\fi

Our main contribution is the representation of algebraic structures and their signatures
in dependent type theory in a way that is not only very general, but also practical, as we
demonstrate by formalizing one of the deepest results in the field.

\section{Preliminaries}

For the most part, we assume that the reader is familiar with \mltt, and can decipher its encoding in \agda.

\subsection{Logical foundations}

To best emulate \mltt, we use
\begin{code}[inline]%
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{OPTIONS}\AgdaSpace{}%
\AgdaPragma{--without-K}\AgdaSpace{}%
\AgdaPragma{--exact-split}\AgdaSpace{}%
\AgdaPragma{--safe}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\end{code}
; these options affect the logical foundations with respect to which our code is type-checked.
\ifshort
Briefly,
\AgdaPragma{without-K} disables
\href{https://ncatlab.org/nlab/show/axiom+K+%28type+theory%29}{Streicher's K axiom},
\AgdaPragma{exact-split} directs \agda to accept only definitions behaving like
{\it judgmental} equalities, and
\AgdaPragma{safe} ensures that nothing is postulated outright.
See~\cite{agdaref-axiomk,agdaref-safeagda,agdatools-patternmatching} for more details.
\else
Here are brief descriptions of these options, accompanied by links to related documentation.
\begin{itemize}
\item
\AgdaPragma{without-K} disables \href{https://ncatlab.org/nlab/show/axiom+K+%28type+theory%29}{Streicher's K axiom}.
See the \href{https://agda.readthedocs.io/en/v2.6.1/language/without-k.html}{section on axiom K} in
the \href{https://agda.readthedocs.io/en/v2.6.1.3/language}{Agda Language Reference Manual}~\cite{agdaref-axiomk}.
\item
\AgdaPragma{exact-split} makes \agda accept only those definitions that behave like so-called {\it judgmental} equalities.
See the \href{https://agda.readthedocs.io/en/v2.6.1/tools/command-line-options.html#pattern-matching-and-equality}%
{Pattern matching and equality} section of
the \href{https://agda.readthedocs.io/en/v2.6.1.3/tools/}{Agda Tools} documentation~\cite{agdatools-patternmatching}.
\item
\AgdaPragma{safe} ensures that nothing is postulated outright---every non-\mltt axiom has to be an explicit assumption (e.g., an argument to a function or module).
See the \href{https://agda.readthedocs.io/en/v2.6.1/tools/command-line-options.html#cmdoption-safe}{cmdoption-safe} section of~\cite{agdaref-safeagda}.
\end{itemize}
\fi

We also make use of a variety of definitions from Agda's standard library; these are imported as follows.
\begin{code}[hide]%
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{OPTIONS}\AgdaSpace{}%
\AgdaPragma{--without-K}\AgdaSpace{}%
\AgdaPragma{--exact-split}\AgdaSpace{}%
\AgdaPragma{--safe}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaComment{--\ Import\ universe\ levels\ and\ Signature\ type\ (described\ below)\ from\ the\ agda-algebras\ library.}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Base.Algebras.Basic}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaGeneralizable{ùìû}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaGeneralizable{ùì•}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Demos.HSP}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaGeneralizable{ùìû}\AgdaSpace{}%
\AgdaGeneralizable{ùì•}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaComment{--\ Import\ 16\ definitions\ from\ the\ Agda\ Standard\ Library.}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Data.Unit.Polymorphic}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{‚ä§}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{tt}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Function}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{flip}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚àò\AgdaUnderscore{}}}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Level}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaPostulate{Level}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Binary}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Binary.Definitions}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Reflexive}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Symmetric}%
\>[99]\AgdaSymbol{)}\<%
\\
%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Transitive}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Trans}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Binary.PropositionalEquality}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚â°\AgdaUnderscore{}}}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Unary}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚äÜ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚àà\AgdaUnderscore{}}}%
\>[99]\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{--\ Import\ 23\ definitions\ from\ the\ Agda\ Standard\ Library\ and\ rename\ 12\ of\ them.}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Agda.Primitive}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaPrimitive{Set}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaPrimitive{Type}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{\AgdaUnderscore{}‚äî\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaPrimitive{lsuc}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Data.Product}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{proj‚ÇÅ}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{fst}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{proj‚ÇÇ}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{snd}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}√ó\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{},\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Œ£-syntax}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Function}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaRecord{Func}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaRecord{\AgdaUnderscore{}‚ü∂\AgdaUnderscore{}}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaRecord{Injection}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaRecord{Surjection}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}%
\>[13]\AgdaModule{\AgdaUnderscore{}‚ü∂\AgdaUnderscore{}}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{f}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{cong}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}%
\>[13]\AgdaModule{Setoid}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{reflÀ¢}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{symÀ¢}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{trans}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{transÀ¢}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âàÀ¢\AgdaUnderscore{}}}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}%
\>[13]\AgdaModule{IsEquivalence}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{refl}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{refl·µâ}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{sym}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{sym·µâ}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{trans}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{trans·µâ}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
\>[0]\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0]\AgdaComment{--\ Assign\ handles\ to\ 3\ modules\ of\ the\ Agda\ Standard\ Library.}\<%
\\
\>[0]\AgdaKeyword{import}%
\>[13]\AgdaModule{Function.Definitions}%
\>[52]\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{FD}\<%
\\
\>[0]\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Binary.PropositionalEquality}%
\>[52]\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{‚â°}\<%
\\
\>[0]\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Binary.Reasoning.Setoid}%
\>[52]\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaKeyword{variable}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSpace{}%
\AgdaGeneralizable{Œ¥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µà}\AgdaSpace{}%
\AgdaGeneralizable{œÅ}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\<%
\\
%
\>[1]\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaGeneralizable{Œî}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\<%
\\
%
\>[1]\AgdaGeneralizable{ùëì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaBound{ùëÜ}\<%
\\
\>[0]\<%
\end{code}
\fi
The above imports include some adjustments to ``standard \agda'' syntax; in particular,
we use \AgdaPrimitive{Type} in place of \AgdaPrimitive{Set}, the infix long arrow symbol,
\AgdaRecord{\AgdaUnderscore{}‚ü∂\AgdaUnderscore{}}, instead of \AgdaRecord{Func} (the type of ``setoid functions,'' discussed in ¬ß\ref{setoid-functions} below), and the symbol \aofld{\au{}‚ü®\$‚ü©\au{}} in place of \afld{f} (application of the map of a setoid function); we use
\AgdaField{fst} and \AgdaField{snd}, and sometimes \AgdaOperator{\AgdaFunction{‚à£\AgdaUnderscore{}‚à£}} and
\AgdaOperator{\AgdaFunction{‚à•\AgdaUnderscore{}‚à•}}, to denote the first and second
projections out of the product type
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}√ó\AgdaUnderscore{}}}.
\ifshort\else

\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaSymbol{\}\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaOperator{\AgdaFunction{‚à£\AgdaUnderscore{}‚à£}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚à£\AgdaUnderscore{}‚à£}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fst}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚à•\AgdaUnderscore{}‚à•}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚à•\AgdaUnderscore{}‚à•}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{snd}\<%
\end{code}
\fi

%% -----------------------------------------------------------------------------
\subsection{Setoids}\label{setoids}
A \defn{setoid} is a pair consisting of a type \ab A and
an equivalence relation \af{‚âà} on \ab A.  Setoids are useful for representing a
set with a ``local'' notion of equivalence, instead of always relying on
the global one as is usually done in set theory. Formal proofs based on setoids
may seem like an unnatural departure from informal mathematical practice, where
notions of equality are left implicit and do not distract from what may seem
like more important, higher-level aspects of the mathematics. However, in our
view, notions of equality ought to be elevated to a status that obliges us to
make them explicit in any mathematical argument.  While we acknowledge that formal
proofs based on setoids may sometimes seem complicated or overly technical, we
believe that informal arguments, which elide such formalisms, are
oversimplifications.  We believe it is a bug, not a feature, of informal
mathematics that proofs need not be explicit about the meaning of equality.

\ddmmyydate

\wjd{I tried to make a case for Setoids; JC, can you make this more convincing, or
  propose something else entirely.}

The \agdaalgebras library was first developed without setoids, relying on
propositional equality \ad{\au{}‚â°\au{}} instead,
along with some experimental, domain-specific types for equivalence classes, quotients, etc.
This furthermore required postulating function extensionality,%
\footnote{An axiom that asserts that two point-wise equal functions are equal.} which is
known to be independent from \mltt~\cite{MHE, MHE:2019}. This was
an unsatisfactory state of affairs, as %we were curious to see if
our aim is to show that the theorems hold directly in \mltt without extra axioms.
In particular, the present exposition makes no appeals to classical axioms like Choice or Excluded Middle.


%% -----------------------------------------------------------------------------
\subsection{Setoid functions}
\label{setoid-functions}
We use the \ar{Func} type from the \agdastdlib for representing a function from
a setoid \ab A to another setoid \ab B that respects the underlying equivalences,
witnessed by a field called \afld{cong}.  However, we rename \ar{Func}, using
the more visually appealing infix long arrow symbol,
\AgdaRecord{\AgdaUnderscore{}‚ü∂\AgdaUnderscore{}}, instead. Throughout the
paper we refer to inhabitants of this type as ``setoid functions.''

\ifshort\else
An example of a setoid function is the identity function from a setoid to itself.
We define it, along with a binary composition operation for setoid functions,
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}, as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{ùëñùëë}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[0]\AgdaFunction{ùëñùëë}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚ü®‚àò‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[9]\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{C}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[9]\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{C}%
\>[16]\AgdaSymbol{‚Üí}%
\>[19]\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{B}%
\>[26]\AgdaSymbol{‚Üí}%
\>[29]\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{C}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}%
\>[18]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\<%
\\
%
\>[18]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}
\fi

\paragraph*{Inverses}
We frequently need to deal with the \defn{inverse} of a function. This is most easily defined in terms of the
\emph{image} of the function's domain, as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{B}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image\AgdaUnderscore{}‚àã\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{B}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{B}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚âà}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
\>[0]\<%
\end{code}

An inhabitant of the \aod{Image} \ab f \aod{‚àã} \ab b type is a point \ab a of type \ab A,
along with a proof, \ab p~\as :~\ab b \af{‚âà} \ab f~\ab a, that \ab f maps \ab a to \ab b.
Since the witness that \ab b
belongs to the image of \ab f is always accompanied by a concrete witness \AgdaTyped{a}{A}, we can
\emph{compute} a range-restricted right-inverse of \ab f.  For extra certainty, we also verify
that our witness really is an inverse.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)\{}\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{B}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{InvIsInverse ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{\}\{}\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{B}\AgdaSymbol{\}(}\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚âà}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[1]\AgdaFunction{InvIsInverse ≥}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaBound{p}\<%
\end{code}

\paragraph*{Injective and surjective setoid functions}
If \ab{f} : \ab{ùë®} \aor{‚ü∂} \ab{ùë©}
then we call \ab f \defn{injective} provided
\as{‚àÄ} (\ab{a‚ÇÄ} \ab{a‚ÇÅ} \as : \ab{A}), \ab{f} \aofld{‚ü®\$‚ü©} \ab{a‚ÇÄ} \af{‚âà·¥Æ} \ab{f} \aofld{‚ü®\$‚ü©} \ab{a‚ÇÅ}
implies \ab{a‚ÇÄ} \af{‚âà·¥¨} \ab{a‚ÇÅ}; we call \ab{f} \defn{surjective} provided
\as{‚àÄ} (\AgdaTyped{b}{B}), \as{‚àÉ}~(\AgdaTyped{a}{A}) such that \ab{f} \aofld{‚ü®\$‚ü©} \ab{a} \af{‚âà·¥Æ} \ab{b}.
\ifshort
We omit the straightforward \agda definitions.
\else

We represent injective functions on bare types by the
type \af{Injective}, and uses this to define the \af{IsInjective} type to represent
the property of being an injective setoid function. Similarly, the type \af{IsSurjective}
represents the property of being a surjective setoid function. \af{SurjInv} represents the \emph{right-inverse} of a surjective function.

We reproduce the definitions and prove some of their properties
inside the next submodule where we first set the stage by declaring two
setoids \ab{ùë®} and \ab{ùë©}, naming their equality relations, and making some
definitions from the standard library available.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà·¥¨\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà·¥Æ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FD}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚âà·¥¨\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà·¥Æ\AgdaUnderscore{}}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[26]\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Injective}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[27]\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{SurjInv}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{SurjInv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{fonto}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fonto}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{b}\AgdaSymbol{\})}\<%
\\
\>[0]\<%
\end{code}

Proving that the composition of injective setoid functions is again injective
is simply a matter of composing the two assumed witnesses to injectivity.
Proving that surjectivity is preserved under composition is only slightly more involved.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[10]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
%
\>[10]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)(}\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{‚àò-IsInjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{‚àò-IsInjective}\AgdaSpace{}%
\AgdaBound{finj}\AgdaSpace{}%
\AgdaBound{ginj}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{finj}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{ginj}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚àò-IsSurjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{‚àò-IsSurjective}\AgdaSpace{}%
\AgdaBound{fonto}\AgdaSpace{}%
\AgdaBound{gonto}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Goal}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{mp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[2]\AgdaFunction{mp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaBound{fonto}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[3]\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mp}\AgdaSpace{}%
\AgdaBound{gonto}\<%
\end{code}
\fi

\paragraph*{Kernels of setoid functions}
The \defn{kernel} of a function \ab f~\as :~\ab A~\as{‚Üí}~\ab B (where \ab A and \ab B are
bare types) is defined informally by \{\AgdaPair{x}{y} \aod{‚àà} \ab A \aof{√ó} \ab A \as :
\ab f \ab x \as{=} \ab f \ab y \}. This can be represented in \agda in a number of ways,
but for our purposes it is convenient to define the kernel as an inhabitant of a (unary)
predicate over \ab A \aof{√ó} \ab A, where \ab A is the function's domain, as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{kernel}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSymbol{\}\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaGeneralizable{œÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaGeneralizable{œÅ}\<%
\\
\>[0]\AgdaFunction{kernel}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{‚âà}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
\>[0]\<%
\end{code}
The kernel of a \emph{setoid} function \ab f \as : \ab{ùê¥} \aor{‚ü∂} \ab{ùêµ} is
defined similarly.

\ifshort\else
\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùê¥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùêµ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùê¥}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{A}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{ker}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùê¥}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùêµ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaFunction{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\<%
\\
%
\>[1]\AgdaFunction{ker}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùêµ}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}


%% -------------------------------------------------------------------------------------

\section{Basic Universal Algebra}
\label{basic-universal-algebra}
We now develop a working vocabulary in \mltt corresponding to classical,
single-sorted, set-based universal algebra.
We cover a number of important concepts, but limit ourselves to those
required to prove Birkhoff's HSP theorem.
In each case, we give a type-theoretic version of the informal definition,
followed by an \agda implementation.

This section is organized into the following subsections:
¬ß\ref{signatures} defines a general notion of \emph{signature} of a structure and
then defines a type that represent signatures;
¬ß\ref{algebras} does the same for \emph{algebraic structures} and \emph{product algebras};
¬ß\ref{homomorphisms} defines \emph{homomorphisms}, \emph{monomorphisms}, and \emph{epimorphisms},
presents types that codify these concepts, and formally verifies some of their basic properties;
¬ß¬ß\ref{subalgebras}--\ref{terms} do the same for \emph{subalgebras} and \emph{terms}, respectively.

%% -----------------------------------------------------------------------------
\subsection{Signatures}
\label{signatures}

\ifshort
An (algebraic) \defn{signature}
\else
In model theory, the \defn{signature} of a structure is a quadruple \ab{ùëÜ} = (\ab{C},
\ab{F}, \ab{R}, \ab{œÅ}) consisting of three (possibly empty) sets \ab{C}, \ab{F}, and
\ab{R}---called \emph{constant}, \emph{function}, and \emph{relation} symbols,
respectively---along with a function \ab{œÅ} : \ab{C} \as{+} \ab{F} \as{+} \ab{R}
\as{‚Üí} \ab{N} that assigns an \emph{arity} to each symbol. Often, but not always, \ab{N}
is taken to be the set of natural numbers.

As our focus here is universal algebra, we consider the restricted notion of an
\emph{algebraic signature}, that is, a signature for ``purely algebraic'' structures. Such
a signature
\fi
is a pair \ab{ùëÜ} = \AgdaPair{F}{œÅ} where \ab{F} is a collection of
\defn{operation symbols} and \ab{œÅ} : \ab{F} \as{‚Üí} \ab{N} is an \defn{arity function}
which maps each operation symbol to its arity. Here, \ab{N} denotes the \emph{arity type}.
Heuristically, the arity \ab{œÅ} \ab{f} of an operation symbol \ab{f} \as{‚àà} \ab{F} may be
thought of as the number of arguments that \ab{f} takes as ``input.''
Here (and in the Agda Universal Algebra Library) we represent signatures in a very general way, as the
inhabitants of the following dependent pair type.

\begin{center}

\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{lsuc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSymbol{))}\\[4pt]
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{F}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSymbol{)}

\end{center}
Recalling our syntax for the first and second
projections, if \ab{ùëÜ} %\as{:} \af{Signature} \ab{ùìû} \ab{ùì•}
is a signature, then
\aof{‚à£} \ab{ùëÜ} \aof{‚à£} denotes the set of operation symbols and \aof{‚à•} \ab{ùëÜ} \aof{‚à•} denotes the arity function.
Thus, if \ab{f} \as{:} \aof{‚à£} \ab{ùëÜ} \aof{‚à£} is an operation symbol in the
signature \ab{ùëÜ}, then \aof{‚à•} \ab{ùëÜ} \aof{‚à•} \ab{f} is the arity of \ab{f}.

We need to augment the \af{Signature} type so that it supports algebras over setoid domains.
\ifshort\else
To do so---following Andreas Abel's lead (cf.~\cite{Abel:2021})---we
define an operator that translates an ordinary signature into a \defn{setoid signature},
that is, a signature over a setoid domain.
\fi
This raises a minor technical issue:
given operations \ab{f} and \ab{g}, with arguments
\ab{u} \as{:} \aof{‚à•} \ab{ùëÜ} \aof{‚à•} \ab{f} \as{‚Üí}\ab{A} and \ab{v} \as{:} \aof{‚à•} \ab{ùëÜ}
\aof{‚à•} \ab{g} \as{‚Üí} \ab{A}, respectively, and a proof that \ab{f} \aod{‚â°} \ab{g} (i.e.
intensionally), we ought to be able to check whether \ab u and \ab v are pointwise
equal. Technically, \ab{u} and \ab{v} appear to inhabit different types; this is where the
hypothesis \ab f \aod{‚â°} \ab g comes in, as we see in the definition of \af{EqArgs} below (adapted
from Andreas Abel's development~\cite{Abel:2021}).

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{EqArgs}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[10]\AgdaSymbol{\{}\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSymbol{\}\{}\AgdaBound{Œæ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[10]\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{EqArgs}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œæ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
\noindent
This enables us to define an operator which translates a signature for algebras over bare types into a signature for algebras over setoids.
\ifshort\else
We denote this operator by \aof{‚ü®\AgdaUnderscore{}‚ü©} and define it as follows.
\fi

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{‚ü®\AgdaUnderscore{}‚ü©}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaField{Carrier}%
\>[9]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{)}%
\>[34]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSpace{}%
\AgdaSymbol{.}\AgdaField{Carrier}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âàÀ¢\AgdaUnderscore{}}}%
\>[9]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{)(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{u}\AgdaSymbol{)(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSymbol{)}%
\>[34]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{eqv}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{EqArgs}\AgdaSymbol{\{}\AgdaArgument{Œæ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{eqv}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaBound{v}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaField{refl·µâ}%
\>[8]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{))}%
\>[60]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{reflÀ¢}%
\>[85]\AgdaBound{Œæ}\<%
\\
\>[0]\AgdaField{sym·µâ}%
\>[8]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}%
\>[60]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{symÀ¢}%
\>[85]\AgdaBound{Œæ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaField{trans·µâ}%
\>[8]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}%
\>[60]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{transÀ¢}%
\>[85]\AgdaBound{Œæ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\end{code}

%% -----------------------------------------------------------------------------
\subsection{Algebras}\label{algebras}
Informally, an \defn{algebraic structure} \ab{ùë®} = (\ab{A}, \ab{F·¥¨}) \defn{in the signature}
\ab{ùëÜ} = (\ab{F}, \ab{œÅ}), or \ab{ùëÜ}-\defn{algebra}, consists of
\begin{itemize}
\item a nonempty type \ab A, called the \defn{domain} (or \defn{carrier} or
\defn{universe}) of the algebra;
\item a collection \ab{F·¥¨} :=
  \{ \ab{f·¥¨} \as{‚à£} \ab f \as{‚àà} \ab F, \ab{f·¥¨} \as :
    (\ab{œÅ} \ab f \as{‚Üí} \ab A) \as{‚Üí} \ab A \} of \defn{operations} on \ab{A};
\item a (potentially empty) collection of \defn{identities} satisfied by elements and
operations of \ab{ùë®}.
\end{itemize}
Our \agda implementation represents algebras as inhabitants of a record type with two
fields---a \afld{Domain} setoid denoting the domain of the algebras, and an \afld{Interp} function denoting the interpretation of each operation symbol in \ab{ùëÜ}. We postpone introducing identities until~¬ß\ref{equational-logic}.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaPrimitive{lsuc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{field}%
\>[8]\AgdaField{Domain}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
%
\>[8]\AgdaField{Interp}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaField{Domain}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaField{Domain}\<%
\\
\>[0]\<%
\end{code}
Thus, for each operation symbol in \ab{ùëÜ}, we have a setoid function
\ab f, whose domain is a power of \afld{Domain}, and whose codomain is \afld{Domain}.

Further, we define some syntactic sugar to make our formalizations easier to read and comprehend.
Specifically, if \ab{ùë®} is an algebra, then
\begin{itemize}
\item \aof{ùîª[ \ab{ùë®} ]} denotes the \afld{Domain} setoid of \ab{ùë®},
\item \aof{ùïå[ \ab{ùë®} ]} is the underlying carrier of (the \afld{Domain} setoid of) \ab{ùë®}, and
\item \ab f \aof{ÃÇ} \ab{ùë®} denotes the interpretation of the operation symbol \ab f in the algebra \ab{ùë®}.
\end{itemize}
\ifshort %%% BEGIN SHORT VERSION ONLY
 We omit the straightforward formal definitions of these types (\seemedium).
\else    %%% END SHORT VERSION ONLY
         %%% BEGIN LONG VERSION ONLY SECTION
\begin{code}%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Algebra}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{ùîª[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[23]\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{Domain}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{ùïå[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[23]\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Domain}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}ÃÇ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}%
\>[48]\AgdaSymbol{‚Üí}%
\>[51]\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\<%
\end{code}
\fi

%% -----------------------------------------------------------------------------
\paragraph*{Universe levels of algebra types}
Types belong to \emph{universes}, which are structured in \agda as
follows:
\ap{Type} \ab{‚Ñì} : \ap{Type} (\ap{suc} \ab{‚Ñì}), \ap{Type} (\ap{suc} \ab{‚Ñì}) : \ap{Type}
(\ap{suc} (\ap{suc} \ab{‚Ñì})), ‚Ä¶.\footnote{\ap{suc} \ab{‚Ñì} denotes the successor of \ab{‚Ñì} in the universe hierarchy.} While this means that \ap{Type} \ab{‚Ñì} has type \ap{Type}
(\ap{suc} \ab{‚Ñì}), it does \emph{not} imply that \ap{Type} \ab{‚Ñì} has type
\ap{Type} (\ap{suc} (\ap{suc} \ab{‚Ñì})). In other words, \agda's universes are
\emph{non-cumulative}.
This can be advantageous as it becomes possible to treat size issues
more generally and precisely.  However, dealing with explicit
universe levels can be daunting, and the standard literature
(in which uniform smallness is typically assumed) offers little guidance.
\ifshort\else
This aspect of the language was one of the few stumbling
blocks we encountered while learning how to use \agda for formalizing universal algebra in
type theory. Although some may consider this to be one of the least interesting and most
technical aspects of this paper, others might find the presentation more helpful if we
resist the urge to gloss over these technicalities.
\fi
While in some settings, such as category theory, formalizing it in \agda~\cite{agda-categories}
works smoothly with respect to universe levels, in universal algebra the terrain is bumpier.
Thus, it seems worthwhile to explain how we make use
of universe lifting and lowering functions, available in the \agdastdlib, to
develop domain-specific tools for dealing with \agda's non-cumulative universe hierarchy.

\ifshort\else
Let us be more concrete about what is at issue by considering a typical example. \agda
frequently encounters problems during the type-checking process and responds by printing a
message like the following.
{\color{red}{\small
\begin{verbatim}
  HSP.lagda:498,20-23
  Œ± != ùìû ‚äî ùì• ‚äî (lsuc Œ±) when checking that... has type...
\end{verbatim}}}
\noindent Here \agda informs us that it encountered universe level \ab{Œ±} on line 498 of
the HSP module, where it was expecting level \ab{ùìû}~\aop{‚äî}~\ab{ùì•}~\aop{‚äî}~(\ap{lsuc}
\ab{Œ±}). In this case, we tried to use an algebra inhabiting the type \ar{Algebra}
\ab{Œ±} \ab{œÅ·µÉ} whereas \agda expected an inhabitant of the type \ar{Algebra} (\ab{ùìû}
\aop{‚äî} \ab{ùì•} \aop{‚äî} (\ap{lsuc} \ab{Œ±})) \ab{œÅ·µÉ}.
\fi
The \ar{Lift} operation of the standard library embeds a type into a higher universe.
Specializing \ar{Lift} to our situation, we
define a function \af{Lift-Alg}%
\ifshort
~with the following interface.
\vskip-2mm
\else
.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Level}\<%
\\
%
\>[1]\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\<%
\\
%
\>[1]\AgdaField{Domain}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{record}%
\>[10]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{\}\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{la}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{lower}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{la}\AgdaSymbol{))}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{lab}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{lab}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaField{Domain}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{record}%
\>[10]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}%
\>[37]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}%
\>[45]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[37]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}%
\>[45]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaField{lower}\<%
\\
%
\>[37]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{lower}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)(}\AgdaField{lower}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{\}\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{la}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{la}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{))(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{lab}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSymbol{(}\AgdaField{cong}\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{lab}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)))}\<%
\end{code}
\fi

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñì‚ÇÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÅ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÄ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÅ}\AgdaSymbol{)}\<%
\end{code}
\ifshort
\vskip2mm
\else
\begin{code}%
\>[0]\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÄ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÅ}\<%
\\
\>[0]\<%
\end{code}
\fi
\noindent Recall that our \ar{Algebra} type has two universe level parameters, corresponding
to those of the domain setoid.
\ifshort\else
Concretely, an algebra of type \ar{Algebra} \ab{Œ±} \ab{œÅ·µÉ} has a
\afld{Domain} of type \ar{Setoid} \ab{Œ±} \ab{œÅ·µÉ}. This packages a ``carrier set''
(\afld{Carrier}), inhabiting \ap{Type} \ab{Œ±}, with an equality on \afld{Carrier} of type
\af{Rel} \afld{Carrier} \ab{œÅ·µÉ}.
\fi
\af{Lift-Alg} takes an algebra parametrized by levels \ab{a} and \ab{œÅ·µÉ}
and constructs a new algebra whose
carrier inhabits \ap{Type} (\ab{Œ±} \ap{‚äî} \ab{‚Ñì‚ÇÄ}) with equality of type \af{Rel}
\afld{Carrier} (\ab{œÅ·µÉ} \ap{‚äî} \ab{‚Ñì‚ÇÅ}). To be useful, this lifting operation should
result in an algebra with the same semantic properties as the input algebra, which is
indeed the case
\ifshort
(\qv).
\else
as we will see in ¬ß\ref{isomorphisms}.
\fi

\paragraph*{Product Algebras}
Recall the (informal) definition of the \defn{product} of a family of
\ab{ùëÜ}-algebras.
Let \ab{Œπ} be a universe and \ab I~:~\ap{Type}~\ab{Œπ} a type (the ``indexing type'').
Then \ab{ùíú}~:~\ab I~\as{‚Üí}~\ab{Algebra}~\ab{Œ±}~\ab{œÅ·µÉ} represents
an \defn{indexed family of algebras}.
Denote by \af{‚®Ö}~\ab{ùíú} the \defn{product of algebras} in \ab{ùíú} (or \defn{product
algebra}), by which we mean the algebra whose domain is the Cartesian product \af{Œ†}~\ab
i~Íûâ~\ab I~\af{,}~\aof{ùîª[~\ab{ùíú}~\ab i~]} of the domains of the algebras in \ab{ùíú}, and
whose operations are those arising by pointwise interpretation in the obvious way: if
\ab{f} is a \ab J-ary operation symbol and if
\ab a~:~\af{Œ†}~\ab i~Íûâ~\ab I~\af{,}~\ab J~\as{‚Üí}~\aof{ùîª[~\ab{ùíú}~\ab i~]} is, for each
\ab i~:~\ab I, a \ab J-tuple of elements of the domain \aof{ùîª[~\ab{ùíú}~\ab i~]}, then
we define the interpretation of \ab f in \af{‚®Ö}~\ab{ùíú} by\\[-2mm]

(\ab{f}~\af{ÃÇ}~\af{‚®Ö}~\ab{ùíú}) \ab a := \as{Œª}~(\ab i~:~\ab I)~\as{‚Üí}
(\ab{f}~\af{ÃÇ}~\ab{ùíú}~\ab i)(\ab{a}~\ab i).\\[8pt]
Here is how we formalize the concept of product algebra in \agda.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaField{Domain}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{record}%
\>[1112I]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[.][@{}l@{}]\<[1112I]%
\>[9]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âàÀ¢\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)(}\AgdaBound{b}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\>[9]\AgdaSymbol{;}%
\>[1139I]\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1139I][@{}l@{\AgdaIndent{0}}]%
\>[12]\AgdaKeyword{record}%
\>[20]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[42]\AgdaField{refl·µâ}%
\>[50]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\<%
\\
%
\>[20]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[42]\AgdaField{sym·µâ}%
\>[50]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\>[20]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[42]\AgdaField{trans·µâ}%
\>[50]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)(}\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{flip}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{f=g}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{flip}\AgdaSpace{}%
\AgdaBound{f=g}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
\noindent Evidently, the \afld{Carrier} of the product algebra type is indeed the (dependent)
product of the carriers in the indexed family. The rest of the definitions are the ``pointwise''
versions of the underlying ones.

%% -------------------------------------------------------------------------------------
\subsection{Homomorphisms}\label{homomorphisms}
Throughout the rest of the paper, unless stated otherwise, \ab{ùë®} and \ab{ùë©}
will denote \ab{ùëÜ}-algebras inhabiting the types \af{Algebra} \ab{Œ±} \ab{œÅ·µÉ} and
\af{Algebra} \ab{Œ≤} \ab{œÅ·µá}, respectively.

A \defn{homomorphism} (or ``hom'') from
\ab{ùë®} to \ab{ùë©} is a setoid function \ab{h}~:~\aof{ùîª[~\ab{ùë®}~]} \aor{‚ü∂} \aof{ùîª[~\ab{ùë©}~]}
that is \defn{compatible} with all basic operations; that is, for
every operation symbol \ab{f} : \af{‚à£~\ab{ùëÜ}~‚à£} and all tuples
\ab{a} : \af{‚à•~\ab{ùëÜ}~‚à•}~\ab{f} \as{‚Üí} \aof{ùïå[~\ab{ùë®}~]}, we have \ab{h} \aofld{‚ü®\$‚ü©}
(\ab{f}~\af{ÃÇ}~\ab{ùë®}) \ab{a} \af{‚âà}
(\ab{f}~\af{ÃÇ}~\ab{ùë©}) \ab{h} \aofld{‚ü®\$‚ü©} (\ab{a} \au{}).\footnote{Here we use
\ab{h} \aofld{‚ü®\$‚ü©} (\ab{a} \au{}) as a shorthand for
\as{Œª} \ab x \as{‚Üí} \ab h \AgdaOperator{\AgdaField{‚ü®\$‚ü©}} (\ab a \ab x).}

It is convenient to first formalize ``compatible'' (\af{compatible-map-op}),
representing the assertion that a given setoid function
\ab{h}~:~\aof{ùîª[~\ab{ùë®}~]} \aor{‚ü∂} \aof{ùîª[~\ab{ùë©}~]} commutes with a given
operation symbol \ab{f}, and then generalize over operation symbols (\af{compatible-map}),
to yield the type of compatible maps from (the domain of) \ab{ùë®} to (the domain of) \ab{ùë©}.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{compatible-map-op}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{compatible-map-op}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{compatible-map-op}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{f}\<%
\\
\>[0]\<%
\end{code}
Using these we define the property (\ar{IsHom}) of being a homomorphism, and
finally the type \af{hom} of homomorphisms from \ab{ùë®} to \ab{ùêµ}.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaKeyword{field}\AgdaSpace{}%
\AgdaField{compatible}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaRecord{IsHom}\<%
\\
\>[0]\<%
\end{code}
Thus, an inhabitant of \af{hom} is a pair (\ab h , \ab p) consisting of
a setoid function \ab h, from the domain of \ab{ùë®} to that of \ab{ùë©}, along with
a proof \ab p that \ab h is a homomorphism.

A \defn{monomorphism} (resp. \defn{epimorphism}) is an injective (resp. surjective)
homomorphism. We define predicates \ar{IsMon} and \ar{IsEpi} for these,
 well as \af{mon} and \af{epi} for the corresponding types.
\ifshort %%% BEGIN SHORT VERSION ONLY
\else    %%% BEGIN LONG VERSION ONLY

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{IsMon}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{field}%
\>[9]\AgdaField{isHom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\>[9]\AgdaField{isInjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{HomReduct}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\<%
\\
%
\>[2]\AgdaFunction{HomReduct}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isHom}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{mon}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{mon}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaRecord{IsMon}\<%
\\
\>[0]\<%
\end{code}
As with \af{hom}, the type \af{mon} is a dependent product type; each inhabitant is a pair
consisting of a setoid function, say, \ab h, along with a proof that \ab h is a
monomorphism.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{field}%
\>[9]\AgdaField{isHom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\>[9]\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{HomReduct}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\<%
\\
%
\>[2]\AgdaFunction{HomReduct}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isHom}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{epi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{epi}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaRecord{IsEpi}\<%
\end{code}

Here are two utilities that are useful for translating between types.

\begin{code}%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{IsHom}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{IsMon}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{IsEpi}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{mon‚Üíintohom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{mon}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaFunction{mon‚Üíintohom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{hhM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isHom}\AgdaSpace{}%
\AgdaBound{hhM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isInjective}\AgdaSpace{}%
\AgdaBound{hhM}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{epi‚Üíontohom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaFunction{epi‚Üíontohom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{hhE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isHom}\AgdaSpace{}%
\AgdaBound{hhE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaBound{hhE}\<%
\end{code}

\paragraph*{Composition of homomorphisms}
\fi      %%% END LONG VERSION ONLY SECTION
The composition of homomorphisms is again a homomorphism, and similarly for epimorphisms and monomorphisms.
\ifshort
The proofs of these facts are straightforward so we omit them, but give them the names
\af{‚àò-hom} and \af{‚àò-epi} so we can refer to them below.
\else

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[10]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
%
\>[10]\AgdaSymbol{\{}\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{\}\{}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{‚àò-is-hom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{‚àò-is-hom}\AgdaSpace{}%
\AgdaBound{ghom}\AgdaSpace{}%
\AgdaBound{hhom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaFunction{c}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{compatible}\AgdaSpace{}%
\AgdaBound{ghom}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{compatible}\AgdaSpace{}%
\AgdaBound{hhom}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{‚àò-is-epi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{‚àò-is-epi}\AgdaSpace{}%
\AgdaBound{gE}\AgdaSpace{}%
\AgdaBound{hE}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}%
\>[27]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{isHom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-is-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isHom}\AgdaSpace{}%
\AgdaBound{gE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isHom}\AgdaSpace{}%
\AgdaBound{hE}\AgdaSymbol{)}\<%
\\
%
\>[27]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-IsSurjective}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaBound{gE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaBound{hE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë™}%
\>[29]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\<%
\\
%
\>[2]\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{hhom}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ghom}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚àò-is-hom}\AgdaSpace{}%
\AgdaBound{hhom}\AgdaSpace{}%
\AgdaBound{ghom}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{‚àò-epi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë™}%
\>[29]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\<%
\\
%
\>[2]\AgdaFunction{‚àò-epi}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{hepi}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{gepi}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚àò-is-epi}\AgdaSpace{}%
\AgdaBound{hepi}\AgdaSpace{}%
\AgdaBound{gepi}\<%
\end{code}

\paragraph*{Universe lifting of homomorphisms}
Here we define the identity homomorphism for setoid algebras. Then we prove that the
operations of lifting and lowering of a setoid algebra are homomorphisms.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ùëñùëë}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{Domain}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[54]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÅ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{refl‚ÇÅ}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}%
\>[54]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âàÀ°\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{reflÀ°}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}%
\>[54]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà ≥\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{refl ≥}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Level}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{FromLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{FromLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaFunction{reflÀ°}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToFromLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[22]\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLiftÀ°}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âàÀ°}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[1]\AgdaFunction{ToFromLiftÀ°}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl‚ÇÅ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{FromToLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLiftÀ°}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÅ}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[1]\AgdaFunction{FromToLiftÀ°}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl‚ÇÅ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToLift ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{ToLift ≥}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaFunction{reflÀ°}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToFromLift ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLift ≥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà ≥}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[1]\AgdaFunction{ToFromLift ≥}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaFunction{refl‚ÇÅ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{FromToLift ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLift ≥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÅ}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[1]\AgdaFunction{FromToLift ≥}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl‚ÇÅ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}%
\>[7]\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[35]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}%
\>[7]\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[35]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}%
\>[7]\AgdaModule{Level}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToLift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{ToLift}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaFunction{ToLift ≥}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{FromLift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{FromLift}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaFunction{FromLiftÀ°}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToFromLift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[1]\AgdaFunction{ToFromLift}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToLift-epi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{ToLift-epi}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}%
\>[28]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{isHom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{ToLift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[28]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ToFromLift}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}

\paragraph*{Homomorphisms of product algebras}
Suppose we have an algebra \ab{ùë®}, a type \ab I : \ap{Type} \ab{ùìò}, and a family \ab{‚Ñ¨} :
\ab I \as{‚Üí} \ar{Algebra} \ab{Œ≤} \ab{œÅ·µá} of algebras.
We sometimes refer to the inhabitants of \ab{I} as \emph{indices}, and call \ab{‚Ñ¨} an
\defn{indexed family of algebras}. If in addition we have a family \ab{ùíΩ} : (\ab i : \ab
I) ‚Üí \af{hom} \ab{ùë®} (\ab{‚Ñ¨} \ab i) of homomorphisms, then we can construct a homomorphism
from \ab{ùë®} to the product \af{‚®Ö} \ab{‚Ñ¨} in the natural way.  We codify the latter in
dependent type theory as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}(}\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)}%
\>[74]\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{‚®Ö-hom-co}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{‚®Ö-hom-co}\AgdaSpace{}%
\AgdaBound{ùíΩ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{hhom}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùíΩ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùíΩ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{xy}\<%
\\
%
\>[2]\AgdaFunction{hhom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{h}\<%
\\
%
\>[2]\AgdaField{compatible}\AgdaSpace{}%
\AgdaFunction{hhom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{compatible}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùíΩ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\end{code}

\paragraph*{Factorization of homomorphisms}
\fi      %%% END LONG VERSION ONLY SECTION
We also formalize (as \af{HomFactor}) the following factorization theorem: if \ab g : \af{hom}
\ab{ùë®} \ab{ùë©}, \ab h : \af{hom} \ab{ùë®} \ab{ùë™}, \ab h is surjective, and \af{ker} \ab h
\aof{‚äÜ} \af{ker} \ab g, then there exists \ab{œÜ} : \af{hom} \ab{ùë™} \ab{ùë©} such that \ab g
= \ab{œÜ} \aof{‚àò} \ab h.
\ifshort\else

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[2098I]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[2098I]%
\>[9]\AgdaSymbol{(}\AgdaBound{gh}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÇ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÉ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{gfunc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{gh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{gfunc}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{HomFactor}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[14]\AgdaFunction{kernel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚âà‚ÇÉ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{kernel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚âà‚ÇÇ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{g}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{‚Üí}%
\>[14]\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\>[2]\AgdaSymbol{‚Üí}%
\>[14]\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÇ}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[1]\AgdaFunction{HomFactor}\AgdaSpace{}%
\AgdaBound{Khg}\AgdaSpace{}%
\AgdaBound{hE}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{œÜhom}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{gœÜh}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{SurjInv}\AgdaSpace{}%
\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaBound{hE}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÉ}}\AgdaSpace{}%
\AgdaBound{c}\<%
\\
%
\>[2]\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{InvIsInverse ≥}\AgdaSpace{}%
\AgdaBound{hE}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÉ}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÉ}}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaFunction{Œ∑}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaFunction{h‚Åª¬π}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Khg}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaFunction{Œ∂}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}‚ü∂\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{œÜcong}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{gœÜh}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÇ}}\AgdaSpace{}%
\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[2]\AgdaFunction{gœÜh}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Khg}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaFunction{Œ∑}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{œÜcomp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{œÜmap}\<%
\\
%
\>[2]\AgdaFunction{œÜcomp}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[3][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[14]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSymbol{)}%
\>[40]\AgdaBound{c}%
\>[48]\AgdaFunction{‚âàÀò‚ü®}%
\>[53]\AgdaFunction{œÜcong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Œ∑}\AgdaSymbol{))}%
\>[97]\AgdaFunction{‚ü©}\<%
\\
%
\>[4]\AgdaFunction{g}\AgdaSymbol{(}\AgdaFunction{h‚Åª¬π}\AgdaSymbol{(}%
\>[14]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSymbol{)}%
\>[23]\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}%
\>[31]\AgdaFunction{h‚Åª¬π}%
\>[36]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[39]\AgdaBound{c}%
\>[42]\AgdaSymbol{)))}%
\>[48]\AgdaFunction{‚âàÀò‚ü®}%
\>[53]\AgdaFunction{œÜcong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{compatible}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}%
\>[97]\AgdaFunction{‚ü©}\<%
\\
%
\>[4]\AgdaFunction{g}\AgdaSymbol{(}\AgdaFunction{h‚Åª¬π}\AgdaSymbol{(}\AgdaFunction{h}\AgdaSymbol{(}%
\>[14]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}%
\>[23]\AgdaSymbol{(}%
\>[31]\AgdaFunction{h‚Åª¬π}%
\>[36]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[39]\AgdaBound{c}%
\>[42]\AgdaSymbol{))))}%
\>[48]\AgdaFunction{‚âàÀò‚ü®}%
\>[53]\AgdaFunction{gœÜh}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)(}\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{))}%
\>[97]\AgdaFunction{‚ü©}\<%
\\
%
\>[4]\AgdaFunction{g}\AgdaSymbol{(}%
\>[14]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}%
\>[23]\AgdaSymbol{(}%
\>[31]\AgdaFunction{h‚Åª¬π}%
\>[36]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[39]\AgdaBound{c}%
\>[42]\AgdaSymbol{))}%
\>[48]\AgdaFunction{‚âà‚ü®}%
\>[53]\AgdaField{compatible}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{gh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}%
\>[97]\AgdaFunction{‚ü©}\<%
\\
%
\>[14]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}%
\>[23]\AgdaSymbol{(}\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[31]\AgdaFunction{h‚Åª¬π}%
\>[36]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[39]\AgdaBound{c}%
\>[42]\AgdaSymbol{))}%
\>[48]\AgdaOperator{\AgdaFunction{‚àé}}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{œÜhom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{œÜmap}\<%
\\
%
\>[2]\AgdaField{compatible}\AgdaSpace{}%
\AgdaFunction{œÜhom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{œÜcomp}\<%
\end{code}

\subsection{Isomorphisms}
\label{isomorphisms}
\fi      %%% END LONG VERSION ONLY SECTION

Two structures are \defn{isomorphic} provided there are homomorphisms from each to the
other that compose to the identity. We codify this notion, as
well as some of its obvious consequences, as the type \ar{\au{}‚âÖ\au{}}.
\ifshort
\else
Note that the definition, shown below, includes a proof of the fact that the maps \afld{to} and
\afld{from} are bijective, which makes this fact more accessible.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà·¥¨\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà·¥Æ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{constructor}%
\>[15]\AgdaInductiveConstructor{mkiso}\<%
\\
%
\>[2]\AgdaKeyword{field}%
\>[15]\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\<%
\\
%
\>[15]\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[15]\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}%
\>[41]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}%
\>[56]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}%
\>[64]\AgdaOperator{\AgdaFunction{‚âà·¥Æ}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[15]\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}%
\>[41]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}%
\>[56]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}%
\>[64]\AgdaOperator{\AgdaFunction{‚âà·¥¨}}\AgdaSpace{}%
\AgdaBound{a}\<%
\end{code}
\ifshort
Moreover, \afld{to} and \afld{from} are bijections
and \ar{\au{}‚âÖ\au{}} is an equivalence relation (\seemedium).
\else
\begin{code}%
\>[0]\<%
\\
%
\>[2]\AgdaFunction{toIsSurjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{toIsSurjective}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{toIsInjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{toIsInjective}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà·¥¨}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{xy}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{fromIsSurjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{fromIsSurjective}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{fromIsInjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{fromIsInjective}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà·¥Æ}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{xy}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaOperator{\AgdaModule{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\<%
\\
\>[0]\<%
\end{code}

It is easy to prove that \ar{\au{}‚âÖ\au{}} is an equivalence relation, as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{‚âÖ-refl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Reflexive}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaGeneralizable{Œ±}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\})}\<%
\\
\>[0]\AgdaFunction{‚âÖ-refl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{‚âÖ-sym}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSymbol{\{}\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSymbol{\{}\AgdaGeneralizable{Œ±}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\})}\<%
\\
\>[0]\AgdaFunction{‚âÖ-sym}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{‚âÖ-trans}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaGeneralizable{Œ±}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSymbol{\{}\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSymbol{\{}\AgdaGeneralizable{Œ±}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaGeneralizable{Œ≥}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\})}\<%
\\
\>[0]\AgdaFunction{‚âÖ-trans}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{œÅ·∂ú}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{œÅ·∂ú}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSymbol{\}\{}\AgdaBound{ùë™}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaFunction{f}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaFunction{œÑ}\AgdaSpace{}%
\AgdaFunction{ŒΩ}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}%
\>[29]\AgdaSymbol{;}%
\>[32]\AgdaFunction{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[2]\AgdaFunction{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSymbol{)}%
\>[29]\AgdaSymbol{;}%
\>[32]\AgdaFunction{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà·∂ú\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{trans·∂ú}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{œÑ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà·∂ú}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[2]\AgdaFunction{œÑ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans·∂ú}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{ŒΩ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[2]\AgdaFunction{ŒΩ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\<%
\end{code}
\fi
\paragraph*{Lift-Alg is an algebraic invariant}
The \af{Lift-Alg} operation neatly resolves the technical problem of
universe non-cumulativity because isomorphism classes of algebras are closed under \af{Lift-Alg}; that is,
\ifshort\else

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{Lift-‚âÖÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{Lift-‚âÖÀ°}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaFunction{FromLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ToFromLiftÀ°}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{FromToLiftÀ°}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSymbol{\})}\<%
\\
%
\>[1]\AgdaFunction{Lift-‚âÖ ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{Lift-‚âÖ ≥}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaFunction{ToLift ≥}\AgdaSpace{}%
\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ToFromLift ≥}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{FromToLift ≥}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSymbol{\})}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{Lift-‚âÖ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0]\AgdaFunction{Lift-‚âÖ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚âÖ-trans}\AgdaSpace{}%
\AgdaFunction{Lift-‚âÖÀ°}\AgdaSpace{}%
\AgdaFunction{Lift-‚âÖ ≥}\<%
\end{code}
\fi

\paragraph*{Homomorphic images}
We have found that the most useful way to encode the concept of \emph{homomorphic image}
is to produce a witness, that is, a surjective hom.  Thus we define the type of surjective homs
and also record the fact that an algebra is its own homomorphic image via the identity
hom.\footnote{Here and elsewhere we use the shorthand \af{ov}~\ab{Œ±} := \ab{ùí™}
\ap{‚äî} \ab{ùí±} \ap{‚äî} \ab{Œ±}, for any level \ab{Œ±}.}

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{ov}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPostulate{Level}\<%
\\
\>[0]\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaPrimitive{lsuc}\AgdaSpace{}%
\AgdaBound{Œ±}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}IsHomImageOf\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{HomImages}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{HomImages}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSymbol{\}\{}\AgdaArgument{œÅ·µá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{IdHomImage}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\AgdaFunction{IdHomImage}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œ±}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{Image\AgdaUnderscore{}‚àã\AgdaUnderscore{}.eq}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\ifshort\else    %%% BEGIN LONG VERSION ONLY

\medskip

\noindent These types should be self-explanatory, but just to be sure, we pause
to describe the semantics of the Sigma type appearing in the definition of \af{HomImages}.
If \ab{ùë®} : \af{Algebra} \ab{Œ±} \ab{œÅ·µÉ} is an \ab{ùëÜ}-algebra, then \af{HomImages} \ab{ùë®}
denotes the type of pairs (\ab{ùë©} \aic{,} \ab p) such that \ab{ùë©} : \ar{Algebra} \ab{Œ≤} \ab{œÅ·µá}
and \ab p is a proof that there exists a hom from \ab{ùë®} onto \ab{ùë©}.
\fi      %%% END LONG VERSION ONLY SECTION

%% -------------------------------------------------------------------------------------
\subsection{Subalgebras}
\label{subalgebras}
Given \ab{ùëÜ}-algebras \ab{ùë®} and \ab{ùë©}, we say that \ab{ùë®} is a \defn{subalgebra} of
\ab{ùë®}, and we write \ab{ùë®}~\aof{‚â§}~\ab{ùë©}, just in case \ab{ùë®} can be \emph{homomorphically
embedded} in \ab{ùë©}; in other terms, \ab{ùë®}~\aof{‚â§}~\ab{ùë©} if and only if there exists an injective
hom from \ab{ùë®} to \ab{ùë©}.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚â§\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
\>[0]\<%
\end{code}
The subalgebra relation is a \defn{preorder}, that is, a reflexive (by the identity monomorphism), and
transitive (by composition of monomorphisms) relation.
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{‚â§-reflexive}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\AgdaFunction{‚â§-reflexive}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{id}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{‚â§-transitive}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[17]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë™}\<%
\\
\>[0]\AgdaFunction{‚â§-transitive}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{finj}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ginj}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚àò-IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{finj}\AgdaSpace{}%
\AgdaBound{ginj}\<%
\\
\>[0]\<%
\end{code}
\noindent If
\ab{ùíú} : \ab I ‚Üí \af{Algebra} \ab{Œ±} \ab{œÅ·µÉ},
\ab{‚Ñ¨} : \ab I ‚Üí \af{Algebra} \ab{Œ≤} \ab{œÅ·µá} (families of \ab{ùëÜ}-algebras) and
\ab{‚Ñ¨} \ab i \af{‚â§} \ab{ùíú} \ab i for all \ab i~:~\ab I, then \af{‚®Ö} \ab{‚Ñ¨} is a subalgebra
of \af{‚®Ö} \ab{ùíú}.
\ifshort
Below we use \af{‚®Ö-‚â§} to denote this fact.
\else

\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{\}\{}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{‚®Ö-‚â§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\<%
\\
%
\>[1]\AgdaFunction{‚®Ö-‚â§}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{hhom}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{hM}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{hi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{hi}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{B‚â§A}\<%
\\
%
\>[2]\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{hi}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{hi}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{hhom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\>[2]\AgdaField{compatible}\AgdaSpace{}%
\AgdaFunction{hhom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{compatible}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{hi}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[2]\AgdaFunction{hM}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\>[2]\AgdaFunction{hM}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}

We conclude this section with two easy facts that will be useful later. The first converts a monomorphism
to a subalgebra witness while the second is an algebraic invariance property of \aof{‚â§}.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{mon‚Üí‚â§}%
\>[11]\AgdaSymbol{:}%
\>[14]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{mon}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë©}\<%
\\
\>[0]\AgdaFunction{mon‚Üí‚â§}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mon‚Üíintohom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{‚âÖ-trans-‚â§}%
\>[11]\AgdaSymbol{:}%
\>[14]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[14]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë™}\<%
\\
\>[0]\AgdaFunction{‚âÖ-trans-‚â§}\AgdaSpace{}%
\AgdaBound{A‚âÖB}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{hinj}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{A‚âÖB}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚àò-IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaBound{A‚âÖB}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{toIsInjective}\AgdaSpace{}%
\AgdaBound{A‚âÖB}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{hinj}\AgdaSymbol{)}\<%
\end{code}
\fi

%% -------------------------------------------------------------------------------------

\subsection{Terms}
\label{terms}
Fix a signature \ab{ùëÜ} and let \ab X denote an arbitrary nonempty collection of variable
symbols. Such a collection is called a \defn{context}.
Assume the symbols in \ab X are distinct from the operation symbols of
\ab{ùëÜ}, that is \ab X \aof{‚à©} \aof{‚à£} \ab{ùëÜ} \aof{‚à£} = ‚àÖ.
A \defn{word} in the language of \ab{ùëÜ} is a finite sequence of members of \ab X \aof{‚à™}
\aof{‚à£~\ab{ùëÜ}~‚à£}. We denote the concatenation of such sequences by simple juxtaposition.
Let \ab{S‚ÇÄ} denote the set of nullary operation symbols of \ab{ùëÜ}. We define by induction
on \textit{n} the sets \ab{ùëá‚Çô} of \emph{words} over \ab X \aof{‚à™} \aof{‚à£~\ab{ùëÜ}~‚à£} as
follows (cf.~\cite[Def. 4.19]{Bergman:2012}): \ab{ùëá‚ÇÄ} := \ab X \aof{‚à™} \ab{S‚ÇÄ} and
\ab{ùëá‚Çô‚Çä‚ÇÅ} := \ab{ùëá‚Çô} \aof{‚à™} \ab{ùíØ‚Çô}, where \ab{ùíØ‚Çô} is the collection of all \ab f \ab t
such that \ab f : \aof{‚à£~\ab{ùëÜ}~‚à£} and \ab t : \aof{‚à•~\ab{ùëÜ}~‚à•} \ab f \as{‚Üí}
\ab{ùëá‚Çô}.
\ifshort\else
(Recall, \aof{‚à•~\ab{ùëÜ}~‚à•} \ab f is the arity of the operation symbol \ab f.)
\fi
An \ab{ùëÜ}-\defn{term} is a term in the language of \ab{ùëÜ} and the collection of all
\ab{ùëÜ}-\defn{terms} in the context \ab X is given by \Term{X} := \aof{‚ãÉ‚Çô} \ab{ùëá‚Çô}.

In type theory, this translates to two cases: variable injection and applying an
operation symbol to a tuple of terms. This represents each term as a tree
with an operation symbol at each \aic{node} and a variable symbol at each leaf \aic{‚Ñä};
hence the constructor names (\aic{‚Ñä} for ``generator'' and \aic{node} for ``node'') in the
following inductively defined type.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)}%
\>[39]\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\>[1]\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)(}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\<%
\end{code}

\paragraph*{The term algebra}
We enrich the \ad{Term} type to a setoid of  \ab{ùëÜ}-terms, which will ultimately
be used as the domain of an algebra, called the \emph{term algebra in the signature} \ab{ùëÜ}.
For this we need an equivalence relation on terms.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
It is straightforward to show that \ad{\au{}‚âÉ\au{}} is an equivalence relation,
\ifshort
and we refer to this fact as \af{‚âÉ-isEquiv} below.
\else
as follows.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{‚âÉ-isRefl}%
\>[12]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Reflexive}%
\>[29]\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isRefl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isRefl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isRefl}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚âÉ-isSym}%
\>[12]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Symmetric}%
\>[29]\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isSym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚â°.sym}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isSym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isSym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚âÉ-isTrans}%
\>[12]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Transitive}%
\>[29]\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isTrans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚â°.trans}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isTrans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isTrans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚âÉ-isEquiv}%
\>[12]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}%
\>[29]\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isEquiv}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isRefl}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isSym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isTrans}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}
\fi

We now define, for a given signature \ab{ùëÜ} and context \ab X,
%if the type \Term{X} is nonempty (equivalently, if \ab X or
%\aof{‚à£~\ab{ùëÜ}~‚à£} is nonempty), then
the algebraic structure \T{X}, known as the \defn{term algebra in} \ab{ùëÜ} \defn{over} \ab
X.  Terms are viewed as acting on other terms, so both the elements of the domain of \T{X}
and its basic operations are terms themselves. That is, for each operation symbol \ab
f : \aof{‚à£~\ab{ùëÜ}~‚à£}, we denote by \ab f~\aof{ÃÇ}~\T{X} the operation on \Term{X} that maps
each tuple of terms, say, \ab t : \aof{‚à•~\ab{ùëÜ}~‚à•} \ab f \as{‚Üí} \Term{X}, to the formal
term \ab f \ab t.
%We let \T{X} denote the term algebra in \ab{ùëÜ} over \ab X; it has universe \Term{X} and
%operations \ab f \aof{ÃÇ} (\T{X}), one for each symbol \ab f in \aof{‚à£~\ab{ùëÜ}~‚à£}.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{TermSetoid}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaFunction{TermSetoid}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isEquiv}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaField{Algebra.Domain}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{TermSetoid}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
\>[0]\AgdaField{Algebra.Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ts}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ts}\<%
\\
\>[0]\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Algebra.Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ss‚âÉts}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaBound{ss‚âÉts}\<%
\end{code}

\paragraph*{Substitution, environments and interpretation of terms}
The approach to formalizing these three concepts is based on similar code developed by
Andreas Abel to formalize Birkhoff's completeness theorem~\cite{Abel:2021}.
\ifshort\else

Recall that the domain of an algebra \ab{ùë®} is a setoid, which we denote by
\af{ùîª[~\ab{ùë®}~]}, whose \afld{Carrier} is the carrier of the algebra, \af{ùïå[~\ab{ùë®}~]},
and whose equivalence relation represents equality of elements in \af{ùïå[~\ab{ùë®}~]}.
\fi
\af{Sub} performs substitution from one context to
another.  Specifically, if \ab X and \ab Y are contexts, then \af{Sub} \ab X \ab Y
assigns a term in \ab X to each symbol in \ab Y.
A substitution \ab{œÉ} applied to a term \ab t is denoted by \af{[~\ab{œÉ}~]} \ab t.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{[\AgdaUnderscore{}]\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ts}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ts}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\<%
\\
\>[0]\<%
\end{code}

Fix a signature \ab{ùëÜ}, a context \ab X, and an \ab{ùëÜ}-algebra \ab{ùë®}.
An \defn{environment} \ab{ùë®} for \ab X is an \ab X indexed family of setoids,
where the equivalence is taken pointwise.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{Env}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}%
\>[17]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[17]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{œÑ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{œÑ}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[17]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}%
\>[43]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}%
\>[52]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}%
\>[63]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[43]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}%
\>[52]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}%
\>[63]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[43]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}%
\>[52]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}%
\>[63]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)(}\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}\}}\<%
\\
\>[0]\<%
\end{code}
As the above definition, as well as the next, are relative to a fixed algebra, we use
a submodule to succinctly capture this commonality in the definitions.
The function \af{‚ü¶\au{}‚üß} then denotes the \defn{interpretation} of
a term in a given algebra, \emph{evaluated} in a given environment.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}(}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[18]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{args}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[18]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{args}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{u‚âàv}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{u‚âàv}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{args}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{x‚âày}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{args}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{x‚âày}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}

Two terms are proclaimed \defn{equal} if they are equal for all
environments.  We represent this equivalence of terms
\ifshort\else
and proof that it is an equivalence relation,
\fi
as follows.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}(}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
\>[0]\<%
\end{code}
\ifshort
Proof that \af{Equal} is an equivalence relation, and that the implication \ab
s~\af{‚âÉ}~\ab t \as{‚Üí} \af{Equal} \ab s \ab t holds for all terms \ab s and \ab t, is
straightforward (\seemedium).
(We denote these by \af{EqualIsEquiv} and \af{‚âÉ‚ÜíEqual} in the sequel.)
\else
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}(}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{‚Ñä}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{\AgdaUnderscore{})}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{‚Ñä}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{\AgdaUnderscore{})}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{)(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)(}\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSymbol{(}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)(}\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSymbol{\})}\<%
\\
%
\>[1]\AgdaField{refl·µâ}%
\>[9]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}%
\>[35]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[1]\AgdaField{sym·µâ}%
\>[9]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x=y}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[35]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x=y}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaField{trans·µâ}%
\>[9]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{ij}\AgdaSpace{}%
\AgdaBound{jk}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[35]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ij}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{jk}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
\fi

We can then prove that substitution and evaluation commute.  More precisely,
applying substitution \ab{œÉ} to a term \ab{t}
and evaluating the result in environment \ab{œÅ} has the same effect as evaluating
\ab{t} in the environment \as{Œª} \ab x \as{‚Üí} \aof{‚ü¶~\ab{œÉ}~\ab{x}~‚üß}~\aofld{‚ü®\$‚ü©}
\ab{œÅ} (see~\cite{Abel:2021} or~\cite[Lem.~3.3.11]{Mitchell:1996}).

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{‚Üí}%
\>[17]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}%
\>[27]\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[1]\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ts}\AgdaSymbol{)}%
\>[27]\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ts}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}

\ifshort\else
\paragraph*{Compatibility of terms}
\fi
We need to formalize two more concepts involving terms.
The first is the assertion that every term commutes with every homomorphism (\af{comm-hom-term}), and
the second is the interpretation of a term in a product algebra (\af{interp-prod}).
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[46]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}%
\>[66]\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß·¥Æ}}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[46]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[66]\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[46]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}%
\>[66]\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥Æ}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a}%
\>[29]\AgdaSymbol{=}%
\>[35]\AgdaFunction{refl}\<%
\\
%
\>[1]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a}%
\>[29]\AgdaSymbol{=}%
\>[35]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{h}\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}%
\>[35]\AgdaFunction{‚âà‚ü®}\AgdaSpace{}%
\AgdaField{compatible}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{‚ü©}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{))}%
\>[35]\AgdaFunction{‚âà‚ü®}\AgdaSpace{}%
\AgdaField{cong}\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaFunction{‚ü©}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥Æ}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}%
\>[35]\AgdaOperator{\AgdaFunction{‚àé}}\AgdaSpace{}%
\AgdaKeyword{where}%
\>[44]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[23]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}%
\>[23]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[37]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[57]\AgdaOperator{\AgdaFunction{‚âà}}%
\>[61]\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[1]\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}%
\>[25]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{i}%
\>[34]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isRefl}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[1]\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}%
\>[25]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[34]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{j}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}

\section{Equational Logic}
\label{equational-logic}

\paragraph*{Term identities, equational theories, and the ‚äß relation}
Given a signature \ab{ùëÜ} and a context \ab X, an \ab{ùëÜ}-\defn{term equation} or \ab{ùëÜ}-\defn{term identity}
is an ordered pair (\ab p , \ab q) of ùëÜ-terms, also denoted by \ab p \af{‚âà} \ab q.
They are often simply called equations or identities, especially when the signature \ab{ùëÜ} is clear.

We define an \defn{equational theory} (or \defn{algebraic theory}) to be a pair \ab{T} =
(\ab{ùëÜ} , \ab{‚Ñ∞·µÄ}) consisting of a signature \ab{ùëÜ} and a collection \ab{‚Ñ∞·µÄ} of
\ab{ùëÜ}-term equations. Some authors reserve the term \defn{theory} for
a \emph{deductively closed} set of equations, that is, a set of equations that is closed
under \emph{entailment} (defined below).

We say that the algebra \ab{ùë®} \emph{satisfies} the equation \ab p \af{‚âà} \ab q if,
for all \ab{œÅ} : \ab X \as{‚Üí} \aof{ùîª[~\ab{ùë®}~]},
%(assigning values in the domain of \ab{ùë®} to variable symbols in \ab X)
we have \aof{‚ü¶~\ab{p}~‚üß} \aofld{‚ü®\$‚ü©} \ab{œÅ} \af{‚âà} \aof{‚ü¶~\ab{q}~‚üß} \aofld{‚ü®\$‚ü©} \ab{œÅ}.
In other words, when they are interpreted in the algebra \ab{ùë®},
the terms \ab{p} and \ab{q} are equal no matter what values in \ab{ùë®} are assigned to variable symbols in \ab{X}.
In this situation, we write
\ab{ùë®}~\aof{‚äß}~\ab{p}~\aof{‚âà}~\ab{q} and say that \ab{ùë®} \defn{models} \ab{p}~\af{‚âà}~\ab{q},
or that \ab{ùë®} is a \defn{model} of \ab{p}~\af{‚âà}~\ab{q}.
If \ab{ùí¶} is a class of algebras, all of the same signature, we write \ab{ùí¶}~\aof{‚ä´}~\ab{p}~\aof{‚âà}~\ab{q}
and say that \ab{ùí¶} \defn{models} the identity \ab{p}~\af{‚âà}~\ab{q} provided for every \ab{ùë®} \aof{‚àà} \ab{ùí¶}
we have \ab{ùë®}~\aof{‚äß}~\ab{p}~\aof{‚âà}~\ab{q}.

\ifshort\else
\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚äß\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚ä´\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
\>[0]\<%
\end{code}
We represent a set of identities as a predicate over pairs of
terms, say, \ab{‚Ñ∞} : \af{Pred}(\ad{Term} \ab{X} \af{√ó} \ad{Term} \ab{X})~\au{}  and we denote by
\ab{ùë®}~\aof{‚ä®}~\ab{‚Ñ∞} the assertion that the algebra \ab{ùë®} models \ab{p}~\af{‚âà}~\ab{q}
for all (\ab{p} , \ab{q}) \af{‚àà} \ab{‚Ñ∞}.\footnote{Notice that \af{‚ä®} is
a stretched version of the models symbol, \af{‚äß}%
\ifshort
.
\else
; this makes it possible for \agda to distinguish and parse expressions involving the types
\af{\au{}‚ä®\au{}} and \af{\au{}‚äß\au{}‚âà\au{}}.
In Emacs \texttt{agda2-mode}, the symbol \af{‚ä®} is produced by typing
\textbackslash\textbar{}=, while \af{‚äß} is
produced with \textbackslash{}models.
\fi
}

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚ä®\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä®}}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\<%
\end{code}

If \ab{ùí¶} is a class of structures and \ab{‚Ñ∞} a set of term identities, then the set of
term equations modeled by \ab{ùí¶} is denoted by \af{Th}~\ab{ùí¶} and is called the
\defn{equational theory} of \ab{ùí¶}, while the class of structures modeling \ab{‚Ñ∞} is
denoted by \af{Mod}~\ab{‚Ñ∞} and is called the \defn{equational class axiomatized} by
\ab{‚Ñ∞}.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\end{code}

\paragraph*{Entailment}

If \ab{‚Ñ∞} is a set of \ab{ùëÜ}-term equations and \ab{p} and \ab{q} are \ab{ùëÜ}-terms,
we say that \ab{‚Ñ∞} \defn{entails} the equation \ab{p}~\aof{‚âà}~\ab{q}, and we write
\ab{‚Ñ∞}~\ad{‚ä¢}~\ab{p}~\ad{‚âà}~\ab{q}, just in case every model of \ab{‚Ñ∞} also models
\ab{p}~\aof{‚âà}~\ab{q}.
We model our definition of \defn{entailment type} on the one defined by Abel
in~\cite{Abel:2021}.  It contains cases for representing hypotheses, congruence of term
application, that substitution respects entailment, and that entailment is
an equivalence.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚ä¢\AgdaUnderscore{}‚ñπ\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}%
\>[14]\AgdaSymbol{(}\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
%
\>[14]\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)(}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaInductiveConstructor{hyp}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{Y}\AgdaSymbol{\}\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaInductiveConstructor{app}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{Y}\AgdaSymbol{\}\{}\AgdaBound{ps}%
\>[4261I]\AgdaBound{qs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaGeneralizable{ùëì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{\}}\<%
\\
\>[4261I][@{}l@{\AgdaIndent{0}}]%
\>[26]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{ps}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{qs}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaGeneralizable{ùëì}\AgdaSpace{}%
\AgdaBound{ps}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaGeneralizable{ùëì}\AgdaSpace{}%
\AgdaBound{qs}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaInductiveConstructor{sub}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}%
\>[26]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaGeneralizable{Œî}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œî}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaInductiveConstructor{reflexive}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSymbol{\}}%
\>[26]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
%
\>[1]\AgdaInductiveConstructor{symmetric}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}%
\>[26]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
%
\>[1]\AgdaInductiveConstructor{transitive}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{\}}%
\>[26]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{r}\<%
\\
\>[0]\<%
\end{code}

The fact that this exactly represents the informal semantic notion of entailment
given earlier is called \defn{soundness} and
\defn{completeness}.
More precisely, \defn{the entailment type is sound} means that
if \ab{‚Ñ∞}~\ad{‚ä¢}~\ab{X}~\ad{‚ñπ}~\ab p~\ad{‚âà}~\ab q, then \ab p \aof{‚âà} \ab q holds in
every model of \ab{‚Ñ∞}.
\defn{The entailment type is complete} means that
if \ab p \aof{‚âà} \ab q holds in every model of \ab{‚Ñ∞},
then \ab{‚Ñ∞}~\ad{‚ä¢}~\ab{X}~\ad{‚ñπ}~\ab p~\aof{‚âà}~\ab q.
We will use soundness of entailment only once below%
\ifshort
~(by the name \af{sound}), so we omit its proof, but see~\cite{Abel:2021}
or~\cite{DeMeo:2021}.
\else
; nonetheless, here is its formalization (essentially due to Abel, \textit{op. cit.}):

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Soundness}%
\>[18]\AgdaSymbol{(}\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{))}\<%
\\
%
\>[18]\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}%
\>[52]\AgdaComment{--\ We\ assume\ an\ algebra\ ùë®}\<%
\\
%
\>[18]\AgdaSymbol{(}\AgdaBound{V}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{Y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚ä®\AgdaUnderscore{}}}\AgdaSymbol{\{}\AgdaArgument{œá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñ∞}\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSymbol{\}))}%
\>[52]\AgdaComment{--\ that\ models\ all\ equations\ in\ ‚Ñ∞.}\<%
\\
%
\>[18]\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{hyp}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{app}\AgdaSpace{}%
\AgdaBound{es}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{es}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{sub}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Epq}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{p}%
\>[14]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[40]\AgdaBound{œÅ}%
\>[44]\AgdaFunction{‚âà‚ü®}%
\>[49]\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[82]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}%
\>[14]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[40]\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[44]\AgdaFunction{‚âà‚ü®}%
\>[49]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaBound{Epq}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[82]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}%
\>[14]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[40]\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[44]\AgdaFunction{‚âàÀò‚ü®}%
\>[49]\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[82]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{q}%
\>[14]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[40]\AgdaBound{œÅ}%
\>[44]\AgdaOperator{\AgdaFunction{‚àé}}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{reflexive}%
\>[20]\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}}%
\>[44]\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{refl·µâ}%
\>[56]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{symmetric}%
\>[20]\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}%
\>[35]\AgdaBound{Epq}%
\>[44]\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{sym·µâ}%
\>[56]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}%
\>[84]\AgdaSymbol{(}\AgdaFunction{sound}\AgdaSpace{}%
\AgdaBound{Epq}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{transitive}%
\>[20]\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}\{}\AgdaBound{r}\AgdaSymbol{\}}%
\>[35]\AgdaBound{Epq}\AgdaSpace{}%
\AgdaBound{Eqr}%
\>[44]\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{trans·µâ}%
\>[56]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}\{}\AgdaBound{r}\AgdaSymbol{\}}%
\>[84]\AgdaSymbol{(}\AgdaFunction{sound}\AgdaSpace{}%
\AgdaBound{Epq}\AgdaSymbol{)(}\AgdaFunction{sound}\AgdaSpace{}%
\AgdaBound{Eqr}\AgdaSymbol{)}\<%
\end{code}
\fi

\paragraph*{The Closure Operators H, S, P and V}
Fix a signature \ab{ùëÜ}, let \ab{ùí¶} be a class of \ab{ùëÜ}-algebras, and define
\begin{itemize}
\item \af H \ab{ùí¶} = algebras isomorphic to homomorphic images of members of \ab{ùí¶};
\item \af S \ab{ùí¶} = algebras isomorphic to subalgebras of members of \ab{ùí¶};
\item \af P \ab{ùí¶} = algebras isomorphic to products of members of \ab{ùí¶}.
\end{itemize}
\ifshort\else
A straight-forward verification confirms that
\fi
\af H, \af S, and \af P are \emph{closure operators} (expansive, monotone, and
idempotent).  A class \ab{ùí¶} of \ab{ùëÜ}-algebras is said to be \emph{closed under
the taking of homomorphic images} provided \af H \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶}. Similarly, \ab{ùí¶} is
\emph{closed under the taking of subalgebras} (resp., \emph{arbitrary products}) provided
\af S~\ab{ùí¶}~\aof{‚äÜ}~\ab{ùí¶} (resp., \af P \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶}). The operators \af H, \af
S, and \af P can be composed with one another repeatedly, forming yet more closure
operators.

% An algebra is a homomorphic image (resp., subalgebra; resp., product) of every algebra to which it is isomorphic.
% Thus, the class \af H \ab{ùí¶} (resp., \af S \ab{ùí¶}; resp., \af P \ab{ùí¶}) is closed under isomorphism.

A \emph{variety} is a class of \ab{ùëÜ}-algebras that is closed under the taking of
homomorphic images, subalgebras, and arbitrary products.  To represent varieties
we define closure operators \af H, \af S, and \af P that are composable; we
then define a type \af V which represents closure under all three.
Thus, if \ab{ùí¶} is a class of \ab{ùëÜ}-algebras, then
\af V \ab{ùí¶} := \af H (\af S (\af P \ab{ùí¶})), and \ab{ùí¶} is a variety if and only if \af V \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶}.
\ifshort\else

We now define the type \af H to represent classes of algebras that include all homomorphic images
of algebras in the class---i.e., classes that are closed under the taking of homomorphic
images---the type \af S to represent classes of algebras that closed under the taking of subalgebras,
and the type \af P to represent classes of algebras closed under the taking of arbitrary products.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\<%
\\
%
\>[1]\AgdaFunction{H}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{H}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{))}\<%
\\
\>[0]\<%
\end{code}
Finally, we define the \defn{varietal closure} of a class \ab{ùí¶} to be the class \af{V}
\ab{ùí¶} := \af{H} (\af{S} (\af{P} \ab{ùí¶})).  The explicit universe level declarations
are needed for disambiguation.
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[10]\AgdaSymbol{\{}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSpace{}%
\AgdaBound{Œ≥}\AgdaSpace{}%
\AgdaBound{œÅ·∂ú}\AgdaSpace{}%
\AgdaBound{Œ¥}\AgdaSpace{}%
\AgdaBound{œÅ·µà}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\<%
\\
%
\>[1]\AgdaFunction{V}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[46]\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ¥}\AgdaSpace{}%
\AgdaBound{œÅ·µà}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{H}\AgdaSymbol{\{}\AgdaBound{Œ≥}\AgdaSymbol{\}\{}\AgdaBound{œÅ·∂ú}\AgdaSymbol{\}\{}\AgdaBound{Œ¥}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µà}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{b}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSymbol{\{}\AgdaBound{Œ≤}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\<%
\\
\>[0]\<%
\end{code}

An important property of the binary relation \aof{‚äß} is \emph{algebraic invariance} (i.e.,
invariance under isomorphism).  We formalize this result as follows.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)(}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{‚äß-I-invar}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}%
\>[24]\AgdaSymbol{‚Üí}%
\>[27]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaBound{ùë©}%
\>[34]\AgdaSymbol{‚Üí}%
\>[37]\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{‚äß-I-invar}\AgdaSpace{}%
\AgdaBound{Apq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaBound{fh}\AgdaSpace{}%
\AgdaBound{gh}\AgdaSpace{}%
\AgdaBound{f‚àºg}\AgdaSpace{}%
\AgdaBound{g‚àºf}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[32]\AgdaBound{œÅ}%
\>[37]\AgdaFunction{‚âàÀò‚ü®}%
\>[42]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f‚àºg}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{f}%
\>[22]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[25]\AgdaSymbol{(}\AgdaFunction{g}%
\>[29]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[32]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[37]\AgdaFunction{‚âàÀò‚ü®}%
\>[42]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaBound{fh}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{f}\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[25]\AgdaSymbol{(}\AgdaFunction{g}%
\>[29]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[32]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[37]\AgdaFunction{‚âà‚ü®}%
\>[42]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{fh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Apq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
%
\>[4]\AgdaFunction{f}\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[25]\AgdaSymbol{(}\AgdaFunction{g}%
\>[29]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[32]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[37]\AgdaFunction{‚âà‚ü®}%
\>[42]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaBound{fh}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{f}%
\>[22]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[25]\AgdaSymbol{(}\AgdaFunction{g}%
\>[29]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[32]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[37]\AgdaFunction{‚âà‚ü®}%
\>[42]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f‚àºg}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[32]\AgdaBound{œÅ}%
\>[37]\AgdaOperator{\AgdaFunction{‚àé}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{fh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{gh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[25]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß·¥¨}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë©}%
\>[25]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\<%
\end{code}
Identities modeled by an algebra \ab{ùë®} are also modeled by every homomorphic image of
\ab{ùë®} and by every subalgebra of \ab{ùë®}.
\ifshort
We refer to these facts as \af{‚äß-H-invar} and \af{‚äß-S-invar}, but omit their formal
statements and proofs, which are analogous to those of \af{‚äß-I-invar}.
\else
These facts are formalized in \agda as follows.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{‚äß-H-invar}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{‚äß-H-invar}\AgdaSpace{}%
\AgdaBound{Apq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{œÜE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[33]\AgdaBound{œÅ}%
\>[38]\AgdaFunction{‚âàÀò‚ü®}%
\>[43]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{InvIsInverse ≥}\AgdaSpace{}%
\AgdaBound{œÜE}\AgdaSymbol{)}%
\>[79]\AgdaFunction{‚ü©}\<%
\\
%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}%
\>[25]\AgdaFunction{œÜ‚Åª¬π}%
\>[30]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[33]\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[38]\AgdaFunction{‚âàÀò‚ü®}%
\>[43]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜ‚Åª¬π}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[79]\AgdaFunction{‚ü©}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaFunction{œÜ}\AgdaSymbol{(}%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[25]\AgdaFunction{œÜ‚Åª¬π}%
\>[30]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[33]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[38]\AgdaFunction{‚âà‚ü®}%
\>[43]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Apq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜ‚Åª¬π}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[79]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaFunction{œÜ}\AgdaSymbol{(}%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[25]\AgdaFunction{œÜ‚Åª¬π}%
\>[30]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[33]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[38]\AgdaFunction{‚âà‚ü®}%
\>[43]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜ‚Åª¬π}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[79]\AgdaFunction{‚ü©}\<%
\\
%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}%
\>[25]\AgdaFunction{œÜ‚Åª¬π}%
\>[30]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[33]\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[38]\AgdaFunction{‚âà‚ü®}%
\>[43]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{InvIsInverse ≥}\AgdaSpace{}%
\AgdaBound{œÜE}\AgdaSymbol{)}%
\>[79]\AgdaFunction{‚ü©}\<%
\\
%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[33]\AgdaBound{œÅ}%
\>[38]\AgdaOperator{\AgdaFunction{‚àé}}\<%
\\
%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{œÜ‚Åª¬π}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{œÜ‚Åª¬π}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{SurjInv}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜE}\<%
\\
%
\>[2]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß·¥¨}}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë©}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚äß-S-invar}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{‚äß-S-invar}\AgdaSpace{}%
\AgdaBound{Apq}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{(}%
\>[4975I]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[.][@{}l@{}]\<[4975I]%
\>[4]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[9]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[17]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[27]\AgdaBound{b}\AgdaSymbol{)}%
\>[31]\AgdaFunction{‚âà‚ü®}%
\>[36]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaFunction{hh}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{b}%
\>[58]\AgdaFunction{‚ü©}\<%
\\
%
\>[9]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[17]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}%
\>[27]\AgdaBound{b}\AgdaSymbol{)}%
\>[31]\AgdaFunction{‚âà‚ü®}%
\>[36]\AgdaBound{Apq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}%
\>[58]\AgdaFunction{‚ü©}\<%
\\
%
\>[9]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[17]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}%
\>[27]\AgdaBound{b}\AgdaSymbol{)}%
\>[31]\AgdaFunction{‚âàÀò‚ü®}%
\>[36]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaFunction{hh}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaBound{b}%
\>[58]\AgdaFunction{‚ü©}\<%
\\
%
\>[4]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[9]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[17]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[27]\AgdaBound{b}\AgdaSymbol{)}%
\>[31]\AgdaOperator{\AgdaFunction{‚àé}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß·¥¨}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë©}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{hh}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
\>[0]\<%
\end{code}
\fi
An identity satisfied by all algebras in an indexed collection is
also satisfied by the product of algebras in the collection.
\ifshort
We refer to this fact as \af{‚äß-P-invar}.
\else

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{\}(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{‚äß-P-invar}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{‚äß-P-invar}\AgdaSpace{}%
\AgdaBound{ùíúpq}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß‚ÇÅ}}%
\>[24]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[29]\AgdaBound{a}%
\>[46]\AgdaFunction{‚âà‚ü®}%
\>[51]\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{a}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}%
\>[24]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[29]\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[46]\AgdaFunction{‚âà‚ü®}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùíúpq}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}%
\>[24]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[29]\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[46]\AgdaFunction{‚âàÀò‚ü®}%
\>[51]\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaBound{a}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß‚ÇÅ}}%
\>[24]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[29]\AgdaBound{a}%
\>[46]\AgdaOperator{\AgdaFunction{‚àé}}\<%
\\
%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{)}%
\>[26]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß‚ÇÅ}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}%
\>[26]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[26]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\<%
\end{code}
\fi

The classes \af H \ab{ùí¶}, \af S \ab{ùí¶}, \af P \ab{ùí¶}, and \af V \ab{ùí¶} all satisfy the
same term identities.  We will only use a subset of the inclusions needed to prove this
assertion, and we present here just the facts we need.\footnote{For more details, see
\ualmodule{Setoid.Varieties.Preservation}.}
First, the closure operator \af H preserves the identities modeled by the
given class; this follows almost immediately from the invariance lemma
\af{‚äß-H-invar}.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[10]\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{H-id1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{H}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{H-id1}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{BimgA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚äß-H-invar}\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{BimgA}\<%
\\
\>[0]\<%
\end{code}
The analogous preservation result for \af S is a consequence of
the invariance lemma \af{‚äß-S-invar}; the converse, which we call
\af{S-id2}, has an equally straightforward proof.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{S-id1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{S-id1}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚äß-S-invar}\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{B‚â§A}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{S-id2}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{S-id2}\AgdaSpace{}%
\AgdaBound{Spq}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Spq}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{kA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚â§-reflexive}\AgdaSymbol{))}\<%
\\
\>[0]\<%
\end{code}
Finally, we have analogous pairs of implications for \af P, \af H, and \af V,
  called \af{P-id1}, \af{P-id2}, \af{H-id1}, etc.
\ifshort
We omit the formalizations (\seeshort).
\else
In each case, we will only need the first implication, so we omit the others from this presentation.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{P-id1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{Œπ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{P}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{P-id1}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{A‚âÖ‚®ÖA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚äß-I-invar}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaFunction{IH}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚âÖ-sym}\AgdaSpace{}%
\AgdaBound{A‚âÖ‚®ÖA}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{IH}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[2]\AgdaFunction{IH}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚äß-P-invar}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{kA}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}(}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{)\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)\}\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œπ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{V-id1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{V-id1}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚®ÖA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p‚®ÖA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{A‚â§‚®ÖA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{BimgA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{H-id1}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSymbol{\}\{}\AgdaArgument{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)\}\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{spK‚äßpq}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{spA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{BimgA}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaFunction{spA}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{spA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚®ÖA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p‚®ÖA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{A‚â§‚®ÖA}\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{spK‚äßpq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[3]\AgdaFunction{spK‚äßpq}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S-id1}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSymbol{\}\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P-id1}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{\}\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSymbol{)}\<%
\end{code}
\fi

%% -------------------------------------------------------------------------------------

\section{Free Algebras}
\label{free-algebras}
\paragraph*{The absolutely free algebra}
The term algebra \af{ùëª} \ab X is the \emph{absolutely free} (or \emph{initial})
\ab{S}-algebra. That is, for every \ab{ùëÜ}-algebra \ab{ùë®}, the following hold.
\begin{itemize}
\item Every function from \ab{X} to \af{ùïå[ \ab{ùë®} ]} lifts to a homomorphism from \af{ùëª} \ab{X} to \ab{ùë®}.
\item That homomorphism is unique.
\end{itemize}
We formalize the first of these in two steps.\footnote{\agdaalgebras also defines
 \af{free-lift-func} \as{:} \aof{ùîª[~\af{ùëª}~\ab X~]}~\aor{‚ü∂}~\aof{ùîª[~\ab{ùë®}~]}
 for the analogous setoid function.}$^,$\footnote{For the proof of uniqueness,
see \ualmodule{Setoid.Terms.Properties}.}  First is the lifting (\af{free-lift}).
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}(}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[1]\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\<%
\\
\>[0]\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{free-lift-func}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaFunction{free-lift-func}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{free-lift-func}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{flcong}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{reflexive·¥¨}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{flcong}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[2]\AgdaFunction{flcong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}.rfl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{reflexive·¥¨}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚â°.cong}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{flcong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}.gnl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{flcong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)))}\<%
\\
\>[0]\<%
\end{code}
\fi
\ifshort\else
At the base step, when the term has the form \aic{‚Ñä}
\ab x, the free lift of \ab h agrees with \ab h; at the inductive step, when the
term has the form \aic{node} \ab f \ab t, we assume (the induction hypothesis)
that the image of each subterm \ab t \ab i under the free lift of \ab h is known
and the free lift is defined by applying \ab f \aof{ÃÇ} \ab{ùë®} to these images.
\fi
Then the lift so defined is shown to be a homomorphism.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{lift-hom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{lift-hom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{free-lift-func}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaSymbol{(Œª\{}\AgdaBound{\AgdaUnderscore{}}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{free-lift-func}\AgdaSymbol{)\{}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isRefl}\AgdaSymbol{)))}\<%
\\
\>[0]\<%
\end{code}

It turns out that the interpretation of a term \ab p in an environment \ab{Œ∑} is the same
as the free lift of \ab{Œ∑} evaluated at \ab p. We apply this fact a number of times in the sequel.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[21]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[21]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ∑}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)(}\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{Œ∑}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Œ∑}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
%
\>[1]\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaBound{Œ∑}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[1]\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaBound{Œ∑}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaBound{Œ∑}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\<%
\end{code}

\paragraph*{The relatively free algebra in theory}
Here we mathematically describe, for a given class \ab{ùí¶} of \ab{ùëÜ}-algebras, the
\emph{relatively free algebra} in \af{S} (\af{P} \ab{ùí¶}) over \ab X, with the
type theoretic version to follow in the next section.

Recall that the term algebra \T{X} is the \emph{free} class of all
\ab{ùëÜ}-algebras. Given an arbitrary class \ab{ùí¶} of \ab{ùëÜ}-algebras, we can't expect that
\T{X} belongs to \ab{ùí¶}, so, in general, we say that \T{X} is free \emph{for} \ab{ùí¶}.
\ifshort\else
Indeed, it might not be possible to find a free algebra that belongs to \ab{ùí¶}.
\fi
However, for any class \ab{ùí¶} we can construct an algebra that is free for \ab{ùí¶}
and belongs to the class \af{S} (\af{P} \ab{ùí¶}), and for most applications this suffices.

The construction of the free algebra in \af{S} (\af{P} \ab{ùí¶})
proceeds by taking the quotient of \T{X} modulo a congruence relation \afld{‚âà}.  One approach is to let
\afld{‚âà} be \af{‚ãÇ}\{\ab{Œ∏} \af{‚àà} \af{Con} (\T{X}) : \T{X} \af{/} \ab{Œ∏} \af{‚àà} \af{S}
\ab{ùí¶}\}.\footnote{\af{Con} (\T{X}) denotes the congruences of \T{X}.}

\ifshort\else
Equivalently, we could let \ab{‚Ñ∞} = \af{Th} \ab{ùí¶} and take \afld{‚âà} to be the least equivalence relation
on the domain of \T{X} such that
\begin{enumerate}
\item for every equation (\ab p , \ab q) \af{‚àà} \af{Th} \ab{ùí¶} and every
environment \ab{œÅ} : \ab X \as{‚Üí} \Term{X}, we have\\
\af{‚ü¶~\ab p~‚üß} \afld{‚ü®\$‚ü©} \ab{œÅ} \afld{‚âà} \af{‚ü¶~\ab q~‚üß} \afld{‚ü®\$‚ü©} \ab{œÅ}, and
\item \afld{‚âà} is a congruence of \T{X}; that is, for every operation symbol \ab
f : \af{‚à£~\ab{ùëÜ}~‚à£}, and for all tuples \ab{s} \ab{t} : \af{‚à•~\ab{ùëÜ}~‚à•} \ab f
‚Üí \Term{X}, the following implication holds:\footnote{Here all
interpretations, denoted by \af{‚ü¶\au{}‚üß}, are with respect to \T{X}.}\\[-8pt]

(‚àÄ i ‚Üí \af{‚ü¶~\ab{s}~\ab i~‚üß}~\afld{‚ü®\$‚ü©}~\ab{œÅ}~\afld{‚âà}~\af{‚ü¶~\ab{t}~\ab
i~‚üß}~\afld{‚ü®\$‚ü©}~\ab{œÅ})
\as{‚Üí} \af{‚ü¶~\ab f~\ab s~‚üß}~\afld{‚ü®\$‚ü©}~\ab{œÅ}~\afld{‚âà}~\af{‚ü¶~\ab f~\ab
t~‚üß}~\afld{‚ü®\$‚ü©}~\ab{œÅ}\\[-8pt]
\end{enumerate}
\fi

The \defn{relatively free algebra over} \ab{X} (relative to
\ab{ùí¶}) is defined to be the quotient \Free{X} := \T{X}~\af{/}~\afld{‚âà}.
Evidently, \Free{X} is a subdirect product of the algebras in \{\T{X}~\af{/}~\ab{Œ∏}\!\},
where \ab{Œ∏} ranges over congruences modulo which \T{X} belongs to \af{S}~\ab{ùí¶}.
In particular, \Free{X} embeds in a product of members of \af{S}~\ab{ùí¶}, so
\Free{X} \af{‚àà} \af{S}(\af{P}(\af{S}~\ab{ùí¶})) ‚äÜ \af{S}(\af{P}~\ab{ùí¶}). It follows
that \Free{X} satisfies the identities in \af{Th} \ab{ùí¶} (those modeled by all members of
\ab{ùí¶}).  Indeed, for each pair \ab p \ab q : \Term{X}, if \ab{ùí¶} \af{‚ä´} \ab p \af{‚âà} \ab
q, then \ab p and \ab q belong to the same \afld{‚âà}-class, so \ab p and \ab q are
identified in \Free{X}. \ifshort\else (Notice that \afld{‚âà} may be empty, in which case
\T{X}~\af{/}~\afld{‚âà} is trivial.) \fi

\paragraph*{The relatively free algebra in \agda}
%Our approach looks a bit different from the informal one described above, because we
%represent quotients as setoids, but the end result is the same.
We start with a type \ab{‚Ñ∞} representing a collection of identities and, instead of
forming a quotient, we take the domain of the free algebra to be a setoid whose
\afld{Carrier} is the type \Term{X} of {ùëÜ}-terms in \ab X and whose equivalence relation
includes all pairs (\ab p , \ab q) \af{‚àà} \Term{X} \af{√ó} \Term{X} such that \ab p \aod{‚âà}
\ab q is derivable from \ab{‚Ñ∞}; that is, \ab{‚Ñ∞} \aod{‚ä¢} \ab X \aod{‚ñπ} \ab p \aod{‚âà} \ab q.
Observe that elements of this setoid are equal iff they belong to the same equivalence
class of the congruence \afld{‚âà} defined above.  Therefore, the setoid so defined, which
we denote by \Free{X}, represents the quotient \T{X}~\af{/}~\afld{‚âà}.
Finally, the interpretation of an operation in the free algebra is simply the operation
itself, which works since \ab{‚Ñ∞} \aod{‚ä¢} \ab X \aod{‚ñπ\au{}‚âà\au{}} is a congruence
relation (see also~\cite{Abel:2021}).

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{FreeAlgebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{œá}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}(}\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{FreeDomain}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{FreeDomain}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{record}%
\>[10]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{reflexive}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{symmetric}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{transitive}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaOperator{\AgdaFunction{ùîΩ[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaField{Domain}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{FreeDomain}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\>[1]\AgdaField{Interp}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{FreeInterp}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{FreeInterp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{FreeDomain}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaFunction{FreeDomain}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\>[2]\AgdaFunction{FreeInterp}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ts}\AgdaSymbol{)}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ts}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{FreeInterp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{app}\AgdaSpace{}%
\AgdaBound{h}\<%
\end{code}

\paragraph*{The natural epimorphism} % from ùëª X to ùîΩ[ X ]}
We now define the natural epimorphism from \T{X} onto \Free{X} %(= \T{X}~\af{/}~\afld{‚âà})
and prove that its kernel is contained in the collection of identities modeled
by \af{V} \ab{ùí¶}.%(which we represent by \af{Th} (\af{V} \ab{ùí¶})).
\ifshort%
\footnote{The \AgdaFunction{HomReduct} method of the \ar{IsEpi} record type merely extracts the \af{hom} part of an epimorphism.}
\else

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{FreeHom}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaFunction{c}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeAlgebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{œá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{epiF[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{epiF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{hepi}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[27]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}%
\>[43]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÄ\AgdaUnderscore{}}}%
\>[67]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{refl·µÄ}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[27]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[43]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÅ\AgdaUnderscore{}}}%
\>[67]\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{con}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÄ}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÅ}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[2]\AgdaFunction{con}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[2]\AgdaFunction{con}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{s}\AgdaSymbol{\}\{}\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{con}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{con}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{hepi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaFunction{h}\<%
\\
%
\>[2]\AgdaField{compatible}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isHom}\AgdaSpace{}%
\AgdaFunction{hepi}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaFunction{refl·µÄ}\<%
\\
%
\>[2]\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaFunction{hepi}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaOperator{\AgdaFunction{homF[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{IsEpi.HomReduct}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{epiF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{kernel-in-theory}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{kernel-in-theory}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{pKq}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{vkA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{V-id1}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaBound{pKq}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{vkA}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Soundness}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\<%
\end{code}
Next we prove an important property of the relatively free algebra
(relative to \ab{ùí¶} and satisfying the identities in \af{Th} \ab{ùí¶}),
which will be used in the formalization of the HSP theorem. Specifically,
we prove that for every algebra \ab{ùë®}, if \ab{ùë®} \af{‚ä®} \ab{Th} (\af{V} \ab{ùí¶}),
then there exists an epimorphism from \Free{A} onto \ab{ùë®}.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[10]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaFunction{c}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeHom}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSymbol{\}}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeAlgebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{œá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{\}(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{renaming}%
\>[72]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{Carrier}%
\>[83]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{A}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{F-ModTh-epi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaFunction{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{F-ModTh-epi}\AgdaSpace{}%
\AgdaBound{A‚ààModThK}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{isEpi}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaFunction{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{id}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{pq}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaFunction{trans}%
\>[31]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift-interp}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[21]\AgdaSymbol{(}%
\>[24]\AgdaFunction{trans}%
\>[31]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{A‚ààModThK}\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{kernel-in-theory}\AgdaSpace{}%
\AgdaBound{pq}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[31]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{free-lift-interp}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{isEpi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaFunction{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{œÜ}\<%
\\
%
\>[2]\AgdaField{compatible}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isHom}\AgdaSpace{}%
\AgdaFunction{isEpi}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaFunction{isEpi}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\end{code}
\ifshort\else

\medskip

\noindent Actually, we will need the following lifted version of this result.

\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{F-ModTh-epi-lift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaFunction{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{F-ModTh-epi-lift}\AgdaSpace{}%
\AgdaBound{A‚ààModThK}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-epi}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{F-ModTh-epi}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A‚ààModThK}\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}))}\AgdaSpace{}%
\AgdaFunction{ToLift-epi}\<%
\end{code}
\fi


%% -------------------------------------------------------------------------------------

\section{Birkhoff's Variety Theorem}

Birkhoff's variety theorem, also known as the HSP theorem, asserts that a class of algebras
is a variety if and only if it is an equational class.  In this section, we present the
statement and proof of the HSP theorem---first in a style similar to
what one finds in textbooks (e.g.,~\cite[Theorem 4.41]{Bergman:2012}),
and then formally in the language of \mltt.

\subsection{Informal proof}
Let \ab{ùí¶} be a class of algebras and recall that \ab{ùí¶} is a \emph{variety} provided
\ifshort\else
it is closed under homomorphisms, subalgebras and products; equivalently,
\fi
\af{V} \ab{ùí¶} ‚äÜ \ab{ùí¶}.
(Observe that \ab{ùí¶} ‚äÜ \af{V} \ab{ùí¶} holds for all \ab{ùí¶} since
\af{V} is a closure operator.)
We call \ab{ùí¶} an \emph{equational class} if it is precisely the class of all models of some set of identities.

\emph{Every equational class is a variety}. Indeed, suppose \ab{ùí¶} is an equational
class axiomatized by term identities \ab{‚Ñ∞}; that is, \ab{ùë®} ‚àà \ab{ùí¶} iff
\ab{ùë®} \af{‚ä®} \ab{‚Ñ∞}. Since the classes \af H \ab{ùí¶}, \af S \ab{ùí¶}, \af P \ab{ùí¶} and
\ab{ùí¶} all satisfy the same set of equations, we have \af{V} \ab{ùí¶} \af{‚ä´} \ab p
\af{‚âà} \ab q for all (\ab p , \ab q) \af{‚àà} \ab{‚Ñ∞}, so \af{V} \ab{ùí¶} ‚äÜ \ab{ùí¶}.

The converse assertion---that \emph{every variety is an equational class}---takes more
work.\footnote{The proof we present here is based on that of~\cite[Theorem 4.41]{Bergman:2012}.}
Let \ab{ùí¶} be an arbitrary variety.  We will describe a set of equations that axiomatizes
\ab{ùí¶}.  A natural choice is \af{Th} \ab{ùí¶}, all equations that hold in \ab{ùí¶};
% Let \ab{ùí¶‚Å∫} := \af{Mod} (\af{Th} \ab{ùí¶}). Clearly, \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶‚Å∫}.  We prove the
for this choice, we must prove \ab{ùí¶} \aof{=} \af{Mod} (\af{Th} \ab{ùí¶}).
Clearly, \ab{ùí¶} \aof{‚äÜ} \af{Mod} (\af{Th} \ab{ùí¶}).  We prove the
converse inclusion. Let \ab{ùë®} \af{‚àà} \af{Mod} (\af{Th} \ab{ùí¶}); 
it suffices to find an algebra \ab{ùë≠} \af{‚àà} \af{S} (\af{P} \ab{ùí¶}) such that
\ab{ùë®} is a homomorphic image of \ab{ùë≠}, as this will show that \ab{ùë®} \af{‚àà}
\af{H} (\af{S} (\af{P} \ab{ùí¶})) = \ab{ùí¶}.

Let \ab{X} be such that there exists a \emph{surjective} environment
\ab{œÅ} : \ab{X} \as{‚Üí} \af{ùïå[~\ab{ùë®}~]}.
%\footnote{This is usually done by assuming \ab{X} has cardinality at least max(|~\af{ùïå[~\ab{ùë®}~]}~|, œâ).}
By the \af{lift-hom} lemma, there is an epimorphism \ab{h} from \T{X} onto \af{ùïå[~\ab{ùë®}~]}
that extends \ab{œÅ}.
Now, put \aof{ùîΩ[~\ab{X}~]}~:=~\T{X}/\afld{‚âà}, and let \ab{g} : \T{X} \as{‚Üí} \aof{ùîΩ[~\ab{X}~]}
be the natural epimorphism with kernel \afld{‚âà}. We claim that \af{ker} \ab g \af{‚äÜ}
\af{ker} \ab h. If the claim is true, then there is a map \ab{f} : \aof{ùîΩ[~\ab{X}~]} \as{‚Üí} \ab{ùë®}
such that \ab f \af{‚àò} \ab g = \ab h. Since \ab h is surjective, so is \ab f. Hence \ab{ùë®}
\af{‚àà} \af{ùñß} (\af{ùîΩ} \ab X) \aof{‚äÜ} \af{Mod} (\af{Th} \ab{ùí¶}) completing the proof.
To prove the claim, let \ab u , \ab v \af{‚àà} \T{X} and assume that \ab g \ab u =
\ab g \ab v. Since \T{X} is generated by \ab X, there are terms \ab p, \ab q ‚àà
\T{X} such that \ab u = \af{‚ü¶~\T{X}~‚üß} \ab p and v = \af{‚ü¶~\T{X}~‚üß} \ab
q.
%\footnote{Recall, \af{‚ü¶~\ab{ùë®}~‚üß} \ab t denotes the interpretation of the term
%\ab t in the algebra \ab{ùë®}.}
Therefore,\\[-4pt]

\af{‚ü¶~\Free{X}~‚üß} \ab p = \ab g (\af{‚ü¶~\T{X}~‚üß} \ab p) = \ab g \ab u = \ab g \ab v =
\ab g (\af{‚ü¶~\T{X}~‚üß} \ab q) = \af{‚ü¶~\Free{X}~‚üß} \ab q,\\[8pt]
so \ab{ùí¶} \af{‚ä´} \ab p \af{‚âà} \ab q, thus (\ab p , \ab q) \af{‚àà} \af{Th}
\ab{ùí¶}. Since \ab{ùë®} \af{‚àà} \af{Mod} (\af{Th} \ab{ùí¶}) =
\af{Mod} (\af{Th} \ab{ùí¶}), we obtain \ab{ùë®} \af{‚äß} \ab p \af{‚âà} \ab q, which implies
that \ab h \ab u = (\af{‚ü¶~\ab{ùë®}~‚üß} \ab p) \aofld{‚ü®\$‚ü©} \ab{œÅ} = (\af{‚ü¶~\ab{ùë®}~‚üß} \ab q)
\aofld{‚ü®\$‚ü©} \ab{œÅ} = \ab h \ab v, as desired.

\subsection{Formal proof}
We now show how to express and prove the twin assertions that
(i) every equational class is a variety and (ii) every variety is an equational class.

\paragraph*{Every equational class is a variety}
For (i), we need an arbitrary equational class, which we obtain by starting with an arbitrary
collection \ab{‚Ñ∞} of equations and then defining \ab{ùí¶} = \af{Mod} \ab{‚Ñ∞}, the equational class
determined by \ab{‚Ñ∞}. We prove that \ab{ùí¶} is a variety by showing that
\ab{ùí¶} = \af{V} \ab{ùí¶}. The inclusion \ab{ùí¶} \aof{‚äÜ} \af V \ab{ùí¶}, which holds for all
classes \ab{ùí¶}, is called the \defn{expansive} property of \af{V}.
\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{))\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{V-expa}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\<%
\\
%
\>[1]\AgdaFunction{V-expa}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚ä§}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSymbol{)}\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{Goal}\AgdaSymbol{)}\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚â§-reflexive}\AgdaSymbol{)}\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{IdHomImage}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{refl‚®Ö}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{to‚®Ö}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{to‚®Ö}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{from‚®Ö}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{from‚®Ö}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaFunction{tt}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaFunction{tt}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{to‚®Ö}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaFunction{refl‚®Ö}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{from‚®Ö}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
Observe how \ab{ùë®} is expressed as (isomorphic to) a product with just one factor (\ab{ùë®} itself); that is, the product
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}
indexed over the one-element type \af{‚ä§}.)

The converse inclusion, \af V \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶}, requires the assumption
that \ab{ùí¶} is an equational class. Recall lemma
\af{V-id1}, which asserts that \ab{ùí¶} \aof{‚ä´} \ab p \aof{‚âà} \ab q implies \af{V}
\ab{‚Ñì} \ab{Œπ} \ab{ùí¶} \aof{‚ä´} \ab p \aof{‚âà} \ab q. Whence, if \ab{ùí¶} is an equational
class, then \af V \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶}, as we now confirm.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSymbol{\{}\AgdaArgument{Œ±}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}%
\>[36]\AgdaComment{--\ an\ arbitrary\ equational\ class}\<%
\\
%
\>[1]\AgdaFunction{EqCl‚áíVar}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{ùí¶}\<%
\\
%
\>[1]\AgdaFunction{EqCl‚áíVar}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{vA}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{p‚Ñ∞q}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{V-id1}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaFunction{ùí¶}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{œÑ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{p‚Ñ∞q}\AgdaSpace{}%
\AgdaBound{œÑ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{vA}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
\>[0]\<%
\end{code}
Together, \af{V-expa} and \af{Eqcl‚áíVar} prove that every equational class is a variety.


\paragraph*{Every variety is an equational class}
For (ii), we need an arbitrary variety, which we obtain by starting with an arbitrary class
\ab{ùí¶} of \ab{ùëÜ}-algebras and taking the \emph{varietal closure}, \af{V} \ab{ùí¶}.
We prove that \af{V} \ab{ùí¶} is an equational class by showing it is precisely the collection of
algebras that model the equations in \af{Th} (\af{V} \ab{ùí¶}); that is, we prove
\af{V} \ab{ùí¶} = \af{Mod} (\af{Th} (\af{V} \ab{ùí¶})).
The inclusion \af{V} \ab{ùí¶} \aof{‚äÜ} \af{Mod} (\af{Th} (\af{V} \ab{ùí¶})) is a
consequence of the fact that \af{Mod} \af{Th} is a closure operator.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{))\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaFunction{c}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ModTh-closure}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{V}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}\{}\AgdaGeneralizable{Œ≥}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}\{}\AgdaGeneralizable{Œ¥}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µà}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSymbol{\{}\AgdaArgument{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\<%
\\
%
\>[1]\AgdaFunction{ModTh-closure}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{vA}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{vA}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
\>[0]\<%
\end{code}

\noindent Our proof of the inclusion \af{Mod} (\af{Th} (V ùí¶)) \aof{‚äÜ}
\af{V} \ab{ùí¶} proceeds according to the following plan.

\begin{enumerate}
\item \label{item:1} Prove \aof{ùîΩ[ \ab{X} ]} \af{‚àà} \af{S} (\af{P} \ab{ùí¶}).
\begin{enumerate}
\item \label{item:1.1} Let \ab{ùë™} be the product of all algebras in \af{S} \ab{ùí¶}, so \ab{ùë™} \af{‚àà} \af{P} (\af{S} \ab{ùí¶}).
\item \label{item:1.2} Prove \af{P} (\af{S} \ab{ùí¶}) \af{‚äÜ} \af{S} (\af{P} \ab{ùí¶}), so \ab{ùë™} \af{‚àà} \af{S} (\af{P} \ab{ùí¶}).
\item \label{item:1.3} Prove \aof{ùîΩ[ \ab{X} ]} \af{‚â§} \ab{ùë™}, so \aof{ùîΩ[ \ab{X} ]} \af{‚àà} \af{S} (\af{S} (\af{P} \ab{ùí¶})) (= \af{S} (\af{P} \ab{ùí¶})).
\end{enumerate}
\item \label{item:2} Prove that every algebra in \af{Mod} (\af{Th} (V ùí¶)) is a homomorphic image of
\aof{ùîΩ[ \ab{X} ]}.
\end{enumerate}
From \ref{item:1} and \ref{item:2} will follow \af{Mod} (\af{Th} (V ùí¶))
‚äÜ \af{H} (\af{S} (\af{P} \ab{ùí¶})) (= \af{V} \ab{ùí¶}), as desired.

\begin{itemize}
\item 
\noindent \ref{item:1.1}. To define \ab{ùë™} as the product of all algebras in \af{S} \ab{ùí¶}, we must first contrive
an index type for the class \af{S} \ab{ùí¶}.  We do so by letting the indices be the algebras
belonging to \ab{ùí¶}. Actually, each index will consist of a triple (\ab{ùë®} , \ab p ,
\ab{œÅ}) where \ab{ùë®} is an algebra, \ab p : \ab{ùë®} \af{‚àà} \af{S} \ab{ùí¶} is a proof of membership in \ab{ùí¶},
and \ab{œÅ} : \ab X \as{‚Üí} \aof{ùïå[ \ab{ùë®} ]} is an arbitrary environment.
Using this indexing scheme, we construct \ab{ùë™}, the product of all algebras in \ab{ùí¶}
and all environments.

The indexing type \ab{‚Ñë}, the family of algebras \ab{ùîÑ}, and the product \ab{ùë™} are defined
as follows.

\ifshort\else

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeHom}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSymbol{\}}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeAlgebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{œá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{\}(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Env}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{‚Ñë}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaFunction{Œπ}\<%
\\
%
\>[1]\AgdaFunction{‚Ñë}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ùîÑ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚Ñë}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\<%
\\
%
\>[1]\AgdaFunction{ùîÑ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{Œπ}\<%
\\
%
\>[1]\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaFunction{ùîÑ}\<%
\\
\>[0]\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{skEqual}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚Ñë}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\<%
\\
%
\>[1]\AgdaFunction{skEqual}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùîÑ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùîÑ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}

The type \af{skEqual} provides a term identity \ab p \af{‚âà} \ab q for each index \ab i = (\ab{ùë®} , \ab{p} , \ab{œÅ}) of the product.
%(here, as above, \ab{ùë®} is an algebra, \ab{sA} is a proof that \ab{ùë®} belongs to \af{S} \ab{ùí¶}, and \ab{œÅ} is an environment).
%map assigning values in the domain of \ab{ùë®} to variable symbols in \ab X).
Later we prove that if the identity \ab{p} \af{‚âà} \ab q holds in all \ab{ùë®} \aof{‚àà} \af S \ab{ùí¶} (for all environments), then \ab p \af{‚âà} \ab q
holds in the relatively free algebra \Free{X}; equivalently, the pair (\ab p , \ab q) belongs to the
kernel of the natural homomorphism from \T{X} onto \Free{X}. We will use that fact to prove
that the kernel of the natural hom from \T{X} to \ab{ùë™} is contained in the kernel of the natural hom from \T{X} onto \Free{X},
whence we construct a monomorphism from \Free{X} into \ab{ùë™}, and thus \Free{X} is a subalgebra of \ab{ùë™},
so belongs to \af S (\af P \ab{ùí¶}).

\fi

\item \noindent \ref{item:1.2}. We need to show that a product of subalgebras of algebras in a class is a subalgebra of a product of algebras in the class;
in other terms, \af{P} (\af{S} \ab{ùí¶}) \aof{‚äÜ} \af{S} (\af{P} \ab{ùí¶}), for every class \ab{ùí¶}.
% We need \af{P} (\af{S} \ab{ùí¶}) \aof{‚äÜ} \af{S} (\af{P}
% \ab{ùí¶}) for every class \ab{ùí¶},.
\ifshort
The \agdaalgebras library denotes this fact by \af{PS‚äÜSP}.
As the proof is a bit tedious, it doesn't seem helpful to reproduce it here (\seeshort).
\else
We state and prove this in \agda as follows.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{PS‚äÜSP}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{PS‚äÜSP}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë©}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{B‚âÖ‚®ÖA}\AgdaSpace{}%
\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Goal}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{‚Ñ¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\<%
\\
%
\>[2]\AgdaFunction{‚Ñ¨}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{kB}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚Ñ¨}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{ùí¶}\<%
\\
%
\>[2]\AgdaFunction{kB}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[10]\AgdaField{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[2]\AgdaFunction{‚®ÖA‚â§‚®ÖB}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaFunction{‚Ñ¨}\<%
\\
%
\>[2]\AgdaFunction{‚®ÖA‚â§‚®ÖB}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚®Ö-‚â§}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSymbol{\}\{}\AgdaFunction{oa‚Ñì}\AgdaSymbol{\}}\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSymbol{\}\{}\AgdaFunction{oa‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaFunction{‚Ñ¨}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚Ñ¨}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{kB}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚âÖ-refl}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚âÖ-trans-‚â§}\AgdaSpace{}%
\AgdaBound{B‚âÖ‚®ÖA}\AgdaSpace{}%
\AgdaFunction{‚®ÖA‚â§‚®ÖB}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
\fi

\item \noindent \ref{item:1.3}. To prove \aof{ùîΩ[ \ab{X} ]} \af{‚â§} \ab{ùë™}, we construct homomorphisms from \ab{ùëª} \ab{X} to \ab{ùë™} and \Free{X} to \ab{ùë™}, the latter of which requires the kernel condition mentioned above.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{homC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{ùë™}\<%
\\
%
\>[1]\AgdaFunction{homC}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚®Ö-hom-co}\AgdaSpace{}%
\AgdaFunction{ùîÑ}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{lift-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{kerF‚äÜkerC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{homC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaFunction{kerF‚äÜkerC}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{pKq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{p}%
\>[19]\AgdaFunction{‚âàÀò‚ü®}\AgdaSpace{}%
\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[20]\AgdaFunction{‚âà‚ü®}\AgdaSpace{}%
\AgdaFunction{S-id1}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaBound{pKq}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[20]\AgdaFunction{‚âà‚ü®}\AgdaSpace{}%
\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{q}%
\>[19]\AgdaOperator{\AgdaFunction{‚àé}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Soundness}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{homFC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaFunction{ùë™}\<%
\\
%
\>[1]\AgdaFunction{homFC}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{HomFactor}\AgdaSpace{}%
\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaFunction{homC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaFunction{kerF‚äÜkerC}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{epiF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
\>[0]\<%
\end{code}
If \AgdaPair{p}{q} belongs to the kernel of \af{homC}, then
\af{Th} \ab{ùí¶} includes the identity \ab{p} \af{‚âà} \ab{q}.
%---that is, \af{Th} \ab{ùí¶} \af{‚ä¢} \ab X \af{‚ñπ} \ab{p} \af{‚âà} \ab{q}.
Equivalently,
the kernel of \af{homC} is contained in that of \af{homF[ X ]}.
\ifshort
We omit the proof of this lemma and merely display its formal statement.
\else
\fi

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{kerC‚äÜkerF}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{homC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\end{code}
\ifshort
\vskip2mm
\else
\begin{code}%
%
\>[1]\AgdaFunction{kerC‚äÜkerF}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{pKq}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Sùí¶‚ä´‚ÜíkerùîΩ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Sùí¶‚ä´}\AgdaSpace{}%
\AgdaFunction{pqEqual}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{Sùí¶‚ä´}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{skEqual}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[2]\AgdaFunction{Sùí¶‚ä´}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Sùí¶‚ä´‚ÜíkerùîΩ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{Sùí¶‚ä´‚ÜíkerùîΩ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{hyp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S-id2}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{pqEqual}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{skEqual}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaFunction{pqEqual}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{goal}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùîÑ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}%
\>[27]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùîÑ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[27]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{goal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[3]\AgdaFunction{goal}%
\>[9]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift-interp}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{\}(}\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\<%
\\
%
\>[9]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{pKq}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift-interp}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)))}\<%
\\
\>[0]\<%
\end{code}
\fi
\noindent We conclude that the homomorphism from \Free{X} to \af{ùë™} is injective, whence
\Free{X} is (isomorphic to) a subalgebra of \af{ùë™}.\footnote{The function \af{mon‚Üí‚â§} in
the proof of \af{F‚â§C} merely extracts a subalgebra witness from a monomorphism.}

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{monFC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{mon}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaFunction{ùë™}\<%
\\
%
\>[1]\AgdaFunction{monFC}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{homFC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{isHom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{homFC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isInjective}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{kerC‚äÜkerF}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{F‚â§C}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaFunction{ùë™}\<%
\\
%
\>[1]\AgdaFunction{F‚â§C}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mon‚Üí‚â§}\AgdaSpace{}%
\AgdaFunction{monFC}\<%
\\
\>[0]\<%
\end{code}
Recall, from \ref{item:1.1} and \ref{item:1.2}, we have \ab{ùë™} \af{‚àà}
\af{P} (\af{S} \ab{ùí¶}) \af{‚äÜ} \af{S} (\af{P} \ab{ùí¶}). We now use this, along with 
what we just proved (\af{F‚â§C}), to conclude that \Free{X} belongs to \af{S}
(\af{P} \ab{ùí¶}).
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{SPF}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{SPF}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[7020I]\AgdaKeyword{let}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{alg}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{‚ààùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{‚â§SP}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{PS‚äÜSP}\AgdaSpace{}%
\AgdaFunction{psC}\AgdaSpace{}%
\AgdaKeyword{in}\<%
\\
\>[.][@{}l@{}]\<[7020I]%
\>[7]\AgdaSymbol{(}\AgdaBound{alg}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{‚ààùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚â§-transitive}\AgdaSpace{}%
\AgdaFunction{F‚â§C}\AgdaSpace{}%
\AgdaBound{‚â§SP}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{psC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{psC}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚Ñë}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùîÑ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{((Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚âÖ-refl}\AgdaSymbol{))}\<%
\\
\>[0]\<%
\end{code}
This completes stage \ref{item:1} of the proof.
\end{itemize}

\begin{itemize}
\item 
\noindent \ref{item:2}. We show that every algebra in \af{Mod} (\af{Th} (\af{V}
\ab{ùí¶})) is a homomorphic image of \af{ùîΩ[~\ab{X}~]}, as follows.
\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaFunction{c}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeAlgebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{œá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{\}(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{Var‚áíEqCl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\<%
\\
%
\>[1]\AgdaFunction{Var‚áíEqCl}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ModThA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{spFA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{AimgF}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{spFA}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaFunction{Œπ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{spFA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{SPF}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùí¶}\<%
\\
%
\>[2]\AgdaFunction{epiFlA}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{epiFlA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{F-ModTh-epi-lift}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ModThA}\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\})}\<%
\\
%
\>[2]\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{epi‚Üíontohom}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{epiFlA}\<%
\\
%
\>[2]\AgdaFunction{AimgF}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{AimgF}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from}\AgdaSpace{}%
\AgdaFunction{Lift-‚âÖ}\AgdaSymbol{)}\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚àò-IsSurjective}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{(}\AgdaFunction{fromIsSurjective}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-‚âÖ}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}))}\<%
\\
\>[0]\<%
\end{code}
\af{ModTh-closure} and \af{Var‚áíEqCl} show that
\af{V} \ab{ùí¶} = \af{Mod} (\af{Th} (\af{V} \ab{ùí¶})) holds for every class \ab{ùí¶} of \ab{ùëÜ}-algebras.
Thus, every variety is an equational class. 
\end{itemize}

This completes the formal proof of Birkhoff's variety theorem.

%% -----------------------------------------------------------------------------
\section{Related work}
There have been a number of efforts to formalize parts of universal algebra in
type theory besides ours. The Coq proof assistant, based on the Calculus of
Inductive Constructions, was used by Capretta, in~\cite{Capretta:1999}, and
Spitters and Van der Weegen, in~\cite{Spitters:2011}, to formalized the basics
of universal algebra and some classical algebraic structures.
In~\cite{Gunther:2018} Gunther et al developed what seemed (prior to the \agdaalgebras
library) the most extensive library of formalized universal algebra to date.
Like \agdaalgebras,~\cite{Gunther:2018} is based on dependent type theory, is programmed
in \agda, and goes beyond the basic isomorphism theorems to include some equational logic.
Although their coverage is less extensive than that of \agdaalgebras, Gunther et al do treat
\emph{multi-sorted} algebras, whereas \agdaalgebras is currently limited to single-sorted structures.

As noted by Abel~\cite{Abel:2021}, Amato et al, in \cite{Amato:2021}, have
formalized multi-sorted algebras with finitary operators in UniMath. The restriction to
finitary operations was due to limitations of the UniMath type theory, which does
not have W-types nor user-defined inductive types.
Abel also notes that Lynge and Spitters, in~\cite{Lynge:2019}, formalize multi-sorted
algebras with finitary operators in \emph{Homotopy type theory} (\cite{HoTT}) using
Coq.  HoTT's higher inductive types enable them to define quotients as types, without
the need for setoids.  Lynge and Spitters prove three isomorphism theorems concerning
subalgebras and quotient algebras, but do not formalize universal algebras nor varieties.
Finally, in~\cite{Abel:2021}, Abel gives a new formal proof of the soundness theorem and
Birkhoff's completeness theorem for multi-sorted algebraic structures.

%Some other projects aimed at formalizing mathematics generally, and algebra in particular,
% have developed into very extensive libraries that include definitions, theorems, and proofs
% about algebraic structures, such as groups, rings, modules, etc.  However, the goals of these
% efforts seem to be the formalization of special classical algebraic structures, as opposed
% to the general theory of (universal) algebras. Moreover, the part of universal algebra and
% equational logic formalized in the \agdaalgebras library extends beyond the scope of prior efforts.

%Prior to our work, a constructive version of Birkhoff's theorem was published by
% Carlstr\"om in~\cite{Carlstrom:2008}.  However, the logical foundations of that work is constructive set
% theory and, as far as we know, there was no attempt to formalize it in type theory and verify
% it with a proof assistant.


% \section{Conclusion}

% One positive outcome of this project is further evidence in support of dependent type theory and the \agda language. We have shown that, despite the technical demands they place on the user, these technologies are accessible to universal algebraists who possess sufficient patience and resolve to codify their work in type theory and verify their results with a proof assistant.
