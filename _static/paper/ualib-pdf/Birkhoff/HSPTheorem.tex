We now have all the pieces in place so that it is all but trivial to string together these pieces to complete the proof of Birkhoff's celebrated HSP theorem asserting that every variety is defined by a set of identities (is an ``equational class'').
\ccpad
\begin{code}%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{UALib.Algebras}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Signature}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaGeneralizable{ğ“}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¥}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}â† \AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{UALib.Prelude.Preliminaries}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{global-dfunext}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}Ì‡}}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{UALib.Birkhoff.Theorem}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{\{}\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaGeneralizable{ğ“}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¥}\AgdaSymbol{\}\{}\AgdaBound{gfe}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{global-dfunext}\AgdaSymbol{\}}\<%
\\
%
\>[1]\AgdaSymbol{\{}\AgdaBound{ğ•}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}(}\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{â† }}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSymbol{\}}\<%
\\
%
\>[1]\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}}\<%
\\
%
\>[1]\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{UALib.Birkhoff.Lemmata}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ğ‘†}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{\}\{}\AgdaBound{gfe}\AgdaSymbol{\}\{}\AgdaBound{ğ•}\AgdaSymbol{\}\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{public}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{the-free-algebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Birkhoffs-Theorem}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{\{}\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{OV}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)\}}\<%
\\
%
\>[1]\AgdaComment{-- extensionality assumptions:}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[11]\AgdaSymbol{\{}\AgdaBound{hfe}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hfunext}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{OV}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)(}\AgdaFunction{OV}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)\}}\<%
\\
%
\>[11]\AgdaSymbol{\{}\AgdaBound{pe}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{propext}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{OV}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)\}}\<%
\\
%
\>[11]\AgdaSymbol{\{}\AgdaBound{ssR}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{is-subsingleton}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaFunction{ÏˆRel}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)\}}\<%
\\
%
\>[11]\AgdaSymbol{\{}\AgdaBound{ssA}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{is-subsingleton}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ğ’}\AgdaSymbol{\{}\AgdaFunction{OV}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaFunction{OV}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaFunction{ğ‘»}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{\}\{}\AgdaFunction{ÏˆRel}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{C}\AgdaSymbol{)\}}\<%
\\
%
\>[1]\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{the-relatively-free-algebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}\{}\AgdaBound{ğ’¦}\AgdaSymbol{\}}\<%
\\
%
\>[1]\AgdaKeyword{open}%
\>[7]\AgdaModule{HSPLemmata}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ğ’¦}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSymbol{\}\{}\AgdaBound{hfe}\AgdaSymbol{\}\{}\AgdaBound{pe}\AgdaSymbol{\}\{}\AgdaBound{ssR}\AgdaSymbol{\}\{}\AgdaBound{ssA}\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaComment{-- Birkhoff's theorem: every variety is an equational class.}\<%
\\
%
\>[1]\AgdaFunction{birkhoff}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{is-set}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaFunction{â„­}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaFunction{ğ•}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ†}}\AgdaSpace{}%
\AgdaFunction{ğ•}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{birkhoff}\AgdaSpace{}%
\AgdaBound{Cset}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ‘¨}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{MThVA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Î³}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaFunction{T}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{OV}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ‘†}\<%
\\
%
\>[3]\AgdaFunction{T}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ğ‘»}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[3]\AgdaFunction{hâ‚€}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\<%
\\
%
\>[3]\AgdaFunction{hâ‚€}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ•}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[3]\AgdaFunction{hâ‚€E}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Epic}\AgdaSpace{}%
\AgdaFunction{hâ‚€}\<%
\\
%
\>[3]\AgdaFunction{hâ‚€E}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{snd}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ•}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[3]\AgdaFunction{Ï•}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{hom}\AgdaSpace{}%
\AgdaFunction{ğ”½}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaFunction{Epic}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\<%
\\
%
\>[3]\AgdaFunction{Ï•}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ğ”‰-lift-hom}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaFunction{hâ‚€}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{ğ”‰-lift-of-epic-is-epic}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaFunction{hâ‚€}\AgdaSpace{}%
\AgdaFunction{hâ‚€E}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[3]\AgdaFunction{AiF}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{is-hom-image-of}}\AgdaSpace{}%
\AgdaFunction{ğ”½}\<%
\\
%
\>[3]\AgdaFunction{AiF}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaFunction{fst}\AgdaSpace{}%
\AgdaFunction{Ï•}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaFunction{fst}\AgdaSpace{}%
\AgdaFunction{Ï•}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{snd}\AgdaSpace{}%
\AgdaFunction{Ï•}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{refl-â‰…}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[3]\AgdaFunction{Î³}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆˆ}}\AgdaSpace{}%
\AgdaFunction{ğ•}\<%
\\
%
\>[3]\AgdaFunction{Î³}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{vhimg}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ğ”½âˆˆğ•}\AgdaSpace{}%
\AgdaBound{Cset}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{AiF}\<%
\end{code}
\ccpad
Some readers might worry that we haven't quite acheived our goal because what we just proved (\href{https://ualib.gitlab.io/UALib.Birkhoff.Theorem.html#1487}{birkhoff}) is not an ``if and only if'' assertion. Those fears are quickly put to rest by noting that the converse---that every equational class is closed under HSP---was already established in the \href{UALib.Varieties.Preservation.html}{Equation Preservation} module. Indeed, there we proved the following identity preservation lemmas:
\begin{itemize}
\item \href{https://ualib.gitlab.io/UALib.Varieties.Preservation.html#964}{(H-id1)} ğ’¦ âŠ§ p â‰‹ q â†’ H ğ’¦ âŠ§ p â‰‹ q
\item \href{https://ualib.gitlab.io/UALib.Varieties.Preservation.html#2592}{(S-id1)} ğ’¦ âŠ§ p â‰‹ q â†’ S ğ’¦ âŠ§ p â‰‹ q
\item \href{https://ualib.gitlab.io/UALib.Varieties.Preservation.html#4111}{(P-id1)} ğ’¦ âŠ§ p â‰‹ q â†’ P ğ’¦ âŠ§ p â‰‹ q
\end{itemize}
From these it follows that every equational class is a variety.
