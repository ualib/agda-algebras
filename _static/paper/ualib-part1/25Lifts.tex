\subsubsection{The noncumulative universe hierarchy}\label{the-noncumulative-hierarchy}

The hierarchy of universe levels in Agda looks like this:\\[-4pt]

\ab{ùì§‚ÇÄ} \as : \ab{ùì§‚ÇÅ}\AgdaOperator{\AgdaFunction{Ãá}} , ~ ~ \ab{ùì§‚ÇÅ} \as : \ab{ùì§‚ÇÇ}\AgdaOperator{\AgdaFunction{Ãá}} , ~ ~ \ab{ùì§‚ÇÇ} \as : \ab{ùì§‚ÇÉ}\AgdaOperator{\AgdaFunction{Ãá}} , \ldots{}\\[4pt]
This means that the type level of \ab{ùì§‚ÇÄ} is \ab{ùì§‚ÇÅ}\AgdaOperator{\AgdaFunction{Ãá}}, and for each \ab n the type level of \ab{ùì§‚Çô} is \ab{ùì§‚Çô‚Çä‚ÇÅ}\AgdaOperator{\AgdaFunction{Ãá}}.
It is important to note, however, this does \emph{not} imply that \ab{ùì§‚ÇÄ} \as : \ab{ùì§‚ÇÇ}\AgdaOperator{\AgdaFunction{Ãá}} and \ab{ùì§‚ÇÄ} \as : \ab{ùì§‚ÇÉ}\AgdaOperator{\AgdaFunction{Ãá}}, and so on. In other words, Agda's universe hierarchy is \defn{noncummulative}. This makes it possible to treat universe levels more generally and precisely, which is nice. On the other hand (in this author's experience) a noncummulative hierarchy can sometimes make for a nonfun proof assistant.

Luckily, there are ways to overcome this technical issue. We describe general lifting and lowering functions below, and then later, in \S\ref{lifts-of-algebras},
 % \href{https://ualib.gitlab.io/Algebras.Algebras.html\#lifts-of-algebras}{Lifts
we'll see the domain-specific analogs of these tools which turn out to have some nice properties that make them very effective for resolving universe level problems when working with algebra datatypes.

\subsubsection{Lifting and lowering}\label{lifting-and-lowering}

Let us be more concrete about what is at issue here by giving an example. Agda frequently encounters errors during the type-checking process and responds by printing an error message. Often the message has the following form.
{\color{red}{\small
\begin{verbatim}
  Algebras.lagda:498,20-23 ùì§ != ùìû ‚äî ùì• ‚äî ùì§ ‚Å∫ when checking that... has type...
\end{verbatim}}}
\noindent This error message means that Agda encountered the universe \ab{ùì§} on line 498 (columns 20--23) of the file \af{Algebras.lagda}, but was expecting to find the universe \ab{ùìû} \aop ‚äî \ab ùì• \aop ‚äî \ab ùì§\af ‚Å∫ instead.

To make these situations easier to deal with, we have developed some domain specific tools for the lifting and lowering of universe levels inhabited by algebra types. (Later we do the same for other domain specific types like homomorphisms, subalgebras, products, etc). This must be done carefully to avoid making the type theory inconsistent. In particular, we cannot lower the level of a type unless it was previously lifted to a (higher than necessary) universe level.

A general \af{Lift} record type, similar to the one found in the \am{Level} module of the \agdastdlib, is defined as follows.
\ccpad
\begin{code}%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}%
\>[50]\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\<%
\\
%
\>[1]\AgdaKeyword{field}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Lift}\<%
\end{code}
\ccpad
Using the \af{Lift} type, we define two functions that lift the domain (respectively, codomain) type of a function to a higher universe.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{lift-dom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Lift}\AgdaSymbol{\{}\AgdaBound{ùì¶}\AgdaSymbol{\}\{}\AgdaBound{ùìß}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{lift-dom}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{lower}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{lift-cod}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSymbol{\{}\AgdaBound{ùì¶}\AgdaSymbol{\}\{}\AgdaBound{ùì®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{lift-cod}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\end{code}
\ccpad
Naturally, we can combine these and define a function that lifts both the domain and codomain type.
\ccpad
\begin{code}
\>[1]\AgdaFunction{lift-fun}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Lift}\AgdaSymbol{\{}\AgdaBound{ùì¶}\AgdaSymbol{\}\{}\AgdaBound{ùìß}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSymbol{\{}\AgdaBound{ùì©}\AgdaSymbol{\}\{}\AgdaBound{ùì®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{lift-fun}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{lower}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\<%
\end{code}
\ccpad
For example, \af{lift-dom} takes a function \ab f defined on the domain \AgdaBound{X}\AgdaSpace{}\AgdaSymbol{:}\AgdaSpace{}\AgdaBound{ùìß}\AgdaSpace{}\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{} and returns a function defined on the domain \ar{Lift}\as{\{}\ab ùì¶\as{\}}\as{\{}\ab ùìß\as{\}} \ab X \as : \ab ùìß \aop ‚äî \ab ùì¶\aof Ãá.

The point of a ramified hierarchy of universes is to avoid Russell's paradox, and this would be subverted if we lower the universe of a type that hasn't already be lifted.  Fortunately, however, we can prove that \aic{lift} and \afld{lower} compose to the identity. Later, there will be some situations that require these facts, so we formalize them and their (trivial) proofs.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{lower‚àºlift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{lower}\AgdaSymbol{\{}\AgdaBound{ùì¶}\AgdaSymbol{\}\{}\AgdaBound{ùìß}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaFunction{ùëñùëë}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
\>[0]\AgdaFunction{lower‚àºlift}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{lift‚àºlower}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaFunction{ùëñùëë}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Lift}\AgdaSymbol{\{}\AgdaBound{ùì¶}\AgdaSymbol{\}\{}\AgdaBound{ùìß}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{lift‚àºlower}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\end{code}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "ualib-part1-20210304.tex"
%%% End:
