\documentclass[a4paper,UKenglish,cleveref,autoref,thm-restate]{lipics-v2021}
%% The next 3 lines are recommended at: https://agda.readthedocs.io/en/v2.6.1.1/tools/generating-latex.html#known-pitfalls-and-issues
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily]{}
\setmainfont{Latin Modern Roman}%% \usepackage{mathabx}


\usepackage{proof-dashed}
%% \usepackage{unicode-math}
\usepackage{comment}
%% \setmainfont{XITS}
%% [    Extension = .otf,
%%    UprightFont = *-Regular,
%%       BoldFont = *-Bold,
%%     ItalicFont = *-Italic,
%% BoldItalicFont = *-BoldItalic,
%% ]
%% \setmathfont{XITSMath-Regular}
%% [    Extension = .otf,
%%       BoldFont = XITSMath-Bold,
%% ]

%% \usepackage{newunicodechar}
%% \newunicodechar{Î»}{\ensuremath{\mathnormal\lambda}}
%% \newunicodechar{â‹‚}{\ensuremath{\mathnormal\bigcap}}
%% \newunicodechar{â¨…}{\ensuremath{\mathnormal\bigsqcap}}

\usepackage[newwjd,links]{agda}
\usepackage{wjd}
\usepackage{unixode}

%This is a template for producing LIPIcs articles. 
%See lipics-v2021-authors-guidelines.pdf for further information.
%for A4 paper format use option "a4paper", for US-letter use option "letterpaper"
%for british hyphenation rules use option "UKenglish", for american hyphenation rules use option "USenglish"
%for section-numbered lemmas etc., use "numberwithinsect"
%for enabling cleveref support, use "cleveref"
%for enabling autoref support, use "autoref"
%for anonymousing the authors (e.g. for double-blind review), add "anonymous"
%for enabling thm-restate support, use "thm-restate"
%for enabling a two-column layout for the author/affilation part (only applicable for > 6 authors), use "authorcolumns"
%for producing a PDF according the PDF/A standard, add "pdfa"

%\graphicspath{{./graphics/}}%helpful if your graphic files are in another directory

%% \pdfmapfile{+fontawesome5.map}
\bibliographystyle{plainurl}% the mandatory bibstyle

\title{The Agda UALib and Birkhoff's Theorem\\ in Martin-L\"of Dependent Type Theory}

\titlerunning{} %The Agda Universal Algebra Library} %TODO optional, please use if title is longer than one line

\author{William DeMeo}
       {Department of Algebra, Charles University in Prague \and \url{https://williamdemeo.gitlab.io}}
       {williamdemeo@gmail.com}
       {https://orcid.org/0000-0003-1832-5690}
       {}

\authorrunning{}
%W.~J.~DeMeo}

\usepackage{fancyhdr}
\fancyfoot{}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[ER]{\sffamily\bfseries \leftmark}
\fancyhead[OL]{\sffamily\bfseries The Agda Universal Algebra Library}
\fancyhead[EL,OR]{\sffamily\bfseries \thepage}
\renewcommand{\headrulewidth}{0pt}

\Copyright{William J. DeMeo}

\ccsdesc[500]{Theory of computation~Constructive mathematics}
\ccsdesc[500]{Theory of computation~Type theory}
\ccsdesc[500]{Theory of computation~Logic and verification}
\ccsdesc[300]{Computing methodologies~Representation of mathematical objects}
\ccsdesc[300]{Theory of computation~Type structures}
%% \ccsdesc[100]{\textcolor{red}{Replace ccsdesc macro with valid one}} %TODO mandatory: Please choose ACM 2012 classifications from https://dl.acm.org/ccs/ccs_flat.cfm 

\keywords{Universal algebra, Equational logic, Martin-LÃ¶f Type Theory, Birkhoffâ€™s HSP Theorem, Formalization of mathematics, Agda, Proof assistant}

\category{} %optional, e.g. invited paper

\relatedversion{hosted on arXiv}
\relatedversiondetails[linktext={arxiv.org/pdf/2101.10166}]{Extended Version}{https://arxiv.org/pdf/2101.10166}

%% \supplement{Source code at \ualibrepo}%
%% optional, e.g. related research data, source code, ... hosted on a repository like zenodo, figshare, GitHub, ...
%% \supplementdetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93, subcategory={Description, Subcategory}, swhid={Software Heritage Identifier}]{General Classification (e.g. Software, Dataset, Model, ...)}{URL to related version} %linktext, cite, and subcategory are optional
%% \supplementdetails[swhid={Software Heritage Identifier}]{Software}{https://gitlab.com/ualib/ualib.gitlab.io.git}
\supplement{~\\ \textit{Documentation}: \ualibdotorg}%
\supplementdetails{Software}{https://gitlab.com/ualib/ualib.gitlab.io.git}

\acknowledgements{The author wishes to thank Hyeyoung Shin and Siva Somayyajula for their contributions to this project and \MartinEscardo for creating the \TypeTopology library and teaching a course on \href{https://www.cs.bham.ac.uk/~mhe/HoTT-UF-in-Agda-Lecture-Notes/index.html}{Univalent Foundations of Mathematics with Agda} at the \href{http://events.cs.bham.ac.uk/mgs2019/}{2019 Midlands Graduate School in Computing Science}. Of course, this work would not exist in its current form without the Agda 2 language by Ulf Norell.\footnote{Agda 2 is partially based on code from Agda 1 by Catarina Coquand and Makoto Takeyama, and from Agdalight by Ulf Norell and Andreas Abel.}}

%\nolinenumbers %uncomment to disable line numbering

%\hideLIPIcs  %uncomment to remove references to LIPIcs series (logo, DOI, ...), e.g. when preparing a pre-final version to be uploaded to arXiv or another public repository

%Editor-only macros:: begin (do not touch as author)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\EventEditors{}
\EventNoEds{2}
\EventLongTitle{}
\EventShortTitle{}
\EventAcronym{}
\EventYear{2021}
\EventDate{January 19, 2021}
\EventLocation{}
\EventLogo{}
\SeriesVolume{0}
\ArticleNo{0}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\maketitle
%TODO mandatory: add short abstract of the document

\begin{abstract}
The Agda Universal Algebra Library (\ualib) is a library of types and programs (theorems and proofs) we developed to formalize the foundations of universal algebra in Martin-LoÌˆf dependent type theory using the \agda programming language and proof assistant. This paper describes the UALib and demonstrates how it makes Agda more accessible to working mathematicians (like ourselves) as a tool for formally verifying ``known'' results in general algebra and related fields, as well as for discovering new theorems in these areas.  The library already includes a substantial collection of definitions, theorems, and proofs from universal algebra and as such provides many examples that exhibit the power of inductive and dependent types for representing and reasoning about algebraic and relational structures.

The first major milestone of the \ualib project is a complete proof of Birkhoff's HSP Theorem. To the best of our knowledge, this is the first time Birkhoff's Theorem has been formulated and proved in dependent type theory and verified with a proof assistant.

In this paper we describe the UALib and the formal proof of Birkhoff's theorem, discussing some of the challenges we faced and how these hurdles were overcome. In so doing, we illustrate the effectiveness of dependent type theory, Agda, and the UALib for proving and verifying theorems in universal algebra.
\end{abstract}

%% \setcounter{tocdepth}{2}
%% \tableofcontents

\section{Introduction}\label{sec:introduction}
To support formalization in type theory of research level mathematics in universal algebra and related fields, we present the Agda Universal Algebra Library (\agdaualib), a software library containing formal statements and proofs of the core definitions and results of universal algebra. 
The \agdaualib is written in \agda~\cite{Norell:2009}, a programming language and proof assistant based on Martin-L\"of Type Theory that not only supports dependent and inductive types, but also provides powerful \emph{proof tactics} for proving things about the objects that inhabit these types.

There have been a number of prior efforts to formalize parts of universal algebra in type theory, most notably
\begin{itemize}
  \item Capretta~\cite{Capretta:1999} (1999) formalized the basics of universal algebra in the Calculus of Inductive Constructions using the Coq proof assistant;
    \item Spitters and van der Weegen~\cite{Spitters:2011} (2011) formalized the basics of universal algebra and some classical algebraic structures, also in the Calculus of Inductive Constructions using the Coq proof assistant, promoting the use of type classes as a preferable alternative to setoids;
 \item Gunther, et al~\cite{Gunther:2018} (2018) developed what seems to be (prior to the \ualib) the most extensive library of formal universal algebra to date; in particular, this work includes a formalization of some basic equational logic; the project (like the \ualib) uses Martin-L\"of dependent type theory and the Agda proof assistant.
\end{itemize}
Some other projects aimed at formalizing mathematics generally, and algebra in particular, have developed into very extensive libraries that include definitions, theorems, and proofs about algebraic structures, such as groups, rings, modules, etc.  However, goals of this prior work seem to be the formalization of special classical algebraic structures, as opposed to the general theory of (universal) algebras.

Although the \agdaualib project was initiated relatively recently (in 2018), the part of universal algebra and equational logic that it formalizes extends beyond the scope of prior efforts.  In particular, the \ualib now includes the only formal, constructive, machine-checked proof of Birkhoff's variety theorem that we know of. We remark that, with the exception of~\cite{Carlstrom:2008}, all other proofs of Birkhoff's theorem we have seen are informal and not known to be constructive.

%% \subsection{Vision and Goals}\label{vision-and-goals}
The seminal idea for the \agdaualib project was the observation that, on the one hand, a number of fundamental constructions in universal algebra can be defined recursively, and theorems about them proved by structural induction, while, on the other hand, inductive and dependent types make possible very precise formal representations of recursively defined objects, which often admit elegant constructive proofs of properties of such objects.  An important feature of such proofs in type theory is that they are total functional programs and, as such, they are computable and composable.
%% These observations suggested that there would be much to gain from implementing universal algebra in a language, such as Martin-L\"of type theory, that features dependent and inductive types.

Finally, our own research experience has taught us that a proof assistant and programming language (like Agda), when equipped with specialized libraries and domain-specific tactics to automate proof idioms of a particular field, can be an extremely powerful and effective asset. We believe that such libraries, and the proof assistants they support, will eventually become indispensable tools in the working mathematician's toolkit.

\subsection{Contributions}
\label{sec:contributions}
Apart from the library itself, we describes the formal implementation and proof of a deep result, Garrett Birkhoff's celebrated HSP Theorem~\cite{Birkhoff:1935}, which was among the first major results of universal algebra.  The theorem states that a \defn{variety} (a class of algebras closed under quotients, subalgebras, and products) is an equational class.  %% More precisely, a class ğ’¦ of algebras is closed under the taking of quotients, subalgebras, and arbitrary products if and only if ğ’¦ is the class of algebras satisfying a certain set of equations.
The fact that we now have a formal proof of this theorem in Agda is noteworthy, not only because this is the first time the theorem has been proved in dependent type theory and verified with a proof assistant, but also because our proof is \emph{constructive}. As the paper~\cite{Carlstrom:2008} of Carlstr\"om makes clear, it is a highly nontrivial exercise to take a well-known informal proof of a theorem like Birkhoff's and to show that it can be formalized using only constructive logic and natural deduction, without appealing to, say, the Law of the Excluded Middle or the Axiom of Choice.

%% Prelude %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Preliminaries}\label{sec:preliminaries}

This section describes some of the more important parts of the \agdaualib module called \ualibPreliminaries, which imports everything we need from Martin Escardo's \typetopology library~\cite{MHE}, defines some other basic types and proves some of their properties.  We do not cover the entire Preliminaries module here, but call attention to aspects that differ from standard Agda syntax. For more details, see~\cite[\S2]{DeMeo:2021}.

%%--BEGIN: \input{Preliminaries-short.tex}-----------------------------------------------

%% \noindent \textbf{Notation}. Here are some acronyms that we use frequently.
%% \begin{itemize}
%% \tightlist
%% \item \mhe = \MHE
%% \item \mltt = \MLTT
%% \end{itemize}

\subsection{Options and imports}\label{ssec:options-and-imports}
Agda programs typically begin by setting some options and by importing from existing libraries.
Options are specified with the \AgdaKeyword{OPTIONS} \emph{pragma} and control the way Agda behaves by, for example, specifying which logical foundations should be assumed when the program is type-checked to verify its correctness.  
All Agda programs in the \ualib begin with the pragma
\ccpad
\begin{code}[number=code:options]
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{OPTIONS}\AgdaSpace{}%
\AgdaPragma{--without-K}\AgdaSpace{}%
\AgdaPragma{--exact-split}\AgdaSpace{}%
\AgdaPragma{--safe}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\end{code}
\ccpad
This has the following effects:
\begin{enumerate}
\item
  \texttt{without-K} disables \axiomk; see~\cite{agdaref-axiomk};
\item
  \texttt{exact-split} makes Agda accept only definitions that are \emph{judgmental} or \emph{definitional} equalities. As \escardo explains, this ``makes sure that pattern matching corresponds to Martin-LÃ¶f eliminators;'' for more details see~\cite{agdatools-patternmatching};
\item
  \texttt{safe} ensures that nothing is postulated outright---every non-MLTT axiom has to be an explicit assumption (e.g., an argument to a function or module); see~\cite{agdaref-safeagda} and~\cite{agdatools-patternmatching}.
\end{enumerate}
Throughout this paper we take assumptions 1--3 for granted without mentioning them explicitly.

%% \subsection{Imports from Type Topology}\label{imports-from-type-topology}
The \agdaualib adopts the notation of the \typetopology library. In particular, universes are denoted by capitalized script letters from the second half of the alphabet, e.g., \ab ğ“¤, \ab ğ“¥, \ab ğ“¦, etc. Also defined in \typetopology are the operators~\af Ì‡~and~\af âº. These map a universe \ab ğ“¤ to \ab ğ“¤ \af Ì‡ := \Set \ab ğ“¤ and \ab ğ“¤ \af âº \aod := \lsuc \ab ğ“¤, respectively.  Thus, \ab ğ“¤ \af Ì‡ is simply an alias for \Set \ab ğ“¤, and we have \ab ğ“¤ \af Ì‡ \as : (\ab ğ“¤ \af âº) \af Ì‡. Table~\ref{tab:dictionary} of the appendix translates between standard \agda syntax and \typetopology/\ualib notation.


\section{Truncation}\label{sec:truncation}
In general, we may have many inhabitants of a given type, hence (via Curry-Howard correspondence) many proofs of a given proposition. For instance, suppose we have a type \ab X and an identity relation \AgdaOperator{\AgdaDatatype{â‰¡â‚“}} on \ab X so that, given two inhabitants of \ab X, say, \ab a\AgdaSpace{}\ab b \as : \ab X, we can form the type \ab a \AgdaOperator{\AgdaDatatype{â‰¡â‚“}} \ab b. Suppose \ab p and \ab q inhabit the type \ab a \AgdaOperator{\AgdaDatatype{â‰¡â‚“}} \ab b; that is, \ab p and \ab q are proofs of \ab a \AgdaOperator{\AgdaDatatype{â‰¡â‚“}} \ab b, in which case we write \ab p \ab q : \ab a \AgdaOperator{\AgdaDatatype{â‰¡â‚“}} \ab b. Then we might wonder whether and in what sense are the two proofs \ab p and \ab q the ``same.'' We are asking about an identity type on the identity type \AgdaOperator{\AgdaDatatype{â‰¡â‚“}}, and whether there is some inhabitant \ab r of this type; i.e., whether there is a proof \ab r : \ab p \AgdaOperator{\AgdaDatatype{â‰¡â‚“â‚}} \ab q.  If such a proof exists for all \ab p \ab q : \ab a \AgdaOperator{\AgdaDatatype{â‰¡â‚“}} \ab b, then we say that the proof of \ab a \AgdaOperator{\AgdaDatatype{â‰¡â‚“}} \ab b is \emph{unique}. As a property of the types \ab X and \aod{â‰¡â‚“}, this is sometimes called \emph{uniqueness of identity proofs}.

Perhaps we have two proofs, say, \ab r \ab s : \ab p \AgdaOperator{\AgdaDatatype{â‰¡â‚“â‚}} \ab q. Then it is natural to wonder whether \ab r \AgdaOperator{\AgdaDatatype{â‰¡â‚“â‚‚}} \ab s has a proof!  However, we may decide that at some level the potential to distinguish two proofs of an identity in a meaningful way (so-called \emph{proof relevance}) is not useful or interesting. At that point, say, at level \ab k, we might assume that there is at most one proof of any identity of the form \ab p  \AgdaOperator{\AgdaDatatype{â‰¡â‚“â‚–}} \ab q. This is called \emph{truncation}.
%% \href{https://www.cs.bham.ac.uk/~mhe/HoTT-UF-in-Agda-Lecture-Notes/HoTT-UF-Agda.html#truncation}{truncation}.

\subsection{Sets}\label{ssec:sets}
In \emph{homotopy type theory}~\cite{HoTT:2013}, a type \ab X with an identity relation \AgdaDatatype{â‰¡â‚“} is called an \defn{set} (or \defn{0-groupoid} or \defn{h-set}) if for every pair \ab a \ab b \as : \ab X of elements of type \ab X there is at most one proof of \ab a \AgdaDatatype{â‰¡â‚“} \ab b. This notion is formalized in the \TypeTopology library as follows:
\ccpad
\begin{code}[number=code:is-set]
\>[0]\AgdaFunction{is-set}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
\>[0]\AgdaFunction{is-set}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{is-subsingleton}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\end{code}
where
\begin{code}[number=code:is-subsingleton]
\>[0]\AgdaFunction{is-subsingleton}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
\>[0]\AgdaFunction{is-subsingleton}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{y}\<%
\end{code}
\ccpad
We will see some examples of truncation and sets later, but the interested reader may wish to consult~\cite[\S34-35]{MHE} or~\cite[\S7.1]{HoTT:2013} for more details.

%%--END: \input{Preliminaries-short.tex}-----------------------------------------------












\subsection{Monic functions are set embeddings}\label{ssec:monics-are-set-embeddings}
An \defn{embedding}, as defined in~\cite[\S26]{MHE}, is a function with \emph{subsingleton fibers}. The meaning of this will be clear from the definition, which involves the three functions \af{is-embedding}, \af{is-subsingleton}, and \af{fiber}. The second of these is defined in (\ref{code:is-subsingleton}); the other two are defined as follows.
\ccpad
\begin{code}
\>[0]\AgdaFunction{is-embedding}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
\>[0]\AgdaFunction{is-embedding}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{codomain}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{is-subsingleton}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fiber}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\end{code}
\scpad
\begin{code}
\>[0]\AgdaFunction{fiber}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
\>[0]\AgdaFunction{fiber}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaFunction{domain}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{y}\<%
\end{code}
\ccpad
This does not correspond simply to a \emph{monic} function (\S\ref{ssec:epic-and-monic-function-types}), and it is important to understand why not. Suppose \ab f~\as :~\ab X~\as â†’~\ab Y is a monic function from \ab X to \ab Y, so we have a proof \ab p \as : \af{Monic} \ab f.  To prove \ab f is an embedding we must show that for every \ab y~\as :~\ab Y we have
\AgdaFunction{is-subsingleton}\AgdaSpace{}\AgdaSymbol{(}\AgdaFunction{fiber}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}.  That is, for all \ab y \as : \ab Y, we must prove the following implication:
%% show that if (\ab x \ac \ab p) and (\ab{x'} \ac \ab q) satisfy\\
\begin{equation*}
  \infer{(\ab x \Mac \ab p) \Maof â‰¡ (\ab{x'} \Mac \ab q)}
    {(\ab x \ \ab{x'} \Mas : \ab X) & (\ab p \Mas : \ab f \ \ab x \Maof â‰¡ \ab y) & (\ab q \Mas : \ab f\  \ab{x'} \Maof â‰¡ \ab y) & (\ab m \Mas : \af{Monic}\ \ab f)}
\end{equation*}
By \ab m, \ab p, and \ab q, we have \ab r \as : \ab x \aof â‰¡ \ab{x'}.
%% ; applying this to our initial antecedent gives (\af{ap} \ab q \ab r) \as : \ab f \ \ab x \aof â‰¡ \ab y.
%% \ab p \as : \ab f \ab x \aof â‰¡ \ab y and \ab q \as : \ab f \ab x \aof â‰¡ \ab y.
%% \\
%% \\
%% (\ab x \ab{x'} \as : \ab X) \hskip3mm (\ab a : \ab x \aof â‰¡ \ab{x'}) \hskip3mm (\ab p \as : \ab f \ab x \aof â‰¡ \ab y) \hskip3mm (\ab q \as : \ab f \ab x \aof â‰¡ \ab y)\\
%% \\
Thus, in order to prove \ab f~is an embedding, we must somehow show that the proofs \ab p and \ab q (each of which entails \ab f \ab x \aof â‰¡ \ab y) are the same.  However, there is no axiom or deduction rule in \mltt to indicate that \ab p \aof â‰¡ \ab q must hold; indeed, the two proofs may differ.

One way we could resolve this is to assume that the codomain type, \ab B, is a \emph{set}, i.e., has \emph{unique identity proofs}.
%% , then we can prove that a injective function into \ab B is an embedding.
Recall the definition~(\ref{code:is-set}) of \af{is-set} from the \typetopology library.
%% It is clear that this is precisely what we need.  That is, i
If the codomain of \ab f \as : \ab A â†’ \ab B is a set, and if \ab p and \ab q are two proofs of an equality in \ab B, then \ab p \aof â‰¡ \ab q, and we can use this to prove that a injective function into \ab B is an embedding.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{monic-into-set-is-embedding}
\>[371I]\AgdaSymbol{:}%
\>[372I]\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{is-set}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{â†’}%
\>[.][@{}l@{}]\<[372I]%
\>[21]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}%
\>[44]\AgdaSymbol{â†’}%
\>[47]\AgdaFunction{Monic}\AgdaSpace{}%
\AgdaBound{f}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[21]\AgdaComment{--------------------}\<%
\\
%
\>[2]\AgdaSymbol{â†’}%
\>[21]\AgdaFunction{is-embedding}\AgdaSpace{}%
\end{code}
\ccpad
We omit the formal proof for lack of space, but see~\cite[\S2.3]{DeMeo:2021}.
%%-- END: \input{Inverses-short.tex}----------------------------------------------------








\subsection{Relation truncation}\label{ssec:relation-truncation}
Here we discuss a special technical issue that will arise when working with quotients, specifically when we must determine whether two equivalence classes are equal. %% Recall (\S\ref{sssec:truncation-and-hsets}), the concept of truncation as it relates to ``proof-relevant'' mathematics. 
Given a binary relation\footnote{Binary relations, as represented in Agda in general and the \ualib in particular, are described in \S\ref{ssec:binary-relations}.} \af P, it may be necessary or desirable to assume that there is at most one way to prove that a given pair of elements is \af P-related. This is an example of \defn{proof-irrelevance}; indeed, under this assumption, proofs of \af P \ab x \ab y are indistinguishable, or rather distinctions are irrelevant in given context.

In the \ualib, the \af{is-subsingleton} type of \typetopology is used to express the assertion that a given type is a set, or \defn{0-truncated}.  Above we defined truncation for a type with an identity relation, but the general principle can be applied to arbitrary binary relations.  Indeed, we say that \af P is a \defn{0-truncated binary relation} on \ab X if for all \ab x \ab y \as : \ab X we have \af{is-subsingleton} (\af P \ab x \ab y).
\ccpad
\begin{code}%
\>[1]\AgdaFunction{Relâ‚€}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{Relâ‚€}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{is-subsingleton}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\end{code}
\ccpad
Thus, a \defn{set}, as defined in \S\ref{ssec:sets}, is a type \ab X along with an equality relation \af â‰¡ of type \af{Relâ‚€} \ab X \ab ğ“, for some \ab ğ“.

















%% Algebras %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Algebras}\label{sec:types-for-algebras}

%% \subsection{Operation and Signature Types}\label{sec:operation-and-signature-types}
%% This section describes parts of the \ualibSignatures module of the \agdaualib.
%% --BEGIN: \input{Signatures-short.tex}-----------------------------
\newcommand\signatOV{\AgdaFunction{Signature}\AgdaSpace{}\AgdaBound{ğ“}\AgdaSpace{}\AgdaBound{ğ“¥}\xspace}
%% \subsubsection{Operation type}\label{operation-type}

We define the type of \defn{operations} and, as an example, the type of \defn{projections}.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{Op}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[0]\AgdaFunction{Op}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\\
\>[1]\AgdaFunction{Ï€}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Op}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\>[1]\AgdaFunction{Ï€}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\<%
\end{code}
\ccpad
The type \AgdaFunction{Op} encodes the arity of an operation as an arbitrary type \ab I : \ab ğ“¥ Ì‡, which gives us a very general way to represent an operation as a function type with domain \ab I â†’ \ab A (the type of ``tuples'') and codomain \ab A. The last two lines of the code block above codify the \ab i-th \ab I-ary projection operation on \ab A.

\subsection{Signature type}\label{signature-type}
We define the signature of an algebraic structure in Agda like this.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
\>[0]\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{F}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{)}\<%
\end{code}
\ccpad
Here \AgdaBound{ğ“} is the universe level of operation symbol types, while \AgdaBound{ğ“¥} is the universe level of arity types. Recall (\S\ref{ssec:dependent-pairs-and-projections}), we denote the first and second projections by \ai âˆ£ and \ai âˆ¥, so if \ab ğ‘† is a signature, then \aiab{âˆ£}{ğ‘†} denotes the type of \defn{operation symbols}, and \aiab{âˆ¥}{ğ‘†} denotes the \defn{arity} function. If \ab ğ‘“ \as : \aiab{âˆ£}{ğ‘†} is an operation symbol in the signature \ab ğ‘†, then \aiab{âˆ¥}{ğ‘†} \ab ğ‘“ is the arity of \ab ğ‘“.

For example,
%% \subsubsection{Example}\label{Signatures.sssec:example}
here is the signature of \emph{monoids}, as a member of the type \signatOV.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{monoid-op}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{e}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{monoid-op}\<%
\\
%
\>[2]\AgdaInductiveConstructor{Â·}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{monoid-op}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{monoid-sig}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaBound{ğ“¤â‚€}\<%
\\
%
\>[1]\AgdaFunction{monoid-sig}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{monoid-op}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaInductiveConstructor{e}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{ğŸ˜}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{Â·}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{ğŸš}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}
\ccpad
This signature has two operation symbols, \aic e and \aic Â·, and a function \as Î» \as{\{} \AgdaInductiveConstructor{e} \as â†’ \af ğŸ˜ \as ; \AgdaInductiveConstructor{Â·} \as â†’ \af ğŸš \as{\}} which maps \aic e to the empty type \af ğŸ˜ (since \aic e is nullary), and \aic Â· to the 2-element type \af ğŸš (since \aic Â· is binary).
%% -- END: \input{Signatures-short.tex}-----------------------------








\newcommand\sigOV{\AgdaFunction{Signature}\AgdaSpace{}\AgdaBound{ğ“}\AgdaSpace{}\AgdaBound{ğ“¥}\xspace}
\subsection{Algebra type}\label{ssec:algebra-type}
For a fixed signature \ab S \as : \sigOV and universe \ab ğ“¤, we define the type of \defn{algebras} in the signature \ab ğ‘† (or \ab ğ‘†-\defn{algebras}) and with \defn{domain} (or \defn{carrier}) \ab ğ´ \as : \ab ğ“¤ \as Ì‡ as follows\footnote{The \agdaualib includes an alternative definition of the type of algebras using records, but we don't discuss these here since they are not needed in the sequel. We refer the interested reader to~\cite{DeMeo:2021} and the html documentation available at \url{https://ualib.gitlab.io/UALib.Algebras.Algebras.html}.}
\ccpad
\begin{code}%
\>[0]\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{)(}\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaGeneralizable{ğ“}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¥}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}%
\>[50]\AgdaGeneralizable{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaGeneralizable{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{Algebra}\AgdaSpace{}%
%% \>[0]\AgdaFunction{âˆ-algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}%
\>[13]\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Op}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\end{code}
\ccpad
We may refer to an inhabitant of \af{Algebra} \ab ğ‘† \AgdaBound{ğ“¤} as an ``âˆ-algebra'' because its domain can be an arbitrary type, say, \ab A \as : \ab ğ“¤ \af Ì‡ and need not be truncated at some level; in particular, \ab A need not be a set (as defined in \S\ref{ssec:sets}).

We could pause here to define the type of ``0-algebras,'' which are algebras whose domains are sets. This type is probably closer to what most of us think of when doing informal universal algebra. However, in the \ualib we have so far only needed to know that the domain of an algebra is a set in a handful of specific instances, so it seems preferable to work with general (âˆ-)algebras throughout the library and then assume \emph{uniquness of identity proofs} explicitly where, and only where, a proof relies on this assumption.

%% The type \ad{Algebra} \ab ğ“¤ \ab ğ‘† has type \ab ğ“ \af âŠ” \ab ğ“¥ \af âŠ” \ab ğ“¤ \af âº \af Ì‡, and the latter appears so often in the \ualib that we will refer to it by using the following shorthand for its level: \AgdaFunction{OV}\AgdaSpace{}\ab ğ“¤ = \ab ğ“ \af âŠ” \ab ğ“¥ \af âŠ” \ab ğ“¤ \af âº.









\subsection{Operation interpretation, variable symbols}\label{ssec:operation-interpretation-syntax}
Next we define a convenient shorthand for the interpretation of an operation symbol. We use this often in the sequel.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}Ì‚\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)(}\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{f}%
\>[48]\AgdaSymbol{â†’}%
\>[51]\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‚}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{x}\<%
\end{code}
\ccpad
This is similar to the standard notation that one finds in the literature and seems much more natural to us than the double bar notation that we started with.

%% \subsection{Arbitrarily many variable symbols}
Finally, we will want to assume that we always have at our disposal an arbitrary collection \ab X of variable symbols such that, for every algebra \ab ğ‘¨, no matter the type of its domain, we have a surjective map \ab{hâ‚€} \as : \ab X \as â†’ \aiab{âˆ£}{ğ‘¨} from variables onto the domain of \ab ğ‘¨.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}â† \AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{â† }}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaFunction{Epic}\AgdaSpace{}%
\AgdaBound{h}\<%
\end{code}

%%--  END: \input{Algebras-short.tex}-----------------------------




















\subsection{Product algebra type}\label{ssec:product-algebra-type}
This section describes some parts of the \ualibAlgProducts module of the \agdaualib.
%% -- BEGIN: \input{Products-short.tex}
We define products of algebras for the Sigma type representation defined above.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{â¨…}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“˜}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“˜}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}(}\AgdaBound{ğ’œ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“˜}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ‘†}\<%
\\
%
\>[1]\AgdaFunction{â¨…}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“˜}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ğ’œ}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{((}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ’œ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Î»(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)(}\AgdaBound{ğ’‚}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{j}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ’œ}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‚}}\AgdaSpace{}%
\AgdaBound{ğ’œ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{Î»\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ’‚}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{\}}\<%
\end{code}

%% -- END: \input{Products-short.tex}




















\subsection{The lift of an algebra}\label{ssec:the-lift-of-an-algebra}
%% This section describes parts of the \ualibLifts module of the \agdaualib.
%% BEGIN: \input{Lifts-short.tex}
The hierarchy of universe levels in Agda is \emph{noncumulative} (\S\ref{ssec:agdas-universe-hierarchy}) and this can make certain proof verification (i.e., type-checking) tasks seem unnecessarily difficult. Luckily there are ways to circumvent noncumulativity without introducing logical inconsistencies into the type theory. We present here some domain specific tools that we developed for this purpose. (See~\cite[\S3.3]{DeMeo:2021} for more details).

A general \af{Lift} record type, similar to the one found in the \af{Level} module of the \agdastdlib, is
defined as follows.
\ccpad
\begin{code}%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}%
\>[50]\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\<%
\\
%
\>[1]\AgdaKeyword{field}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Lift}\<%
\end{code}
\ccpad
It is useful to know that \AgdaInductiveConstructor{lift} and \AgdaField{lower} compose to the identity.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{lowerâˆ¼lift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaField{lower}\AgdaSymbol{\{}\AgdaBound{ğ“§}\AgdaSymbol{\}\{}\AgdaBound{ğ“¦}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ˜}}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaFunction{ğ‘–ğ‘‘}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
\>[0]\AgdaFunction{lowerâˆ¼lift}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\end{code}
\ccpad
Similarly, \AgdaInductiveConstructor{lift}\AgdaSpace{}\AgdaOperator{\AgdaFunction{âˆ˜}}\AgdaSpace{}\AgdaField{lower}\AgdaSpace{}\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}\AgdaFunction{ğ‘–ğ‘‘}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Lift}\AgdaSymbol{\{}\AgdaBound{ğ“§}\AgdaSymbol{\}\{}\AgdaBound{ğ“¦}\AgdaSymbol{\}}.
More domain-specifically, here is how we lift types of operations and algebras.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{lift-op}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{â†’}%
\>[11]\AgdaSymbol{((}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{)}%
\AgdaSymbol{â†’}%
\AgdaSymbol{((}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaBound{ğ“¦}\AgdaSymbol{\}}\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaBound{ğ“¦}\AgdaSymbol{\}}\AgdaBound{A}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{lift-op}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(Î»}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)))}\<%
\\
%
\\
\>[1]\AgdaFunction{lift-âˆ-algebra}\AgdaSpace{}%
\AgdaFunction{lift-alg}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ‘†}\<%
\\
%
\>[1]\AgdaFunction{lift-âˆ-algebra}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(Î»}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{lift-op}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{lift-alg}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{lift-âˆ-algebra}\<%
\end{code}

%% END: \input{Lifts-short.tex}










\section{Quotient Type}\label{sec:quotient-type}
Here we highlight some important parts of the \ualibQuotients module of the \agdaualib.
%% -- BEGIN: \input{Relations/Quotients.tex}

\subsection{Definitions and tools}\label{ssec:definitions-and-tools}
For a binary relation \ab R on \ab A, we denote a single \ab R-class by \af [ \ab a \af ] \ab R (this denotes the class containing \ab a). We denote the type of all classes of a relation \ab R on \ab A by \af ğ’ \as{\{} \ab A \as{\}} \as{\{} \ab R \as{\}}.  These are defined as in the \ualib as follows.
\ccpad
\begin{code}%
\>[1]\AgdaOperator{\AgdaFunction{[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\\
\>[1]\AgdaFunction{ğ’}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{ğ’}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{C}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\<%
\end{code}
\ccpad
There are a few ways we could define the quotient with respect to a relation. We have found the following to be the most convenient.
\ccpad
\begin{code}%
\>[1]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}/\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{/}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaFunction{,}%
\>[27]\AgdaFunction{ğ’}\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{C}\<%
\\
%
\>[1]\AgdaComment{-- old version:  A / R = Î£ C ê‰ Pred A ğ“¡ ,  Î£ a ê‰ A ,  C â‰¡ ( [ a ] R )}\<%
\end{code}
\ccpad
We then define the following introduction rule for a relation class with designated representative.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaOperator{\AgdaFunction{âŸ¦\AgdaUnderscore{}âŸ§}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{/}}\AgdaSpace{}%
\AgdaBound{R}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{âŸ¦}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŸ§}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{ğ“‡â„¯ğ’»ğ“}\<%
\end{code}
\ccpad


\begin{code}
\>[1]\AgdaOperator{\AgdaFunction{âŒœ\AgdaUnderscore{}âŒ}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{/}}\AgdaSpace{}%
\AgdaBound{R}%
\>[39]\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{âŒœ}}\AgdaSpace{}%
\AgdaBound{ğ’‚}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŒ}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{ğ’‚}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}%
\>[22]\AgdaComment{-- type âŒœ and âŒ as `\textbackslash{}cul` and `\textbackslash{}cur`}\<%
\end{code}
\ccpad
Later we will need the following tools for handling quotients.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{IsEquivalence}\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaBound{ğ“¡}\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{/-subset}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSymbol{\}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{â†’}%
\>[6]\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ†}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{/-subset}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{a'}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Req}\AgdaSpace{}%
\AgdaBound{Raa'}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Rax}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{trans}\AgdaSpace{}%
\AgdaBound{Req}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{sym}\AgdaSpace{}%
\AgdaBound{Req}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaBound{Raa'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{Rax}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{/-supset}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSymbol{\}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{â†’}%
\>[6]\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ‡}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{/-supset}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{a'}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Req}\AgdaSpace{}%
\AgdaBound{Raa'}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Ra'x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{trans}\AgdaSpace{}%
\AgdaBound{Req}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{Raa'}\AgdaSpace{}%
\AgdaBound{Ra'x}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{/-=Ì‡}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSymbol{\}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{â†’}%
\>[6]\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{=Ì‡}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{/-=Ì‡}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{a'}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Req}\AgdaSpace{}%
\AgdaBound{Raa'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{/-subset}\AgdaSpace{}%
\AgdaBound{Req}\AgdaSpace{}%
\AgdaBound{Raa'}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{/-supset}\AgdaSpace{}%
\AgdaBound{Req}\AgdaSpace{}%
\AgdaBound{Raa'}\<%
\end{code}



\subsection{Quotient extensionality}\label{ssec:quotient-extensionality}
We need a (subsingleton) identity type for congruence classes over sets so that we can equate two classes even when they are presented using different representatives. For this we assume that our relations are on sets, rather than arbitrary types. As mentioned earlier, this is equivalent to assuming that there is at most one proof that two elements of a set are the same.  The following \emph{class extensionality principle} accomplishes this for us.  (For the proof, consult~\cite{DeMeo:2021} or the \ualibdocs or the source code itself.)
\ccpad
\begin{code}%
%% \>[0][@{}l@{\AgdaIndent{1}}]%
%% \>[1]\AgdaFunction{class-extensionality}\AgdaSpace{}%
%% \AgdaSymbol{:}%
%% \>[200I]\AgdaFunction{propext}\AgdaSpace{}%
%% \AgdaBound{ğ“¡}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaFunction{global-dfunext}\<%
%% \\
%% \>[2]\AgdaSymbol{â†’}%
%% \>[.][@{}l@{}]\<[200I]%
%% \>[14]\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaBound{ğ“¤}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSpace{}%
%% \AgdaBound{a'}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaFunction{Rel}\AgdaSpace{}%
%% \AgdaBound{A}\AgdaSpace{}%
%% \AgdaBound{ğ“¡}\AgdaSymbol{\}}\<%
%% \\
%% \>[2]\AgdaSymbol{â†’}%
%% \>[14]\AgdaSymbol{(âˆ€}\AgdaSpace{}%
%% \AgdaBound{a}\AgdaSpace{}%
%% \AgdaBound{x}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaFunction{is-subsingleton}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{R}\AgdaSpace{}%
%% \AgdaBound{a}\AgdaSpace{}%
%% \AgdaBound{x}\AgdaSymbol{))}\<%
%% \\
%% \>[2]\AgdaSymbol{â†’}%
%% \>[14]\AgdaRecord{IsEquivalence}\AgdaSpace{}%
%% \AgdaBound{R}\<%
%% \\
%% \>[14]\AgdaComment{------------------------}\<%
%% \\
%% %
%% \>[2]\AgdaSymbol{â†’}%
%% \>[14]\AgdaBound{R}\AgdaSpace{}%
%% \AgdaBound{a}\AgdaSpace{}%
%% \AgdaBound{a'}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
%% \AgdaBound{a}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
%% \AgdaBound{R}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
%% \AgdaBound{a'}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
%% \AgdaBound{R}\AgdaSymbol{)}\<%
%% \\
%% %
%% \\[\AgdaEmptyExtraSkip]%
%% %
%% \>[1]\AgdaFunction{class-extensionality}\AgdaSpace{}%
%% \AgdaBound{pe}\AgdaSpace{}%
%% \AgdaBound{gfe}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaArgument{A}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{a'}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaBound{ssR}\AgdaSpace{}%
%% \AgdaBound{Req}\AgdaSpace{}%
%% \AgdaBound{Raa'}\AgdaSpace{}%
%% \AgdaSymbol{=}\<%
%% \\
%% \>[1][@{}l@{\AgdaIndent{0}}]%
%% \>[2]\AgdaFunction{Pred-=Ì‡-â‰¡}\AgdaSpace{}%
%% \AgdaBound{pe}\AgdaSpace{}%
%% \AgdaBound{gfe}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
%% \AgdaBound{a}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
%% \AgdaBound{R}\AgdaSymbol{\}\{}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
%% \AgdaBound{a'}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
%% \AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{ssR}\AgdaSpace{}%
%% \AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{ssR}\AgdaSpace{}%
%% \AgdaBound{a'}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaFunction{/-=Ì‡}\AgdaSpace{}%
%% \AgdaBound{Req}\AgdaSpace{}%
%% \AgdaBound{Raa'}\AgdaSymbol{)}\<%
%% \\
%% %
%% \\[\AgdaEmptyExtraSkip]%
%% %
%% \>[1]\AgdaFunction{to-subtype-âŸ¦âŸ§}\AgdaSpace{}%
%% \AgdaSymbol{:}%
%% \>[533I]\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaBound{ğ“¤}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaFunction{Rel}\AgdaSpace{}%
%% \AgdaBound{A}\AgdaSpace{}%
%% \AgdaBound{ğ“¡}\AgdaSymbol{\}\{}\AgdaBound{C}\AgdaSpace{}%
%% \AgdaBound{D}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaFunction{Pred}\AgdaSpace{}%
%% \AgdaBound{A}\AgdaSpace{}%
%% \AgdaBound{ğ“¡}\AgdaSymbol{\}}\<%
%% \\
%% \>[.][@{}l@{}]\<[533I]%
%% \>[17]\AgdaSymbol{\{}\AgdaBound{c}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaFunction{ğ’}\AgdaSpace{}%
%% \AgdaBound{C}\AgdaSymbol{\}\{}\AgdaBound{d}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaFunction{ğ’}\AgdaSpace{}%
%% \AgdaBound{D}\AgdaSymbol{\}}\<%
%% \\
%% \>[1][@{}l@{\AgdaIndent{0}}]%
%% \>[2]\AgdaSymbol{â†’}%
%% \>[17]\AgdaSymbol{(âˆ€}\AgdaSpace{}%
%% \AgdaBound{C}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaFunction{is-subsingleton}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaFunction{ğ’}\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaBound{C}\AgdaSymbol{))}\<%
%% \\
%% %
%% \>[2]\AgdaSymbol{â†’}%
%% \>[17]\AgdaBound{C}\AgdaSpace{}%
%% \AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
%% \AgdaBound{D}%
%% \>[24]\AgdaSymbol{â†’}%
%% \>[27]\AgdaSymbol{(}\AgdaBound{C}\AgdaSpace{}%
%% \AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
%% \AgdaBound{c}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{D}\AgdaSpace{}%
%% \AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
%% \AgdaBound{d}\AgdaSymbol{)}\<%
%% \\
%% %
%% \\[\AgdaEmptyExtraSkip]%
%% %
%% \>[1]\AgdaFunction{to-subtype-âŸ¦âŸ§}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaArgument{D}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaBound{D}\AgdaSymbol{\}\{}\AgdaBound{c}\AgdaSymbol{\}\{}\AgdaBound{d}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaBound{ssA}\AgdaSpace{}%
%% \AgdaBound{CD}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaFunction{to-Î£-â‰¡}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{CD}\AgdaSpace{}%
%% \AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
%% \AgdaBound{ssA}\AgdaSpace{}%
%% \AgdaBound{D}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaFunction{transport}\AgdaSpace{}%
%% \AgdaFunction{ğ’}\AgdaSpace{}%
%% \AgdaBound{CD}\AgdaSpace{}%
%% \AgdaBound{c}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaBound{d}\AgdaSymbol{)}\<%
%% \\
%% %
%% \\[\AgdaEmptyExtraSkip]%
%% %
\>[1]\AgdaFunction{class-extensionality'}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[200I]\AgdaFunction{propext}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{global-dfunext}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{â†’}%
\>[.][@{}l@{}]\<[200I]%
\>[14]\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaSymbol{â†’}%
\>[14]\AgdaSymbol{(âˆ€}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{is-subsingleton}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{R}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\<%
\\
\>[2]\AgdaSymbol{â†’}%
\>[14]\AgdaSymbol{(âˆ€}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{is-subsingleton}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ğ’}\AgdaSpace{}%
\AgdaBound{C}\AgdaSymbol{))}\<%
\\
\>[2]\AgdaSymbol{â†’}%
\>[14]\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaBound{R}\<%
\\
\>[14]\AgdaComment{---------------------------------------}\<%
\\
%
\>[2]\AgdaSymbol{â†’}%
\>[14]\AgdaBound{R}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{âŸ¦}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŸ§}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{R}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{âŸ¦}}\AgdaSpace{}%
\AgdaBound{a'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŸ§}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{R}\AgdaSymbol{\})}\<%
%% \\
%% %
%% \\[\AgdaEmptyExtraSkip]%
%% %
%% \>[1]\AgdaFunction{class-extensionality'}\AgdaSpace{}%
%% \AgdaBound{pe}\AgdaSpace{}%
%% \AgdaBound{gfe}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaArgument{A}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{a'}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaBound{ssR}\AgdaSpace{}%
%% \AgdaBound{ssA}\AgdaSpace{}%
%% \AgdaBound{Req}\AgdaSpace{}%
%% \AgdaBound{Raa'}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaFunction{Î³}\<%
%% \\
%% \>[1][@{}l@{\AgdaIndent{0}}]%
%% \>[2]\AgdaKeyword{where}\<%
%% \\
%% \>[2][@{}l@{\AgdaIndent{0}}]%
%% \>[3]\AgdaFunction{CD}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
%% \AgdaBound{a}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
%% \AgdaBound{R}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
%% \AgdaBound{a'}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
%% \AgdaBound{R}\AgdaSymbol{)}\<%
%% \\
%% %
%% \>[3]\AgdaFunction{CD}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaFunction{class-extensionality}\AgdaSpace{}%
%% \AgdaBound{pe}\AgdaSpace{}%
%% \AgdaBound{gfe}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{a'}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaBound{ssR}\AgdaSpace{}%
%% \AgdaBound{Req}\AgdaSpace{}%
%% \AgdaBound{Raa'}\<%
%% \\
%% %
%% \\[\AgdaEmptyExtraSkip]%
%% %
%% \>[3]\AgdaFunction{Î³}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaOperator{\AgdaFunction{âŸ¦}}\AgdaSpace{}%
%% \AgdaBound{a}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{âŸ§}}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{R}\AgdaSymbol{\})}\AgdaSpace{}%
%% \AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaOperator{\AgdaFunction{âŸ¦}}\AgdaSpace{}%
%% \AgdaBound{a'}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{âŸ§}}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{R}\AgdaSymbol{\})}\<%
%% \\
%% %
%% \>[3]\AgdaFunction{Î³}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaFunction{to-subtype-âŸ¦âŸ§}\AgdaSpace{}%
%% \AgdaBound{ssA}\AgdaSpace{}%
%% \AgdaFunction{CD}\<%
\end{code}



\subsection{Compatibility}\label{ssec:compatibility}
We say that a (unary) operation \ab f \as : \ab X \as â†’ \ab X is \defn{compatible} with (or \defn{respects}, or \defn{preserves}) the binary relation \ab R on \ab X just in case \as âˆ€ \ab x, \ab y \as : X, we have \ab R \ab x \ab y \as â†’  \ab R (\ab f \ab x) (\ab f \ab y).  Now suppose \ab ğ“¤, \ab ğ“¥, and \ab ğ“¦ are universes and assume the following typing judgments: \ab Î³ \as : \ab ğ“¥ \af Ì‡, \ab X \as : \ab ğ“¤ \af Ì‡. We lift the definition of compatibility from unary to \ab Î³-ary operations in the following obvious way: for all \ab u \ab v \as : \ab Î³ \as â†’ \ab X (\ab Î³-tuples of \ab X), we say that the pair \ab u \ab v is \ab R-related, and we write \AgdaFunction{lift-rel}~\ab R~\ab u~\ab v provided \as âˆ€ \ab i \as : \ab Î³, \ab R (\ab u \ab i) (\ab v \ab i). The function \af{lift-rel} is defined as follows.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{lift-rel}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{Z}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Î³}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{Z}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Î³}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{Z}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{lift-rel}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\end{code}
\ccpad
If \ab f \as : (\ab Î³ \as â†’ \ab X) \as â†’ \ab X is a \ab Î³-ary operation on \ab X, we say that \ab f is \defn{compatible} with \ab R provided for all \ab u \ab v : \ab Î³ \as â†’ \ab X, \af{lift-rel} \ab R \ab u \ab v implies \ab R (\ab f \ab u) (\ab f \ab v).
\ccpad
\begin{code}
\>[1]\AgdaFunction{compatible-op}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{compatible-op}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ‘¨}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{âˆ€\{}\AgdaBound{ğ’‚}\AgdaSymbol{\}\{}\AgdaBound{ğ’ƒ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lift-rel}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ’‚}\AgdaSpace{}%
\AgdaBound{ğ’ƒ}%
\>[53]\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‚}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ’‚}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‚}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ’ƒ}\AgdaSymbol{)}\<%
\end{code}
\ccpad
Finally, to represent that all basic operations of an algebra are compatible with a given relation, we define
%% \\
%% %
%% \>[1]\AgdaComment{-- alternative notation: (lift-rel R) =[ f Ì‚ ğ‘¨ ]â‡’ R}\<%
%% \\
%% %
%% \\[\AgdaEmptyExtraSkip]%
%% \>[0]\AgdaComment{--The given relation is compatible with all ops of an algebra.}\<%
%% \\
%% \>[0][@{}l@{\AgdaIndent{0}}]%
\ccpad
\begin{code}
\>[1]\AgdaFunction{compatible}\AgdaSpace{}%
\AgdaSymbol{:}{\AgdaSpace{}}%
\AgdaSymbol{(}\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{compatible}%
\>[13]\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{compatible-op}\AgdaSymbol{\{}\AgdaBound{ğ‘¨}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{R}\<%
\end{code}
\ccpad
We'll see this definition of compatibility at work very soon when we define congruence relations in the next section.


\newcommand\siOV{\AgdaFunction{Signature}\AgdaSpace{}\AgdaBound{ğ“}\AgdaSpace{}\AgdaBound{ğ“¥}\xspace}

\subsection{Congruence relations}\label{ssec:congr-relat}
This \ualibCongruences module of the \agdaualib defines 
%% -- BEGIN: \input{Relations/Congruences.tex}
three alternative representations of congruence relations of an algebra---first as a function, then as a predicate on binary relations, and finally as a record type.
%% Notice that module begins by assuming a signature \ab ğ‘† \as : \af{Signature} \ab ğ“ \ab ğ“¥ which is then present and available throughout the module.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{Con}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
\>[0]\AgdaFunction{Con}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{Î¸}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaBound{Î¸}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ã—}}\AgdaSpace{}%
\AgdaFunction{compatible}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{Î¸}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{con}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}%
\>[39]\AgdaSymbol{â†’}%
\>[42]\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{con}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaBound{Î¸}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaBound{Î¸}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ã—}}\AgdaSpace{}%
\AgdaFunction{compatible}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{Î¸}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{Congruence}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}%
\>[74]\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{mkcon}\<%
\\
%
\>[1]\AgdaKeyword{field}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaField{âŸ¨\AgdaUnderscore{}âŸ©}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\<%
\\
%
\>[2]\AgdaField{Compatible}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{compatible}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaField{âŸ¨\AgdaUnderscore{}âŸ©}}\<%
\\
%
\>[2]\AgdaField{IsEquiv}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaOperator{\AgdaField{âŸ¨\AgdaUnderscore{}âŸ©}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Congruence}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{compatible-equivalence}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
\>[0]\AgdaFunction{compatible-equivalence}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaBound{ğ“¦}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ‘¨}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{compatible}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ã—}}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaBound{R}\<%
\end{code}

%% \subsubsection{Example}\label{Congruences.sssec:example}
%% In \S\ref{Equivalences.ssec:examples}, we defined the \emph{trivial} (or ``diagonal'' or ``identity'' or ``zero'') relation \af{ğŸ-rel}  and observed that \af{ğŸ-rel} is (equivalent to the identity relation \aod â‰¡ and) is an equivalence relations. Therefore, in order to build a congruence of some algebra \ab ğ‘¨ out of the trivial relation, it remains to show that \af{ğŸ-rel} is compatible with all operations of \ab ğ‘¨.  We do this now and then construct the corresponding congruence.
%% %% \af{ğŸ-rel}
%% \ccpad
%% \begin{code}%
%% \>[0]\AgdaKeyword{module}\AgdaSpace{}\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}\AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}\AgdaSymbol{\{}\AgdaBound{ğ‘†}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}\AgdaFunction{Signature}\AgdaSpace{}\AgdaBound{ğ“}\AgdaSpace{}%
%% \AgdaBound{ğ“¥}\AgdaSymbol{\}}\AgdaSpace{}\AgdaKeyword{where}\<%
%% \\
%% %
%% \\[\AgdaEmptyExtraSkip]%
%% \>[0][@{}l@{\AgdaIndent{0}}]%
%% \>[1]\AgdaFunction{ğŸ-compatible-op}\AgdaSpace{}%
%% \AgdaSymbol{:}%
%% \>[200I]\AgdaFunction{funext}\AgdaSpace{}%
%% \AgdaBound{ğ“¥}\AgdaSpace{}%
%% \AgdaBound{ğ“¤}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{ğ‘¨}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaFunction{Algebra}\AgdaSpace{}%
%% \AgdaBound{ğ“¤}\AgdaSpace{}%
%% \AgdaBound{ğ‘†}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
%% \AgdaBound{ğ‘†}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)}\<%
%% \\
%% \>[1][@{}l@{\AgdaIndent{0}}]%
%% \>[3]\AgdaSymbol{â†’}%
%% \>[.][@{}l@{}]\<[200I]%
%% \>[14]\AgdaFunction{compatible-op}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaArgument{ğ“¤}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaArgument{ğ‘¨}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaBound{ğ‘¨}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaBound{f}\AgdaSpace{}%
%% \AgdaFunction{ğŸ-rel}\<%
%% \\
%% %
%% \>[1]\AgdaFunction{ğŸ-compatible-op}\AgdaSpace{}%
%% \AgdaBound{fe}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{ğ‘¨}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaBound{f}\AgdaSpace{}%
%% \AgdaBound{ptws0}%
%% \>[33]\AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaFunction{ap}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{Ì‚}}\AgdaSpace{}%
%% \AgdaBound{ğ‘¨}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{fe}\AgdaSpace{}%
%% \AgdaSymbol{(Î»}\AgdaSpace{}%
%% \AgdaBound{x}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaBound{ptws0}\AgdaSpace{}%
%% \AgdaBound{x}\AgdaSymbol{))}\<%
%% \\
%% %
%% \\[\AgdaEmptyExtraSkip]%
%% %
%% \>[1]\AgdaFunction{ğŸ-compatible}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaFunction{funext}\AgdaSpace{}%
%% \AgdaBound{ğ“¥}\AgdaSpace{}%
%% \AgdaBound{ğ“¤}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaFunction{Algebra}\AgdaSpace{}%
%% \AgdaBound{ğ“¤}\AgdaSpace{}%
%% \AgdaBound{ğ‘†}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaFunction{compatible}\AgdaSpace{}%
%% \AgdaBound{A}\AgdaSpace{}%
%% \AgdaFunction{ğŸ-rel}\<%
%% \\
%% %
%% \>[1]\AgdaFunction{ğŸ-compatible}\AgdaSpace{}%
%% \AgdaBound{fe}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaSymbol{Î»}\AgdaSpace{}%
%% \AgdaBound{f}\AgdaSpace{}%
%% \AgdaBound{args}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaFunction{ğŸ-compatible-op}\AgdaSpace{}%
%% \AgdaBound{fe}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaBound{f}\AgdaSpace{}%
%% \AgdaBound{args}\<%
%% \end{code}
%% \ccpad
%% Now that we have the ingredients required to construct a congruence, we carry out the construction as follows.
%% \ccpad
%% \begin{code}%
%% \>[0]\AgdaFunction{Î”}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaFunction{funext}\AgdaSpace{}%
%% \AgdaBound{ğ“¥}\AgdaSpace{}%
%% \AgdaBound{ğ“¤}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaFunction{Algebra}\AgdaSpace{}%
%% \AgdaBound{ğ“¤}\AgdaSpace{}%
%% \AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaSymbol{â†’}\AgdaSpace{}%
%% \AgdaRecord{Congruence}\AgdaSpace{}%
%% \AgdaBound{A}\<%
%% \\
%% \>[0]\AgdaFunction{Î”}\AgdaSpace{}%
%% \AgdaBound{fe}\AgdaSpace{}%
%% \AgdaBound{A}\AgdaSpace{}%
%% \AgdaSymbol{=}\AgdaSpace{}%
%% \AgdaInductiveConstructor{mkcon}\AgdaSpace{}%
%% \AgdaFunction{ğŸ-rel}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaSpace{}%
%% \AgdaFunction{ğŸ-compatible}\AgdaSpace{}%
%% \AgdaBound{fe}\AgdaSpace{}%
%% \AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaSpace{}%
%% \AgdaFunction{ğŸ-IsEquivalence}\AgdaSpace{}%
%% \AgdaSymbol{)}\<%
%% \end{code}

\subsection{Quotient algebras}\label{ssec:quotient-algebras}
An important construction in universal algebra is the quotient of an algebra \ab ğ‘¨ with respect to a congruence relation \ab Î¸ of \ab ğ‘¨. This quotient is typically denote by \ab ğ‘¨ \as / \ab Î¸ and Agda allows us to define and express quotients using this standard notation.
\ccpad
\begin{code}%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}â•±\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaComment{-- type â•± with `\textbackslash{}---`}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{â†’}%
\>[8]\AgdaRecord{Congruence}\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}\{}\AgdaBound{ğ“¡}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{A}%
\>[41]\AgdaComment{-- a number of times`}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaComment{-----------------------}\<%
\\
%
\>[1]\AgdaSymbol{â†’}%
\>[8]\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ‘†}\<%
\\
\>[0]\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{â•±}}\AgdaSpace{}%
\AgdaBound{Î¸}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[207I]\AgdaSymbol{((}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{/}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{âŸ¨}}\AgdaSpace{}%
\AgdaBound{Î¸}\AgdaSpace{}%
\AgdaOperator{\AgdaField{âŸ©}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaComment{-- carrier (i.e. domain or universe))}\<%
\\
\>[207I][@{}l@{\AgdaIndent{0}}]%
\>[10]\AgdaSymbol{(Î»}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{args}%
\>[28]\AgdaComment{-- operations}\<%
\\
\>[10][@{}l@{\AgdaIndent{0}}]%
\>[11]\AgdaSymbol{â†’}%
\>[220I]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‚}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(Î»}\AgdaSpace{}%
\AgdaBound{iâ‚}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{args}\AgdaSpace{}%
\AgdaBound{iâ‚}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{âŸ¨}}\AgdaSpace{}%
\AgdaBound{Î¸}\AgdaSpace{}%
\AgdaOperator{\AgdaField{âŸ©}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\<%
\\
\>[.][@{}l@{}]\<[220I]%
\>[13]\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‚}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(Î»}\AgdaSpace{}%
\AgdaBound{iâ‚}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaBound{args}\AgdaSpace{}%
\AgdaBound{iâ‚}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¥}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[10]\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[207I]%
\>[8]\AgdaSymbol{)}\<%
\end{code}

%% -- END: \input{Relations/Congruences.tex}











%% Varieties %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Equations and Varieties}\label{sec:equations-and-varieties}

\subsection{Types for Theories and Models}\label{ssec:types-for-theories-and-models}
The \agdaualib defines types that represents \defn{identites} of terms in a given signature and what it means for a structure to satisfy, or \defn{model}, such identities.

Let \ab ğ‘† be a signature. By an \defn{identity} or \defn{equation} in \ab ğ‘† we mean an ordered pair of terms, written \ab ğ‘ \aof â‰ˆ \ab ğ‘, from the term algebra \af ğ‘» \ab X. If \ab ğ‘¨ is an \ab ğ‘†-algebra we say that \ab ğ‘¨ \defn{satisfies} \ab ğ‘ \aof â‰ˆ \ab ğ‘ provided \ab ğ‘ \af Ì‡ \ab ğ‘¨ \aod â‰¡ \ab ğ‘ \aof Ì‡ \ab ğ‘¨ holds. In this situation, we write \ab ğ‘¨ \aof âŠ§ \ab ğ‘ \aof â‰ˆ \ab ğ‘ and say that \ab ğ‘¨ \defn{models} the identity \ab ğ‘ \aof â‰ˆ \ab q. If \ab ğ’¦ is a class of algebras, all of the same signature, we write \ab ğ’¦ \aof âŠ§ \ab p \aof â‰ˆ \ab q if, for every \ab ğ‘¨ \aof âˆˆ \ab ğ’¦, \ab ğ‘¨ \aof âŠ§ \ab ğ‘ \aof â‰ˆ \ab ğ‘.

\noindent \textbf{Notation}. In the \agdaualib, because a class of structures has a different type than a single structure, we must use a slightly different syntax to avoid overloading the relations \af âŠ§ and \af â‰ˆ. As a reasonable alternative to what we would normally express informally as ğ’¦ \aof âŠ§ \ab ğ‘ \aof â‰ˆ \ab ğ‘, we have settled on \ab ğ’¦ \aof âŠ§ \ab p \aof â‰‹ \ab q to denote this relation.  To reiterate, if \ab ğ’¦ is a class of \ab ğ‘†-algebras, we write \ab ğ’¦ \aof âŠ§ \ab ğ‘ \aof â‰‹ \ab ğ‘ if every \ab ğ‘¨ \aof âˆˆ \ab ğ’¦ satisfies \ab ğ‘¨ \aof âŠ§ \ab ğ‘ \aof â‰ˆ \ab ğ‘.

%% \subsubsection{Equational theories and models}\label{equational-theories-and-models}
%% --BEGIN: \input{Varieties/ModelTheory.tex}
The binary ``models'' relation \aof âŠ§ relating algebras (or classes of algebras) to the identities that they satisfy is defined in the \ualibModelTheory module.  Agda supports the definition of infix operations and relations, and we use this to define \aof âŠ§ so that we may write, e.g., \ab ğ‘¨ \aof âŠ§ \ab p \aof â‰ˆ \ab q or \ab ğ’¦ \aof âŠ§ \ab p \aof â‰‹ \ab q.
\ccpad
\begin{code}%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}âŠ§\AgdaUnderscore{}â‰ˆ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSymbol{\{}\AgdaBound{ğ“§}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ§}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{â‰ˆ}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}âŠ§\AgdaUnderscore{}â‰‹\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{OV}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{â†’}%
\>[8]\AgdaDatatype{Term}\AgdaSymbol{\{}\AgdaBound{ğ“§}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âº}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}âŠ§\AgdaUnderscore{}â‰‹\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ§}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{â‰ˆ}}\AgdaSpace{}%
\AgdaBound{q}\<%
\end{code}
\ccpad

The \agdaualib makes available the standard notation \af{Th} \ab ğ’¦ for the set of identities that hold for all algebras in a class \ab ğ’¦, as well as \af{Mod} \ab â„° for the class of algebras that satisfy all identities in a given set \ab â„°.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{OV}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{â†’}%
\>[5]\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSymbol{\{}\AgdaBound{ğ“§}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ã—}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âº}}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ§}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{â‰‹}}\AgdaSpace{}%
\AgdaBound{q}\<%
\end{code}
\scpad
\begin{code}%
\>[0]\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSymbol{\{}\AgdaBound{ğ“§}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ã—}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSymbol{\{}\AgdaBound{ğ“§}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âº}}\AgdaSymbol{)}\<%
\\
%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{â†’}%
\>[6]\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âº}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âº}}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{â„°}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆˆ}}\AgdaSpace{}%
\AgdaBound{â„°}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ§}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{â‰ˆ}}\AgdaSpace{}%
\AgdaBound{q}\<%
\end{code}



\subsection{Equational logic types}\label{ssec:equational-logic-types}
We prove closure, or ``invariance,'' properties of the models relation defined in \S\ref{ssec:types-for-theories-and-models}. Specifically, we prove the following facts (which are needed, for example, in the proof the Birkhoff HSP Theorem).
\begin{itemize}
  \item (\S\ref{sssec:algebraic-invariance}) the \aof âŠ§ relation is an \emph{algebraic invariant} (stable under isomorphism);
  \item (\S\ref{sssec:homomorphic-invariance})
    identities modeled by a class of algebras are invariant under homomorphisms from the term algebra \af ğ‘» \ab X to any algebra in the class;
  \item (\S\ref{sssec:subalgebraic-invariance})
    identities modeled by a class of algebras are modeled by all subalgebras of algebras in the class;
  \item (\S\ref{sssec:product-invariance})
    identities modeled by a class of algebras are modeled by all products of algebras in the class.
\end{itemize}

\subsubsection{Algebraic invaraince}\label{sssec:algebraic-invariance}
The binary relation \aof âŠ§ would be practically useless if it were not an \emph{algebraic invariant} (invariant under isomorphism). Before we prove this, let us clarify how one computes with (extensional) identities.

We have formally defined \ab ğ‘¨ \aof âŠ§ \ab ğ‘ \aof â‰ˆ \ab ğ‘, which represents the assertion that \ab p \aof â‰ˆ \ab q holds when this identity is interpreted in the algebra \ab ğ‘¨; syntactically, \ab ğ‘ \aof Ì‡ \ab ğ‘¨ \aof â‰¡ \ab ğ‘ \aof Ì‡ \ab ğ‘¨.  Computationally, the expression \ab ğ‘ \aof Ì‡ \ab ğ‘¨ \aof â‰¡ \ab ğ‘ \aof Ì‡ \ab ğ‘¨ is interpreted as an \emph{extensional equality}, by which we mean that for each \emph{assignment function} \ab ğ’‚ \as : \ab X \as â†’ \aiab{âˆ£}{ğ‘¨}, assigning values in the domain of \ab ğ‘¨ to the variable symbols in \ab X, we have (\ab ğ‘ \aof Ì‡ \ab ğ‘¨) \ab ğ’‚ \aof â‰¡ (\ab ğ‘ \aof Ì‡ \ab ğ‘¨) \ab ğ’‚.
\ccpad
\begin{code}%
  \input{aux/I-invariance.tex}
\end{code}
\ccpad
As the proof makes clear, we show \ab ğ‘© \aof âŠ§ \ab p \aof â‰ˆ \ab q by proving that \ab p \af Ì‡ \ab ğ‘© \aod â‰¡ \ab q \af Ì‡ \ab ğ‘© holds \emph{extensionally}, that is, \as âˆ€ \ab x, (\ab p \af Ì‡ \ab ğ‘©) \ab x \aod â‰¡ (\ab q \af Ì‡ \ab ğ‘©)\ab x.

We will also need to know that the \aof âŠ§ relation is compatible with the \AgdaFunction{lift-alg} and \af{lower-alg} operations defined in \S\ref{ssec:the-lift-of-an-algebra}. (We omit the easy proofs, but see~\cite{DeMeo:2021} or the \ualibdocs for details.)

\subsubsection{Homomorphic invariance}\label{sssec:homomorphic-invariance}
An identity is modeled by a class of algebras if and only if that identity is invariant under homomorphisms from the term algebra \af ğ‘» \ab X into any algebra in the class. More precisely, if \ab ğ’¦ is a class of \ab ğ‘†-algebras and \ab ğ‘, \ab ğ‘ are terms in the language of \ab ğ‘†, then,\\
\\
\ab ğ’¦ \aof âŠ§ \ab p \aof â‰ˆ \ab q \hskip3mm â‡” \hskip3mm
\as âˆ€ \ab ğ‘¨ \aof âˆˆ \ab ğ’¦, \as âˆ€ \ab h \as : \af{hom} (\af ğ‘» \ab X) \ab ğ‘¨, \ab h \aof âˆ˜ (\ab ğ‘ \aof Ì‡ (\af ğ‘» \ab X)) \as = \ab h \aof âˆ˜ (\ab ğ‘ \aof Ì‡ (\af ğ‘» \ab X)).
\ccpad
\begin{code}%
  \input{aux/H-invariance.tex}
\end{code}

\subsubsection{Subalgebraic invariance}\label{sssec:subalgebraic-invariance}
An identity is modeled by a class of algebras if and only if it is modeled by all subalgebras of algebras in the class.  One direction is obvious, so we only formalize the proof of the nontrivial direction; i.e., every term equation \ab p \aof â‰ˆ \ab q that is modeled by all \ab ğ‘¨ \aof âˆˆ \ab ğ’¦ is also modeled by every subalgebra of every member of \ab ğ’¦.
\ccpad
\begin{code}%
  \input{aux/S-invariance.tex}
\end{code}


\subsubsection{Product invariance}\label{sssec:product-invariance}
An identity modeled by a class of algebras is modeled by all products of algebras in the class.
\ccpad
\begin{code}%
  \input{aux/P-invariance.tex}
\end{code}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%% Bibliography
\bibliography{ualib_refs}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%















\appendix

\section{Agda Prerequisites}

For the benefit of readers who are not proficient in Agda and/or type theory, we describe some of the most important types and features of Agda used in the \ualib.


\subsection{Agda's universe hierarchy}\label{ssec:agdas-universe-hierarchy}
The hierarchy of universe levels in Agda is structured as \ab{ğ“¤â‚€} \as : \ab{ğ“¤â‚}, \hskip3mm \ab{ğ“¤â‚} \as : \ab{ğ“¤â‚‚}, \hskip3mm \ab{ğ“¤â‚‚} \as : \ab{ğ“¤â‚ƒ}, \ldots{}. This means that \ab{ğ“¤â‚€} has type \ab{ğ“¤â‚} \AgdaFunction{Ì‡} and \ab{ğ“¤â‚™} has type \ab{ğ“¤â‚™â‚Šâ‚} \AgdaFunction{Ì‡} for each \ab n.  It is important to note, however, this does \emph{not} imply that \ab{ğ“¤â‚€} \as : \ab{ğ“¤â‚‚} and \ab{ğ“¤â‚€} \as : \ab{ğ“¤â‚ƒ}, and so on. In other words, Agda's universe hierarchy is \emph{noncummulative}. This makes it possible to treat universe levels more generally and precisely, which is nice. On the other hand, it is this author's experience that a noncummulative hierarchy can sometimes make for a nonfun proof assistant.  (See~\cite[\S3.3]{DeMeo:2021} for a more detailed discussion.)


\subsection{Dependent pairs and projections}\label{ssec:dependent-pairs-and-projections}
Given universes \ab ğ“¤ and \ab ğ“¥, a type \ab X \as : \ab ğ“¤ \aof Ì‡, and a type family \ab Y \as : X \as â†’ \ab ğ“¥ \aof Ì‡, the \defn{Sigma type} (or \defn{dependent pair type}) is denoted by \AgdaRecord{Î£}(\ab x \as ê‰ \ab X)\as ,\ab Y(\ab x) and generalizes the Cartesian product \ab X \as Ã— \ab Y by allowing the type \ab Y(\ab x) of the second argument of the ordered pair (\ab x\as , \ab y) to depend on the value \ab x of the first.  That is, \AgdaRecord{Î£}(\ab x \as ê‰ \ab X)\as ,\ab Y(\ab x) is inhabited by pairs (\ab x\as , \ab y) such that \ab x \as : \ab X and \ab y \as : \ab Y(\ab x).

Agda's default syntax for a Sigma type is \AgdaRecord{Î£}\sP{3}\AgdaSymbol{Î»}(\ab x\sP{3}ê‰\sP{3}\ab X)\sP{3}\as â†’\sP{3}\ab Y, but we prefer the notation \AgdaRecord{Î£}~\ab x~ê‰~\ab X~,~\ab Y, which is closer to the standard syntax described in the preceding paragraph. Fortunately, this preferred notation is available in the \typetopology library (see~\cite[Î£ types]{MHE}).\footnote{The symbol \as ê‰ in the expression \AgdaRecord{Î£}\sP{3}\ab x\sP{3}\as ê‰\sP{3}\ab X\sP{3}\AgdaComma\sP{3}\ab Y is not the ordinary colon (:); rather, it is the symbol obtained by typing \texttt{\textbackslash{}:4} in \agdatwomode.} 

\newcommand\FstUnder{\AgdaOperator{\AgdaFunction{âˆ£\AgdaUnderscore{}âˆ£}}\xspace}
\newcommand\SndUnder{\AgdaOperator{\AgdaFunction{âˆ¥\AgdaUnderscore{}âˆ¥}}\xspace}
Convenient notations for the first and second projections out of a product are \FstUnder and \SndUnder, respectively. However, to improve readability or to avoid notation clashes with other modules, we sometimes use more standard alternatives, such as \AgdaFunction{prâ‚} and \AgdaFunction{prâ‚‚}, or \AgdaFunction{fst} and \AgdaFunction{snd}, or some combination of these. The definitions are standard so we omit them (see~\cite{DeMeo:2021} for details).






\subsection{Equality}\label{ssec:equality}
Perhaps the most important types in type theory are the equality types. The \emph{definitional equality} we use is a standard one and is often referred to as ``reflexivity'' or ``refl''.  In our case, it is defined in the Identity-Type module of the \TypeTopology library, but apart from syntax it is equivalent to the identity type used in most other Agda libraries. Here is the definition.
%% full listing of the \texttt{Identity-Type} module.
\ccpad
\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}â‰¡\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{x}\<%
\end{code}














\subsection{Function extensionality and intensionality}\label{sssec:function-extensionality-and-intensionality}
Extensional equality of functions, or \emph{function extensionality}, is a principle that is often assumed in the \agdaualib. It asserts that two point-wise equal functions are equal,\footnote{This is known to be not provable or disprovable in Martin-LÃ¶f type theory. It is an independent statement.} and is defined in the \typetopology library in the following natural way:
\ccpad
\begin{code}
  \>[0]\AgdaFunction{funext}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSymbol{)}\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
\>[0]\AgdaFunction{funext}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ¼}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{g}\<%
\end{code}
\ccpad
where \ab f \af âˆ¼ \ab g denotes pointwise equality, that is,
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}.

Pointwise equality of functions is typically what one means in informal settings when one says that two functions are equal. Later we will need dependent and polymorphic notions of function extensionality, and these are defined in the \ualib and \typetopology libraries (see~\cite[\S2.4]{DeMeo:2021} and~\cite[\S17-18]{MHE}).

\defn{Function intensionality} is the opposite of function extensionality and it comes in handy whenever we have a definitional equality and need a point-wise equality.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{intensionality}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[200I]\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{\}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{â†’}%
\>[.][@{}l@{}]\<[200I]%
\>[14]
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{g}%
\>[25]\AgdaSymbol{â†’}%
\>[28]\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSpace{}\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSpace{}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[0]\AgdaFunction{intensionality}%
\>[16]\AgdaSymbol{(}\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\end{code}
\ccpad
Of course, the intensionality principle has dependent and polymorphic analogues defined in the \agdaualib, but we omit the definitions. (See~\cite[\S2.4]{DeMeo:2021} for details).
















\subsection{Inverses, Epics and Monics}\label{ssec:inverses}
This section describes some of the more important parts of the \ualibInverses module.
In \S~\ref{ssec:inverse-image-type}, we define an inductive datatype that represents our semantic notion of the \defn{inverse image} of a function. In \S~\ref{ssec:epic-and-monic-function-types} we define types for \defn{epic} and \defn{monic} functions. Finally, in Subsections~\ref{ssec:monics-are-set-embeddings}, we consider the type of \defn{embeddings} (defined in~\cite[\S26]{MHE}), and determine how this type relates to our type of monic functions.

\subsubsection{Inverse image type}\label{ssec:inverse-image-type}

\begin{code}%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image\AgdaUnderscore{}âˆ‹\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaInductiveConstructor{im}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{âˆ‹}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[2]\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{âˆ‹}}\AgdaSpace{}%
\AgdaBound{b}\<%
\end{code}
\ccpad
Note that an inhabitant of \af{Image} \ab f \ad âˆ‹ \ab b is a dependent pair (\ab a \ac \ab p), where \ab a \as : \ab A and \ab p \as : \ab b  \ad â‰¡ \ab f \ab a is a proof that \ab f maps \ab a to \ab b. Thus, a proof that \ab b belongs to the image of \ab f (i.e., an inhabitant of \af{Image} \ab f \ad âˆ‹ \ab b), is always accompanied by a witness \ab a \as : \ab A, and a proof that \ab b \ad{â‰¡} \ab f \ab a, so the inverse of a function \ab f can actually be \emph{computed} at every inhabitant of the image of \ab f.

We define an inverse function, which we call \af{Inv}, which, when given \ab b \as : \ab B and a proof (\ab a \ac \ab p) \as : \af{Image} \ab f \ad âˆ‹ \ab b that \ab b belongs to the image of \ab f, produces \ab a (a preimage of \ab b under \ab f).
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)(}\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{âˆ‹}}\AgdaSpace{}%
\AgdaBound{b}%
\>[61]\AgdaSymbol{â†’}%
\>[64]\AgdaBound{A}\<%
\\
%
\>[1]\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaBound{f}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{a}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{im}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[1]\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaUnderscore\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaUnderscore\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaUnderscore\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{a}\<%
\end{code}
\ccpad
Thus, the inverse is computed by pattern matching on the structure of the third explicit argument, which has (inductive) type \AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}\AgdaBound{f}\AgdaSpace{}\AgdaOperator{\AgdaDatatype{âˆ‹}}\AgdaSpace{}\AgdaBound{b}.  Since there are two constructors, \AgdaInductiveConstructor{im} and \AgdaInductiveConstructor{eq}, that argument must take one of two forms. Either it has the form \AgdaInductiveConstructor{im}\AgdaSpace{}\AgdaBound{a} (in which case the second explicit argument is \as{.(}\ab f \ab a \as )),\footnote{The dotted pattern is used when the form of the argument is forced... todo: fix this sentence} or it has the form \AgdaInductiveConstructor{eq} \ab b \ab a \ab p, where \ab p is a proof of \ab b \aof â‰¡ \ab f \ab a.  (The underscore characters replace \ab b and \ab p in the definition since \af{Inv} doesn't care about them; it only needs to extract and return the preimage \ab a.)

We can formally prove that \af{Inv} \ab f is the right-inverse of \ab f, as follows.  Again, we use pattern matching and structural induction.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{InvIsInv}%
\>[156I]\AgdaSymbol{:}%
\>[157I]\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[157I]%
\>[12]\AgdaSymbol{(}\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{bâˆˆImgf}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{âˆ‹}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>[156I][@{}l@{\AgdaIndent{0}}]%
\>[11]\AgdaComment{----------------------}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{â†’}%
\>[12]\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaBound{bâˆˆImgf}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[1]\AgdaFunction{InvIsInv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaBound{f}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{a}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{im}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{InvIsInv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{bâ‰¡fa}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{bâ‰¡fa}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{â»Â¹}}\<%
\end{code}
\ccpad
Here we give names to all the arguments for readability, but most of them could be replaced with underscores.

\subsubsection{Epic and monic function types}\label{ssec:epic-and-monic-function-types}
Given universes \ab ğ“¤, \ab ğ“¦, types \AgdaTyped{A}{ğ“¤ Ì‡} and \AgdaTyped{B}{ğ“¦ Ì‡}, and \ab f \as : \ab A \as â†’ \ab B, we say that \ab f is an \emph{epic} (or \emph{surjective}) \emph{function from} \ab A \emph{to} \ab B provided we can produce an element (or proof or witness) of type \af{Epic} \ab f, where
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{Epic}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}%
\>[45]\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{Epic}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{âˆ‹}}\AgdaSpace{}%
\AgdaBound{y}\<%
\end{code}
\ccpad
We obtain the (right-) inverse of an epic function \ab f by applying the following function %% \af{EpicInv} defined below 
to \ab f and a proof %% , \ab{p} \as : \af{Epic} \ab f, 
that \ab f is epic.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{EpicInv}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[233I]\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[233I]%
\>[11]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Epic}\AgdaSpace{}%
\AgdaBound{f}\<%
\\
%
\>[11]\AgdaComment{--------------------}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{â†’}%
\>[11]\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\>[1]\AgdaFunction{EpicInv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\<%
\end{code}
\ccpad
The function defined by \af{EpicInv} \ab f \ab{p} is indeed the right-inverse of \ab f, as we now prove.
%% Here is how we formalize that assertion and its proof.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{EpicInvIsRightInv}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[262I]\AgdaFunction{funext}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[262I]%
\>[21]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}%
\>[34]\AgdaSymbol{(}\AgdaBound{fE}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Epic}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\\
%
\>[21]\AgdaComment{--------------------}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{â†’}%
\>[21]\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ˜}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{EpicInv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{fE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaFunction{ğ‘–ğ‘‘}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
%
\>[1]\AgdaFunction{EpicInvIsRightInv}\AgdaSpace{}%
\AgdaBound{fe}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{fE}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{fe}\AgdaSpace{}%
\AgdaSymbol{(Î»}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{InvIsInv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fE}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\<%
\end{code}
\ccpad

Similarly, we say that \ab f \as : \ab A \as â†’ \ab B is a \defn{monic} (or \defn{injective}) function from \ab A to \ab B if we have a proof of \af{Monic} \ab f, where
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{Monic}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{Monic}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{aâ‚}\AgdaSpace{}%
\AgdaBound{aâ‚‚}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{aâ‚}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{aâ‚‚}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{aâ‚}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{aâ‚‚}\<%
\end{code}
As one would hope and expect, the \emph{left-}inverse of a monic function is derived from a proof \ab p~\as :~\af{Monic}~\ab f in a similar way. (See \af{MonicInv} and \af{MonicInvIsLeftInv} in \cite[\S2.3]{DeMeo:2021} for details.)



%% Relations %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% \section{Relations}\label{sec:relations}

\subsection{Unary Relations (predicates)}\label{sec:predicates}
\newcommand{\ovu}{\ab ğ“ \af âŠ” \ab ğ“¥ \af âŠ” \ab ğ“¤ \af âº \af Ì‡}
We need a mechanism for implementing the notion of subsets in Agda. A typical one is called \af{Pred} (for predicate). More generally, \af{Pred} \ab A \ab ğ“¤ can be viewed as the type of a property that elements of type \ab{A} might satisfy. We write \ab P \as : \af{Pred} \ab A \ab ğ“¤ to represent the semantic concept of a collection of elements of type \ab{A} that satisfy the property \ab{P}.
Here is the definition, which is similar to the one found in the \texttt{Relation/Unary.agda} file of the \agdastdlib.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\end{code}
\ccpad
Below we will often consider predicates over the class of all algebras of a particular type. %% We will define the type of algebras \af{Algebra} \ab ğ“¤ \ab ğ‘† (for some universe level \ab ğ“¤). Like all types, \af{Algebra} \ab ğ“¤ \ab ğ‘† itself has a type which happens to be \ovu (see Section~\ref{ssec:algebra-type}). Therefore, the type of \af{Pred} (\af{Algebra} \ab ğ“¤ \ab ğ‘†)\ab ğ“¤ is \ovu as well.  
By definition, the inhabitants of the type \af{Pred} (\af{Algebra} \ab ğ“¤ \ab ğ‘†) \ab ğ“¤ are maps of the form \ab ğ‘¨ \as â†’ \ab ğ“¤ \af Ì‡.

In type theory everything is a type. As we have just seen, this includes subsets. Since the notion of equality for types is usually a nontrivial matter, it may be nontrivial to represent equality of subsets. Fortunately, it is straightforward to write down a type that represents what it means for two subsets to be equal in informal (pencil-paper) mathematics. In the \ualib we denote this \defn{subset equality} by =Ì‡ and define it as follows.\footnote{Our notation and definition representing the semantic concept ``\ab x belongs to \ab P,'' or ``\ab x has property \ab P,'' is standard. We write either \ab x \af âˆˆ \ab P or \ab P \ab x. Similarly, the ``subset'' relation is denoted, as usual, with the \af{âŠ†} symbol (cf.  in the \agdastdlib).  The relations \af âˆˆ and \af{âŠ†} are defined in the \agdaualib in a was similar to that found in the \texttt{Relation/Unary.agda} module of the \agdastdlib. (See~\cite[\S4.1.2]{DeMeo:2021}.)}
\ccpad
\begin{code}%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}=Ì‡\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaBound{ğ“£}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“£}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“£}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
\>[0]\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{=Ì‡}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ†}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ã—}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âŠ†}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{)}\<%
\end{code}

%% -- END: \input{Relations/Unary.tex} -------------------------------------------









\subsection{Binary Relations}\label{ssec:binary-relations}
%% This section highlights a few relevant parts of the \ualibBinary module of the \agdaualib.
%%-- BEGIN: \input{Relations/Binary.tex}----------
In set theory, a binary relation on a set \ab{A} is simply a subset of the product \ab A \af Ã— \ab A. As such, we could model these as predicates over the type \ab A \af Ã— \ab A, or as relations of type \ab A \as â†’ \ab A \as â†’ \ab ğ“¡ \af Ì‡ (for some universe \ab ğ“¡). A generalization of this notion is a binary relation is a \emph{relation from} \ab{A} \emph{to} \ab{B}, which we define first and treat binary relations on a single \ab{A} as a special case.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{REL}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{REL}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\end{code}


%% \subsubsection{Properties of binary relations}\label{sssec:properties-of-binary-relations}
The notions of reflexivity, symmetry, and transitivity are defined as one would hope and expect, so we present them here without further explanation.
\begin{code}%
\>[1]\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{\AgdaUnderscore{}â‰ˆ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{â‰ˆ}}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{symmetric}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{symmetric}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{\AgdaUnderscore{}â‰ˆ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{â‰ˆ}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{â‰ˆ}}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{transitive}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{transitive}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{\AgdaUnderscore{}â‰ˆ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{âˆ€}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{â‰ˆ}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{â‰ˆ}}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{â‰ˆ}}\AgdaSpace{}%
\AgdaBound{z}\<%
\end{code}

%%-- END: \input{Relations/Binary.tex}----------








\subsection{Kernels of functions}\label{ssec:kernels}
The kernel of a function can be defined in many ways. For example,
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{KER}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{KER}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¡}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{y}\<%
\end{code}
\ccpad
or as a unary relation (predicate) over the Cartesian product,
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{KER-pred}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ã—}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ“¡}\<%
\\
%
\>[1]\AgdaFunction{KER-pred}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{y}\<%
\end{code}
\ccpad
or as a relation from \ab{A} to \ab{B},
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\>[1]\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{REL}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{KER-rel}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\<%
\\
%
\>[1]\AgdaFunction{KER-rel}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{â‰¡}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{y}\<%
\end{code}


\subsection{Equivalence Relations}\label{sssec:equiv-relat}
Types for equivalence relations are defined in the \ualibEquivalences module of the \agdaualib using a \AgdaKeyword{record} type, as follows:
%% BEGIN: \input{Relations/Equivalences.tex}
\ccpad
\begin{code}%
\>[1]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaBound{\AgdaUnderscore{}â‰ˆ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¡}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaField{rfl}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{\AgdaUnderscore{}â‰ˆ\AgdaUnderscore{}}}\<%
\\
%
\>[3]\AgdaField{sym}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{symmetric}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{\AgdaUnderscore{}â‰ˆ\AgdaUnderscore{}}}\<%
\\
%
\>[3]\AgdaField{trans}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{transitive}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{\AgdaUnderscore{}â‰ˆ\AgdaUnderscore{}}}\<%
\end{code}
\ccpad
For example, here is how we construct an equivalence relation out of the kernel of a function.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{map-kernel-IsEquivalence}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[122I]\AgdaSymbol{\{}\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“¦}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[122I]%
\>[28]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{KER-rel}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{map-kernel-IsEquivalence}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ğ“¦}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{record}%
\>[142I]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{rfl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaInductiveConstructor{ğ“‡â„¯ğ’»ğ“}\<%
\\
\>[.][@{}l@{}]\<[142I]%
\>[9]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{xâ‚}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{â‰¡-sym}\AgdaSymbol{\{}\AgdaBound{ğ“¦}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{xâ‚}\<%
\\
%
\>[9]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaBound{xâ‚}\AgdaSpace{}%
\AgdaBound{xâ‚‚}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{â‰¡-trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{z}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{xâ‚}\AgdaSpace{}%
\AgdaBound{xâ‚‚}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}
%% END: \input{Relations/Equivalences.tex}






\subsection{Nonstandard notation and syntax}
The notation we adopt is that of the \typetopology library of \MartinEscardo. Here we give a few more details and a table (Table~\ref{tab:dictionary}) which translates between standard \agda syntax and \typetopology/\ualib notation.

Many occasions call for a the universe that is the least upper bound of two universes, say, \ab ğ“¤  and \ab ğ“¥. This is denoted by \ab ğ“¤ \AgdaSymbol{âŠ”} \ab ğ“¥ in standard Agda syntax, and in our notation the correponding type is (\ab ğ“¤ \AgdaSymbol{âŠ”} \ab ğ“¥) Ì‡, or, more simply, \ab ğ“¤ \AgdaSymbol{âŠ”} \ab ğ“¥ Ì‡ (since \AgdaUnderscore{}\AgdaSymbol{âŠ”}\AgdaUnderscore{} has higher precedence than \AgdaUnderscore{}Ì‡).

To justify the introduction of this somewhat nonstandard notation for universe levels, \escardo points out that the Agda library uses \AgdaKeyword{Level} for universes (so what we write as \ab ğ“¤ Ì‡ is written \Set\sP{3}\ab ğ“¤ in standard Agda), but in univalent mathematics the types in \ab ğ“¤ Ì‡ need not be sets, so the standard Agda notation can be misleading.

In addition to the notation described in \S\ref{ssec:options-and-imports} above, the level \lzero is renamed \AgdaBound{ğ“¤â‚€}, so \AgdaBound{ğ“¤â‚€}\af Ì‡ is an alias for \Set \lzero. (For those familiar the \href{https://leanprover.github.io/}{Lean} proof assistant, \AgdaBound{ğ“¤â‚€}\af Ì‡ (i.e., \Set \lzero) is analogous to Lean's \texttt{Sort 0}.)

\begin{table}
\begin{tabular}{r|l}
Standard \agda                        &          \typetopology/\ualib \\
\hline
\AgdaKeyword{Level}          &   \AgdaFunction{Universe}\\
\ab ğ“¤ : \AgdaKeyword{Level}  & \ab ğ“¤ : \AgdaFunction{Universe}\\
\Set \ab ğ“¤                  &       \ab ğ“¤ Ì‡ \\
\lsuc \ab ğ“¤                   &    \ab ğ“¤ âº\\
\Set (\lsuc \ab ğ“¤) &    \ab ğ“¤ âº Ì‡\\
\lzero                       &         \AgdaBound{ğ“¤â‚€}\\
\AgdaFunction{SetÏ‰}  &         \AgdaFunction{ğ“¤Ï‰}
\end{tabular}
\caption{Special notation for universe levels}
\label{tab:dictionary}
\end{table}



%% \section{Some Components of the Type Topology Library}
%% Here we collect some of the components from the \typetopology library that we used above but did not have space to discuss.  They are collected here for the reader's convenience and to keep the paper somewhat self-contained.

%% \input{aux/typetopology.tex}









%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Inductive Types H, S, P, V}\label{sec:inductive-types-h-s-p-v}
This section presents the \ualibVarietiesVarieties module of the \agdaualib.
\input{Varieties/Varieties.tex}

\subsection{Equation Preservation Theorems}\label{sec:equation-preservation-theorems}
This section presents the \ualibPreservation module of  the \agdaualib.
\input{Varieties/Preservation.tex}






%% Homomorphisms %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Homomorphisms}\label{sec:homomorphisms}

\subsection{Basic Definitions}
\label{sec:homs-basic-definitions}
This section describes the \ualibHomBasic module of the \agdaualib.
\input{Homomorphisms/Basic.tex}

\subsection{Kernels of Homomorphisms}
\label{sec:kernels}
This section describes the \ualibKernels module of the \agdaualib.
\input{Homomorphisms/Kernels.tex}

\subsection{Homomorphism Theorems}
\label{sec:noether}
This section describes the \ualibNoether module of the \agdaualib.
\input{Homomorphisms/Noether.tex}

\subsection{Products and Homomorphisms}
\label{sec:products-1}
This section describes the \ualibHomProducts module of the \agdaualib.
\input{Homomorphisms/Products.tex}

\subsection{Isomorphism Type}
\label{sec:isomorphisms}
This section describes the \ualibIsomorphisms module of the \agdaualib.
\input{Homomorphisms/Isomorphisms.tex}

\subsection{Homomorphic Image Type}
\label{sec:homomorphicimages}
This section describes the \ualibHomImages module of the \agdaualib.
\input{Homomorphisms/HomomorphicImages.tex}

\newpage

%% Terms %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Terms}

\subsection{Basic Definitions}
\label{sec:terms-basic-definitions}
This section describes the \ualibTermsBasic module of the \agdaualib.
\input{Terms/Basic.tex}

\subsection{The Term Algebra}
\label{sec:the-term-algebra}
This section describes the \ualibTermsFree module of the \agdaualib.
\input{Terms/Free.tex}

\subsection{Term Operations}
\label{sec:term-operations}
This section describes the \ualibTermsOperations module of the \agdaualib.
\input{Terms/Operations.tex}

\subsection{Compatibility of Terms}
\label{sec:compatibility-of-terms}
This section describes the \ualibTermsCompatibility module of the \agdaualib.
\input{Terms/Compatibility.tex}

\newpage

%% Subalgebras %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Subalgebras}\label{sec:subalgebras}

\subsection{Types for Subuniverses}\label{sec:subuniverse-type}
This section describes the \ualibSubuniverses module of the \agdaualib.
\input{Subalgebras/Subuniverses.tex}

\subsection{Subuniverse Generation}\label{sec:subun-gener}
This section describes the \ualibGeneration module of  the \agdaualib.
\input{Subalgebras/Generation.tex}

\subsection{Subuniverse Lemmas}\label{sec:subuniverse-lemmas}
This section describes the \ualibProperties module of  the \agdaualib.
\input{Subalgebras/Properties.tex}

\subsection{Homomorphisms and Subuniverses}\label{homomorphisms-and-subuniverses}
This section describes the \ualibHomsAndSubs module of  the \agdaualib.
\input{Subalgebras/Homomorphisms.tex}

\subsection{Types for Subalgebra}\label{sec:subalgebra-type}
This section describes the \ualibSubalgebras module of  the \agdaualib.
\input{Subalgebras/Subalgebras.tex}

\subsection{WWMD}\label{sec:wwmd}
This section describes the \ualibWWMD module of  the \agdaualib.
\input{Subalgebras/WWMD.tex}

\newpage

\begin{center}
  (This page is almost entirely blank on purpose.)
\end{center}

\newpage


\newpage

%% HSP Theorem %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Birkhoff's HSP Theorem}
\label{sec:birkhoff}

\subsection{The Relatively Free Algebra}\label{sec:relatively-free-algebra-type}
This section presents the \ualibFreeAlgebra module of  the \agdaualib.
\input{Birkhoff/FreeAlgebra.tex}

\subsection{HSP Lemmas}\label{sec:hsp-lemmas}
This section presents the \ualibLemmata of  the \agdaualib.
\input{Birkhoff/Lemmata.tex}

\subsection{The HSP Theorem}\label{sec:hsp-theorem}
This section presents the \ualibTheorem module of  the \agdaualib.
\input{Birkhoff/Theorem.tex}


