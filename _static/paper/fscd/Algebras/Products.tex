Suppose we are given a type \ab I \as : \ab ğ“˜ (of ``indices'') and an indexed family \ab ğ’œ \as : \ab I \as â†’ \af{Algebra} \ab ğ“¤ \ab ğ‘† of \ab ğ‘†-algebras. Then we define the \emph{product algebra}
\AgdaFunction{â¨…} \AgdaBound{ğ’œ} in the following natural way.
%% %
%% %
%% \footnote{To distinguish the product algebra from the standard dependent function type available in the \agdastdlib, instead of \af âˆ (\texttt{\textbackslash prod}) or \af Î  (\texttt{\textbackslash Pi}), we use the symbol \AgdaFunction{â¨…}, which is typed in \agdamode as \texttt{\textbackslash Glb}.}%
%% %
\ccpad
\begin{code}%
\>[0]\AgdaFunction{â¨…}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaSymbol{\{}\AgdaBound{ğ“¤}\AgdaSpace{}%
%% \AgdaBound{ğ“˜}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaPostulate{Universe}\AgdaSymbol{\}}
\AgdaSymbol{\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ğ“˜}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\AgdaSpace{}%
\AgdaSymbol{\}(}\AgdaBound{ğ’œ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“˜}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ‘†}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{â¨…}\AgdaSpace{}%
\AgdaBound{ğ’œ}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[48I]\AgdaSymbol{(âˆ€}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ’œ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}%
\>[39]\AgdaComment{-- domain of the product algebra}\<%
\\
%
\>[.][@{}l@{}]\<[48I]%
\>[7]\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaBound{ğ‘“}\AgdaSpace{}%
\AgdaBound{ğ‘}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ‘“}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‚}}\AgdaSpace{}%
\AgdaBound{ğ’œ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaBound{ğ‘}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}%
\>[39]\AgdaComment{-- basic operations of the product algebra}\<%
\end{code}
\ccpad

Before proceeding, we define some convenient syntactic sugar. The type \af{Algebra} \ab ğ“¤ \ab ğ‘† itself has a type; it is \ab ğ“ \as âŠ” \ab ğ“¥ \as âŠ” \ab ğ“¤ \af âº \af Ì‡ . This type appears quite often throughout the \ualib, so it is worthwhile to define the following shorthand for its universe level.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{ov}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaPostulate{Universe}\<%
\\
\>[0]\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ğ“}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¥}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âº}}\<%
\end{code}

\subsection{Products of classes of algebras}\label{products-of-classes-of-algebras}
In the course of using Agda to formalize deep theorems in universal algebra (e.g., Birkhoff's HSP theorem), we were faced at a certain point with proving that the product of all subalgebras of algebras in a class ğ’¦ belongs to the class SP(ğ’¦) of subalgebras of products of algebras in ğ’¦.  That is, we had to prove \af â¨… \ad S(\ab ğ’¦) \af âˆˆ \ad{SP}(\ab ğ’¦). This turned out to be surprisingly nontrivial. In fact, it wasn't even clear (at least to this author) how one should express the product of a whole class of algebras as a dependent type. After a number of failed attempts, the right type revealed itself in the form of the \af{class-product} function defined below. Now that we have the type in our hands, it seems quite natural, if not obvious.

First, we need a type that will serve to index a given class of algebras, as well as the product of all members of the class.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{â„‘}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ì‡}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{â„‘}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Î£}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaFunction{ê‰}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆˆ}}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ã—}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{ğ‘¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSymbol{)}\<%
\end{code}
\ccpad
Notice that the second component of this dependent pair type is \abğ‘¨ \af âˆˆ \ab ğ’¦ \ad Ã— (\ab X \as â†’ \af âˆ£ \ab ğ‘¨ \af âˆ£). In previous versions of the \ualib, the second component was simply \ab ğ‘¨ \af âˆˆ \ab ğ’¦. However, we realized that adding a mapping of type \ab X \as â†’ \af âˆ£ \ab ğ‘¨ \af âˆ£ is quite useful. The reason for this will become clear later; for now, suffice it to say that a map \ab X \as â†’ \af âˆ£ \ab ğ‘¨ \af âˆ£ may be viewed as a context and we want to keep the context completely general. Including this context map in the index type \af â„‘ accomplishes this.

Forming the product over the index type \af â„‘ requires a function that takes an index \ab i \as : \af â„‘ and returns the corresponding algebra. Each \ab i \as : \af â„‘ is a triple of the form (\ab ğ‘¨ , \ab p , \ab h), where \ab ğ‘¨~\as :~\af{Algebra}~\ab ğ“¤~\ab ğ‘† and \ab p \as : \ab ğ‘¨ \af âˆˆ \ab ğ’¦ and \ab h \as : \ab X \as â†’ \af âˆ£ \ab ğ‘¨ \as âˆ£, so the function mapping an index to the corresponding algebra is simply the first projection.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{ğ”„}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{â„‘}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ğ”„}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Î»}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{â„‘}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{âˆ£}}\<%
\end{code}
\ccpad
Finally, we define \af{class-product} which represents the product of all members of \ab ğ’¦.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{class-product}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSpace{}%
\AgdaBound{ğ‘†}\AgdaSymbol{)(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{â†’}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ğ“§}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{âŠ”}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ğ“¤}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ğ‘†}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{class-product}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{â¨…}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{ğ”„}\AgdaSpace{}%
\AgdaBound{ğ’¦}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\ccpad
If \ab p \as : \ab ğ‘¨ \af âˆˆ \ab ğ’¦ and \ab h \as : \ab X \as â†’ \af âˆ£ \ab ğ‘¨ \af âˆ£, then the triple (\ab ğ‘¨ , \ab p , \ab h) \af âˆˆ \af â„‘ \ab ğ’¦ denotes an index of the class, and \af ğ”„ (\ab ğ‘¨ , \ab p , \ab h) (= \ab{ğ‘¨}) is the projection of the product \af â¨… ( \af ğ”„ \ab ğ’¦ ) onto the (\ab ğ‘¨ , \ab p , \ab h)-th component.
